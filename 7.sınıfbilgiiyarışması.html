<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Din Kültürü ve Ahlak Bilgisi 7. Sınıf Ünite Etkinlikleri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* HTML ve body'nin tam yüksekliği kaplamasını sağla */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* İçerik taşarsa kaydırmaya izin vermek için başlangıca hizala */
            min-height: 100vh; /* Tam yüksekliği kaplamasını sağlamak için min-height kullan */
            padding: 2rem 1rem;
            box-sizing: border-box; /* Padding ve border'ı elementin toplam genişlik ve yüksekliğine dahil et */
            background-size: cover; /* Görselin tüm alanı kaplamasını sağlar */
            background-position: center; /* Görseli ortalar */
            background-repeat: no-repeat; /* Görselin tekrarlanmasını engeller */
            background-attachment: fixed; /* Görselin sabit kalmasını sağlar */
            font-size: 1.25rem; /* Genel yazı boyutu biraz daha büyütüldü */
            transition: background-image 1s ease-in-out; /* Arka plan geçiş efekti */
        }
        .container {
            width: 100%;
            max-width: 900px; /* Ana konteyner için maksimum genişlik artırıldı */
            padding: 2rem;
            background-color: #e6f0f5; /* Beyaz arka plan rengi değiştirildi */
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            flex-grow: 1; /* Esnek ebeveyn içinde konteynerin büyümesine izin ver */
            display: flex; /* Konteynerin iç düzeni için flex kullan */
            flex-direction: column; /* Çocukları dikey olarak yığınla */
        }
        h1 {
            color: #2c3e50;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.8rem; /* Başlık boyutu büyütüldü */
        }
        /* BAŞLANGIÇ: Skor Tablosu Stilleri */
        .score-table-container {
            margin-top: 1rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .score-table {
            display: flex;
            justify-content: center; /* Katılımcıları ortala */
            gap: 1rem; /* Katılımcı skor kartları arasındaki boşluk */
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            flex-wrap: wrap;
            padding: 0.5rem; /* Tüm skor tablosu etrafına biraz padding ekle */
        }
        .score-cell {
            padding: 1rem 1.5rem; /* Padding artırıldı */
            display: flex;
            flex-direction: column; /* İsim ve skoru dikey olarak yığınla */
            align-items: center;
            justify-content: center;
            min-width: 140px; /* Minimum genişlik artırıldı */
            box-sizing: border-box;
            border-radius: 0.5rem; /* Bireysel hücreler için yuvarlak köşeler */
            transition: all 0.3s ease; /* Aktif durum için yumuşak geçiş */
            position: relative;
            z-index: 1; /* Hücrelerin gölge/çerçeve için üst üste olmasını sağla */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Her hücre için hafif gölge */
            background-color: #3b82f6; /* Katılımcılar için varsayılan mavi */
        }
        .score-cell.active-participant {
            transform: translateY(-5px); /* Aktif katılımcıyı yukarı kaldır */
            box-shadow: 0 8px 15px rgba(0,0,0,0.2); /* Aktif katılımcı için daha belirgin gölge */
            outline: 4px solid #fcd34d; /* Daha kalın sarı çerçeve */
            outline-offset: -4px;
            z-index: 2; /* Aktif katılımcıyı daha öne getir */
        }
        .score-cell .participant-name {
            font-size: 1.1em; /* İsim için biraz daha büyük */
            margin-bottom: 0.5rem; /* İsim altında daha fazla boşluk */
            opacity: 1; /* İsim için tam opaklık */
            display: flex;
            align-items: center;
            gap: 0.5rem; /* İkon ve isim arasındaki boşluk */
        }
        .score-cell .participant-score {
            font-size: 2.5em; /* Skor için önemli ölçüde daha büyük */
            font-weight: 900; /* Ekstra kalın */
            line-height: 1; /* Büyük sayılar için satır yüksekliğini ayarla */
        }
        /* SON: Skor Tablosu Stilleri */

        /* BAŞLANGIÇ: Lider Tablosu Listesi Stilleri */
        .leaderboard-list {
            display: grid; /* Sütun düzeni için ızgaraya değiştirildi */
            grid-template-columns: repeat(5, minmax(150px, 1fr)); /* Duyarlı 5 sütunlu düzen */
            gap: 1rem; /* Izgara öğeleri arasındaki boşluk */
            width: 100%; /* %100 genişliği koru */
            padding: 0.6rem 1rem; /* Daha küçük yükseklik için padding daha da azaltıldı */
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* İçeriğin sınırlar içinde kalmasını sağla */
        }
        @media (max-width: 768px) {
            .leaderboard-list {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* Daha küçük ekranlar için min-width'i ayarla */
            }
        }
        .leaderboard-item {
            display: flex; /* Yatay düzenleme için tekrar flex'e değiştirildi */
            justify-content: space-between; /* Öğeleri yatay olarak dağıt */
            align-items: center; /* Öğeleri dikey olarak ortala */
            padding: 0.6rem 1rem; /* Daha küçük yükseklik için padding daha da azaltıldı */
            border: 1px solid #e2e8f0; /* Tüm kenarları çevreleyen çerçeveye değiştirildi */
            border-radius: 8px; /* Her öğe için yuvarlak köşeler */
            font-size: 0.95rem; /* Genel yükseklik için font boyutu daha da azaltıldı */
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Her öğe için hafif gölge */
            flex-grow: 1; /* Öğelerin alanı doldurmak için büyümesine izin ver */
            min-width: 0; /* İçeriğin doğal genişliğinin altına küçülmesine izin ver */
        }
        /* Lider tablosu öğeleri için yeni renk sınıfları */
        .leaderboard-item.color-0 { background-color: #e0f7fa; color: #006064; border-color: #80deea; } /* Camgöbeği */
        .leaderboard-item.color-1 { background-color: #e8f5e9; color: #2e7d32; border-color: #a5d6a7; } /* Yeşil */
        .leaderboard-item.color-2 { background-color: #f3e5f5; color: #6a1b9a; border-color: #ce93d8; } /* Mor */
        .leaderboard-item.color-3 { background-color: #fff3e0; color: #ef6c00; border-color: #ffcc80; } /* Turuncu */
        .leaderboard-item.color-4 { background-color: #ffebee; color: #c62828; border-color: #ef9a9a; } /* Kırmızı */
        .leaderboard-item.color-5 { background-color: #e3f2fd; color: #1565c0; border-color: #90caf9; } /* Mavi */
        .leaderboard-item.color-6 { background-color: #fbe9e7; color: #d84315; border-color: #ffab91; } /* Koyu Turuncu */
        .leaderboard-item.color-7 { background-color: #f1f8e9; color: #558b2f; border-color: #c5e1a5; } /* Açık Yeşil */
        .leaderboard-item.color-8 { background-color: #ede7f6; color: #4527a0; border-color: #b39ddb; } /* Koyu Mor */
        .leaderboard-item.color-9 { background-color: #e8f5e9; color: #2e7d32; border-color: #a5d6a7; } /* Yeşil (tekrar) */


        .leaderboard-item.active-participant {
            background-color: #fcd34d !important; /* Aktif katılımcı için sarı */
            font-weight: 600;
            border: 2px solid #d97706 !important; /* Daha koyu sarı vurgu */
            box-shadow: 0 4px 10px rgba(252, 211, 77, 0.4); /* Daha belirgin gölge */
            transform: translateY(-3px); /* Hafif kaldırma */
        }
        .leaderboard-rank {
            font-weight: 700;
            color: inherit; /* Ebeveyninden rengi miras al */
            margin-right: 0.6rem; /* Sıralama sonrası boşluk azaltıldı */
            min-width: 20px; /* Sıralama numaraları için boşluk sağla */
            text-align: right;
            font-size: 0.9em; /* Font boyutu daha da ayarlandı */
            flex-shrink: 0; /* Küçülmeyi önle */
        }
        .leaderboard-name {
            flex-grow: 1;
            font-weight: 600; /* Daha kalın isim */
            font-size: 1em; /* Font boyutu daha da ayarlandı */
            margin-right: 0.6rem; /* İsim sonrası boşluk azaltıldı */
            text-align: left;
            white-space: nowrap; /* İsmi tek satırda tut */
            overflow: hidden; /* Taşmayı gizle */
            text-overflow: ellipsis; /* Taşma için üç nokta ekle */
            min-width: 50px; /* İsim için minimum genişlik sağla */
        }
        .leaderboard-score {
            font-weight: 800; /* Daha da kalın skor */
            color: inherit; /* Ebeveyninden rengi miras al */
            font-size: 1.2em; /* Daha iyi uyum için font boyutu hafifçe azaltıldı */
            white-space: nowrap; /* Skorun sarılmasını önle */
            flex-shrink: 0; /* Küçülmeyi önle */
            min-width: 60px; /* Skor için minimum genişlik sağla */
            text-align: right; /* Skoru sağa hizala */
        }
        /* SON: Lider Tablosu Listesi Stilleri */


        .current-participant-display {
            font-size: 1.5rem; /* Metin boyutu büyütüldü */
            font-weight: 700;
            color: #6366f1;
            margin: 0.5rem; /* Ekran etrafında boşluk */
            text-align: center; /* Ekranı ortala */
        }
        .question-area {
            min-height: 180px; /* Soru alanı için minimum yükseklik artırıldı */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-bottom: 0; /* Boşluk kaldırıldı */
            flex-grow: 1; /* Soru alanının büyümesine izin ver */
        }
        .question-block {
            padding: 2rem; /* Soru bloğu için padding artırıldı */
            background-color: #e3f2fd; /* Soru alanı için yeni renk */
            border-radius: 8px;
            border: 1px solid #90caf9; /* Daha belirgin çerçeve */
            width: 100%;
            box-sizing: border-box;
            /* "Kutu açma" efekti için eklendi */
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            margin-bottom: 1.5rem; /* Geri bildirimden ayırmak için margin eklendi */
        }
        .question-block.question-block-closed {
            opacity: 0;
            transform: scale(0.8);
        }
        .question-text {
            font-size: 1.6rem; /* Soru metni boyutu daha da büyütüldü */
            margin-bottom: 1.8rem;
            font-weight: 500;
            line-height: 1.8;
        }
        .question-points {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background-color: #d1e7dd; /* Puanlar için açık yeşil arka plan */
            border-radius: 6px;
            display: inline-block; /* Padding'in etkili olması için */
        }
        .options-container {
            display: flex;
            flex-direction: row; /* Seçenekler yan yana */
            flex-wrap: wrap; /* Daha küçük ekranlarda sarılmaya izin ver */
            justify-content: center;
            gap: 1.2rem; /* Kutular arasındaki boşluk artırıldı */
            margin-top: 1.5rem;
        }
        .option-label {
            display: flex; /* İçeriği kutu içinde ortalamak için flex'i koru */
            align-items: center;
            justify-content: center; /* Metin ve radyo düğmesini ortala */
            cursor: pointer;
            padding: 1.2rem 1.8rem; /* Kutu hissi için padding artırıldı */
            border-radius: 10px; /* Daha yuvarlak köşeler */
            transition: all 0.2s ease-in-out; /* Hover/aktif için yumuşak geçiş */
            flex-basis: calc(50% - 0.6rem); /* Tam olarak yarısı eksi boşluğun yarısı */
            max-width: calc(50% - 0.6rem); /* Bir satırda en fazla iki tane olmasını sağlar */
            min-width: 200px; /* Her seçenek kutusu için minimum genişlik artırıldı */
            box-sizing: border-box;
            font-size: 1.35rem; /* Cevap metni boyutu daha da büyütüldü */
            font-weight: 500;
            text-align: center; /* Metnin ortalanmasını sağla */
            border: 2px solid transparent; /* Varsayılan şeffaf çerçeve */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Hafif gölge */
        }
        .option-label:hover {
            transform: translateY(-3px); /* Hover'da kaldırma efekti */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
        }
        .option-label input[type="radio"] {
            /* Radyo düğmesini görsel olarak gizle, ancak işlevsel tut */
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none; /* Tıklamaların etikete geçmesini sağla */
        }

        /* Seçenek kutusu renkleri için yeni sınıflar */
        .option-color-1 { background-color: #dbeafe; border-color: #93c5fd; color: #1e40af; } /* Mavi */
        .option-color-2 { background-color: #d1fae5; border-color: #6ee7b7; color: #065f46; } /* Yeşil */
        .option-color-3 { background-color: #ffe4e6; border-color: #fca5a5; color: #be123c; } /* Kırmızı */
        .option-color-4 { background-color: #fffbeb; border-color: #fcd34d; color: #92400e; } /* Sarı */
        .option-color-5 { background-color: #e0e7ff; border-color: #a78bfa; color: #4338ca; } /* İndigo */


        /* Yeni kutu stili için doğru/yanlış vurgularını ayarla */
        .option-label.correct-option-highlight {
            background-color: #a7f3d0 !important; /* Doğru için daha parlak yeşil */
            border-color: #065f46 !important; /* Daha koyu yeşil çerçeve */
            color: #065f46 !important;
            transform: none; /* Vurguda kaldırma yok */
            box-shadow: 0 4px 10px rgba(6, 95, 70, 0.2);
        }
        .option-label.incorrect-selected-option {
            background-color: #fecaca !important; /* Yanlış seçilen için açık kırmızı */
            border-color: #991b1b !important; /* Daha koyu kırmızı çerçeve */
            color: #991b1b !important;
            transform: none; /* Vurguda kaldırma yok */
            box-shadow: 0 4px 10px rgba(153, 27, 27, 0.2);
        }

        /* Metnin görünür ve ortalanmış olmasını sağla */
        .option-label span {
            display: block;
            width: 100%;
        }

        /* Daha küçük ekranlar için duyarlı ayarlamalar */
        @media (max-width: 640px) {
            .option-label {
                max-width: 100%; /* Küçük ekranlarda tam genişlik */
                min-width: unset;
                flex-basis: 100%; /* Küçük ekranlarda tam genişlik */
            }
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 0; /* Boşluk kaldırıldı */
        }
        .action-button {
            padding: 0.9rem 2.2rem; /* Buton paddingi büyütüldü */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); /* Varsayılan gölge, belirli buton stilleri tarafından geçersiz kılınır */
        }
        .action-button:hover {
            transform: translateY(-2px);
        }
        .action-button:active {
            transform: translateY(0);
        }
        .action-button:disabled {
            background-color: #a7a7a7 !important;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .feedback-message {
            text-align: center;
            margin-top: 1.5rem; /* Soru bloğundan boşluk sağla */
            font-size: 1.3rem; /* Geri bildirim metin boyutu büyütüldü */
            font-weight: 600;
            padding: 0.9rem; /* Geri bildirim paddingi büyütüldü */
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.5s ease;
            display: flex; /* İçeriği ortalamak için flex kullan */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* İkon ve metin arasındaki boşluk */
        }
        .feedback-message.show {
            opacity: 1;
        }
        .feedback-message.incorrect {
            background-color: #fee2e2; /* Açık Kırmızı */
            color: #b91c1c; /* Daha Koyu Kırmızı */
            border: 1px solid #fca5a5;
        }
        .feedback-message.correct {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .explanation-text {
            font-size: 1.1rem; /* Açıklama metin boyutu büyütüldü */
            font-weight: 400;
            margin-top: 0.6rem;
            color: #4a5568;
        }
        .score-display {
            text-align: center;
            font-size: 1.6rem; /* Skor göstergesi metin boyutu büyütüldü */
            font-weight: 700;
            margin-top: 2rem;
            padding: 1.1rem;
            background-color: #e0f2fe;
            border-radius: 8px;
            color: #0c4a6e;
        }
        .question-counter {
            font-size: 1.2rem; /* Soru sayacı metin boyutu büyütüldü */
            font-weight: 500;
            color: #555;
            margin-bottom: 1.1rem;
        }
        .question-navigation {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.9rem; /* Kutular arasındaki boşluk artırıldı */
            margin-bottom: 2.2rem;
            padding: 1.2rem;
            background-color: #e0f2fe;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
        }
        .question-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px; /* Kutu genişliği artırıldı */
            height: 50px; /* Kutu yüksekliği artırıldı */
            border-radius: 8px; /* Daha yuvarlak köşeler */
            background-color: #bfdbfe;
            color: #1e40af;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 1.2rem; /* Soru navigasyon öğesi metin boyutu büyütüldü */
        }
        .question-nav-item:hover {
            background-color: #93c5fd;
            transform: translateY(-2px);
        }
        .question-nav-item.active-question {
            background-color: #3b82f6;
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        .question-nav-item.answered-correctly {
            background-color: #a7f3d0; /* Yeşil-200 */
            color: #065f46; /* Yeşil-800 */
        }
        /* .answered-incorrectly stilini kaldırıldı, cevaplanmamış bir soru gibi görünmesini sağlamak için */
        /* .question-nav-item.answered-incorrectly {
            background-color: #fecaca;
            color: #991b1b;
        } */
        /* answered-incorrectly için disabled-selection kaldırıldı, yeniden seçime izin vermek için */
        /* .question-nav-item.disabled-selection {
            cursor: not-allowed;
            opacity: 0.6;
        } */
        .hidden {
            display: none !important; /* Diğer stilleri geçersiz kıldığını sağla */
        }
        .feedback-icon {
            font-size: 1.3em;
            margin-right: 0.4em;
        }
        .timer-display {
            font-size: 1.3rem; /* Zamanlayıcı metin boyutu büyütüldü */
            font-weight: 600;
            color: #ef4444; /* Zamanlayıcı için kırmızı renk */
            margin-bottom: 1.1rem;
            text-align: center;
        }
        .timer-display.warning {
            color: #f59e0b; /* Uyarı için turuncu */
        }
        .timer-display.critical {
            color: #dc2626; /* Kritik için daha koyu kırmızı */
        }
        .player-selection-screen { /* Genel kullanım için .main-screen-layout olarak yeniden adlandırıldı */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 2.2rem;
            text-align: center;
        }
        .player-selection-screen h2 {
            font-size: 2.5rem; /* Başlık boyutu büyütüldü */
            font-weight: 600;
            color: #2c3e50;
        }
        .player-selection-screen .action-button {
            min-width: 220px;
        }
        .selection-buttons { /* .selection-buttons olarak yeniden adlandırıldı */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
        }
        /* LLM açıklaması için yeni stiller */
        .detailed-explanation-container {
            margin-top: 1.8rem;
            padding: 1.2rem;
            background-color: #f0f9ff;
            border: 1px solid #a5d8ff;
            border-radius: 8px;
            font-size: 1.1rem; /* Detaylı açıklama metin boyutu büyütüldü */
            color: #2c3e50;
            line-height: 1.6;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; /* Açık gri */
            border-top: 44px solid #3498db; /* Mavi */
            border-radius: 50%;
            width: 28px; /* Spinner boyutu büyütüldü */
            height: 28px; /* Spinner boyutu büyütüldü */
            animation: spin 1s linear infinite;
            margin: 1.2rem auto;
            display: none; /* Varsayılan olarak gizli */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Soru için tam ekran kaplama */
        #fullscreen-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Yarı şeffaf siyah */
            z-index: 40;
            opacity: 0;
            visibility: hidden; /* Başlangıç durumu için gizli olarak değiştirildi */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        #fullscreen-overlay.show {
            opacity: 1;
            visibility: visible; /* Gösterildiğinde görünür olarak değiştirildi */
        }

        /* Tam ekran soru konteyneri */
        #quiz-content.fullscreen-active {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 50;
            background-color: #e6f0f5; /* Konteyner arka planıyla eşleş */
            border-radius: 0; /* Tam ekran için yuvarlak köşeler yok */
            box-shadow: none; /* Tam ekran için gölge yok */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* İçerik yukarıdan başlar */
            padding: 2.5rem 1.5rem; /* Duyarlı padding artırıldı */
            overflow-y: auto; /* Uzun sorular için kaydırmayı etkinleştir */
            transition: all 0.5s ease-in-out;
        }

        #quiz-content.fullscreen-active #timer-display {
            margin-top: 1.2rem; /* Ekranın üstünden boşluk */
            margin-bottom: 1.2rem; /* Soru bloğundan önce boşluk */
            font-size: 2rem; /* Tam ekranda zamanlayıcı font boyutu */
            width: 100%;
            text-align: center;
            color: #ef4444; /* Zamanlayıcı rengini koru */
        }

        #quiz-content.fullscreen-active .question-area {
            flex-grow: 1; /* Mevcut alanı kapla */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Alan izin verirse içeriği dikey olarak ortala */
            align-items: center;
            width: 100%;
            max-width: 900px; /* Tam ekranda soru içeriği için maksimum genişlik artırıldı */
            margin: 0 auto; /* Soru içeriğini yatay olarak ortala */
        }

        #quiz-content.fullscreen-active .question-block {
            width: 100%; /* Soru bloğunun ebeveynini doldurmasını sağla */
            padding: 2rem; /* Tam ekranda soru bloğu için padding artırıldı */
            box-sizing: border-box; /* Genişliğe padding'i dahil et */
            background-color: #e3f2fd;
            border-radius: 8px;
            border: 1px solid #90caf9;
            /* Açılış animasyon stillerini koru */
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            margin-bottom: 1.5rem; /* Geri bildirimden ayırmak için margin eklendi */
        }

        #quiz-content.fullscreen-active .button-group {
            margin-top: 2.5rem; /* Tam ekranda butonlar için margin-top artırıldı */
            width: 100%; /* Butonların tam ekran görünümünde ortalanmasını sağla */
            max-width: 900px; /* Tam ekranda butonlar için maksimum genişlik */
        }
        .question-screen-instruction-message {
            text-align: center;
            font-size: 1.1rem; /* Tutarlılık için ayarlandı */
            font-weight: 500;
            color: #555;
            margin-top: 1rem; /* Daha iyi boşluk için margin artırıldı */
        }

        .option-label.selected-animation {
            animation: pulse-selected 0.3s ease-out forwards;
        }

        .option-label.correct-animation {
            animation: pop-correct 0.4s ease-out forwards;
        }

        .option-label.incorrect-animation {
            animation: shake-incorrect 0.5s ease-out forwards;
        }

        @keyframes pulse-selected {
            0% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); }
            50% { transform: scale(1.02); box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15); }
            100% { transform: scale(1); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); }
        }

        @keyframes pop-correct {
            0% { transform: scale(1); box-shadow: 0 4px 10px rgba(6, 95, 70, 0.2); }
            50% { transform: scale(1.05); box-shadow: 0 8px 20px rgba(6, 95, 70, 0.4); }
            100% { transform: scale(1); box-shadow: 0 4px 10px rgba(6, 95, 70, 0.2); }
        }

        @keyframes shake-incorrect {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .feedback-message.animate-in {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .participant-name-input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 400px;
        }

        .participant-name-input {
            padding: 0.8rem;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1.1rem;
            color: #333;
            transition: border-color 0.2s ease;
        }

        .participant-name-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Katılımcı Seçim Modalı Stilleri */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #e6f0f5;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 95%; /* Genişlik artırıldı */
            max-width: 1000px; /* Modal için maksimum genişlik artırıldı */
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            position: relative; /* Kapatma düğmesinin mutlak konumlandırılması için gerekli */
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }

        .modal-content select,
        .modal-content input[type="text"],
        .modal-content input[type="number"] { /* Sayı girişi stili eklendi */
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1.1rem;
            color: #333;
            background-color: #ffffff;
        }

        .modal-content .button-group {
            margin-top: 1.5rem;
            gap: 0.8rem;
        }
        .modal-content .action-button {
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
        }

        /* Takım kurulum modalı için yeni stiller */
        #team-setup-modal .team-name-inputs {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        /* Modallar için kapatma düğmesi */
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #666;
            transition: color 0.2s ease;
            padding: 0.5rem;
            line-height: 1; /* 'X'i ortalamak için satır yüksekliğini ayarla */
        }

        .modal-close-button:hover {
            color: #333;
        }

        /* Mevcut katılımcı butonları için stiller */
        #existing-participants-buttons {
            display: grid; /* Daha iyi kontrol için ızgaraya değiştirildi */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Duyarlı sütunlar */
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            max-height: 300px; /* Daha fazla giriş için yükseklik artırıldı */
            overflow-y: auto;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f8fafc;
        }
        .participant-item-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.8rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            position: relative; /* Seçili gösterge için konumlandırma */
        }
        .participant-item-wrapper.selected-participant {
            background-color: #e0f2fe; /* Seçili için açık mavi arka plan */
            border-color: #90caf9; /* Seçili için mavi çerçeve */
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.2);
        }
        .participant-item-wrapper.selected-participant::after {
            content: '✓'; /* Seçili için onay işareti */
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            color: #10b981; /* Yeşil onay işareti */
            font-size: 1.5rem;
            font-weight: bold;
        }

        .participant-name-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            text-align: center;
            word-break: break-word; /* Uzun isimlerin kırılmasına izin ver */
            overflow-wrap: break-word; /* Uzun kelimelerin sarılmasını sağla */
        }
        .participant-edit-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            justify-content: center;
            width: 100%;
        }
        .participant-edit-controls .action-button {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            min-width: unset; /* Genel action-button'dan min-width'i geçersiz kıl */
            flex-grow: 1;
        }
        .edit-participant-modal-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1.1rem;
            color: #333;
            background-color: #ffffff;
            margin-bottom: 1rem;
        }
        .edit-participant-modal-input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Ana ekran butonları için metni küçültmek ve tek satırda tutmak için özel stiller */
        .main-action-button {
            font-size: 0.9rem; /* Daha küçük font boyutu */
            padding: 0.6rem 1rem; /* Azaltılmış padding */
            flex-shrink: 0; /* Küçülmeyi önle */
            white-space: nowrap; /* Metni tek satırda tut */
        }

        @media (max-width: 640px) {
            .main-action-button {
                font-size: 0.8rem; /* Çok küçük ekranlarda daha da küçük */
                padding: 0.5rem 0.8rem;
            }
        }
    </style>
    <script type="module">
        // Yerel Depolama Anahtarları
        const LOCAL_STORAGE_KEY_TEAMS = 'quizGameTeams';
        const LOCAL_STORAGE_KEY_CURRENT_UNIT = 'quizGameCurrentUnit';
        const LOCAL_STORAGE_KEY_GAME_MODE = 'quizGameMode';
        const LOCAL_STORAGE_KEY_ANSWERED_QUESTIONS = 'quizGameAnsweredQuestions';

        // Genel Oyun Durumu Değişkenleri
        window.teams = []; // { id: 'uuid', name: 'Takım Adı', score: 0 } gibi nesneleri saklamak için dizi
        window.currentTeamId = null; // Şu anda aktif olan takımın ID'si
        window.currentQuestionIndex = 0; // Bu, artık `shuffledQuestions` dizisindeki indeks olacak
        window.answeredQuestions = {}; // {questionId: {solvedByTeamId: teamId, userAnswer: string, timeTaken: number}} saklar
        let timer = 30; // Zamanlayıcı 30 saniyeye ayarlandı
        let timerInterval;
        let shuffledQuestions = []; // Bu dizi, mevcut ünite için karıştırılmış soruları tutar
        window.currentUnit = null;
        let initialTimerValue = 30; // Başlangıç zamanlayıcı değeri 30 saniyeye ayarlandı
        window.gameMode = null; // 'individual' veya 'team'
        window.selectedQuestionIdForModal = null; // Tıklanan sorunun ID'sini saklamak için yeni genel değişken
        let selectedParticipantIdInModal = null; // Katılımcı seçim modalında seçimi izlemek için
        let participantIdToEdit = null; // Düzenlenen katılımcıyı izlemek için

        // Tone.js ses sentezleyicileri
        let correctSynth;
        let incorrectSynth;
        let timerSynth;

        // Her ünite için arka plan temaları eşlemesi
        const backgroundThemes = {
            'unit1': 'url("https://placehold.co/1920x1080/81D4FA/000000?text=Melek+ve+Ahiret+%C4%B0nanc%C4%B1")',
            'unit2': 'url("https://placehold.co/1920x1080/FFCDD2/000000?text=Hac+ve+Kurban")',
            'unit3': 'url("https://placehold.co/1920x1080/B3E5FC/000000?text=Ahlaki+Davran%C4%B1%C5%9Flar")',
            'unit4': 'url("https://placehold.co/1920x1080/C8E6C9/000000?text=Allah%27%C4%B1n+Kulu+ve+El%C3%A7isi+Hz.+Muhammed+(s.a.v.))")',
            'unit5': 'url("https://placehold.co/1920x1080/FFF9C4/000000?text=%C4%B0slam+D%C3%BC%C5%9F%C3%BCncesinde+Yorumlar")',
            'general': 'url("https://placehold.co/1920x1080/E0F2F7/000000?text=Din+K%C3%BClt%C3%BCr%C3%BC+Bilgi+Yar%C4%B1%C5%9Fmas%C4%B1")'
        };

        /**
         * Gövdenin arka plan resmini sağlanan tema anahtarına göre ayarlar.
         * @param {string} themeKey - Arka plan temasına karşılık gelen anahtar.
         */
        function setGameBackground(themeKey) {
            const imageUrl = backgroundThemes[themeKey] || backgroundThemes['general'];
            document.body.style.backgroundImage = imageUrl;
        }

        // Her ünite için sorular (7. Sınıf DKAB müfredatına göre güncellendi)
        const unitQuestions = {
            'unit1': [ // 1. ÜNİTE: Melek ve Ahiret İnancı
                { id: 'u1_tf1', type: 'trueFalse', question: "Gayb alemi, akıl ve duyularla bilinebilen varlık alanıdır.", answer: "Y", explanation: "Gayb alemi, akıl ve duyular yoluyla hakkında bilgi edinilemeyen varlık alanıdır.", theme: 'unit1', relatedConcept: "Gayb Alemi" },
                { id: 'u1_tf2', type: 'trueFalse', question: "Melekler, nurdan yaratılmış varlıklardır.", answer: "D", explanation: "Melekler, Allah'ın (cc) emir ve yasaklarını eksiksiz bir şekilde yerine getiren, nurdan yaratılmış varlıklardır.", theme: 'unit1', relatedConcept: "Melekler" },
                { id: 'u1_tf3', type: 'trueFalse', question: "Cebrail, kıyamet gününde sûra üflemekle görevli melektir.", answer: "Y", explanation: "Cebrail, vahiy meleğidir. İsrafil ise sûra üflemekle görevlidir.", theme: 'unit1', relatedConcept: "Cebrail" },
                { id: 'u1_tf4', type: 'trueFalse', question: "Ahiret, dünya hayatından sonra başlayıp ebediyen devam edecek olan hayattır.", answer: "D", explanation: "Ahiret, ölümden sonraki sonsuz yaşamdır.", theme: 'unit1', relatedConcept: "Ahiret" },
                { id: 'u1_tf5', type: 'trueFalse', question: "Mizan, mahşerde sevap ve günahların tartılacağı manevi terazidir.", answer: "D", explanation: "Mizan, ahirette amellerin tartılacağı ilahi adaletin tecellisidir.", theme: 'unit1', relatedConcept: "Mizan" },
                { id: 'u1_tf6', type: 'trueFalse', question: "Cinler, insanlar gibi ilahi emirlere uymakla yükümlü tutulmazlar.", answer: "Y", explanation: "Cinler de insanlar gibi Allah'a ibadet etmekle yükümlüdürler.", theme: 'unit1', relatedConcept: "Cinler" },
                { id: 'u1_tf7', type: 'trueFalse', question: "Şeytan, insana sadece iyi şeyler fısıldar.", answer: "Y", explanation: "Şeytan, insana sık sık rahatsızlık verip onu saptırmaya çalışan ruhani varlıktır.", theme: 'unit1', relatedConcept: "Şeytan" },
                { id: 'u1_tf8', type: 'trueFalse', question: "Kiramen Kâtibîn melekleri, insanların rızıklarını paylaştırmakla görevlidir.", answer: "Y", explanation: "Kiramen Kâtibîn melekleri, insanların iyiliklerini ve kötülüklerini yazmakla görevlidir. Mikail rızıklarla görevlidir.", theme: 'unit1', relatedConcept: "Kiramen Katibin" },
                { id: 'u1_tf9', type: 'trueFalse', question: "Berzah alemi, ölümden sonraki kabir hayatıdır.", answer: "D", explanation: "Berzah alemi, ruhların tekrar dirilişe kadar beklediği ara alemdir.", theme: 'unit1', relatedConcept: "Berzah Alemi" },
                { id: 'u1_tf10', type: 'trueFalse', question: "Cennet, iman etmiş ve salih ameller işlemiş kişilerin cezalandırılacağı yerdir.", answer: "Y", explanation: "Cennet, iman etmiş ve salih ameller işlemiş kişilerin ödüllendirileceği mükâfat yurdudur.", theme: 'unit1', relatedConcept: "Cennet" },
                { id: 'u1_fb1', type: 'fillInTheBlanks', question: "Allah'ın (cc) dışında, akıl ve duyu organlarıyla bilinebilen veya varlığı düşünülebilen bütün varlıklara ........................ denir.", answer: "âlem", options: ["âlem", "gayb", "melek", "cin"], explanation: "Âlem, evrendeki tüm varlıkları kapsar.", theme: 'unit1', relatedConcept: "Âlem" },
                { id: 'u1_fb2', type: 'fillInTheBlanks', question: "Kıyamet gününde sûra üflemekle görevli melek ........................'dir.", answer: "İsrafil", options: ["İsrafil", "Cebrail", "Mikail", "Azrail"], explanation: "İsrafil, kıyametin kopuşunu ve yeniden dirilişi bildiren melektir.", theme: 'unit1', relatedConcept: "İsrafil" },
                { id: 'u1_fb3', type: 'fillInTheBlanks', question: "Yaşam süresini tamamlayanların canını almakla görevli melek ........................'dir.", answer: "Azrail", options: ["Azrail", "Cebrail", "Mikail", "İsrafil"], explanation: "Azrail, ölüm meleği olarak bilinir.", theme: 'unit1', relatedConcept: "Azrail" },
                { id: 'u1_fb4', type: 'fillInTheBlanks', question: "Hesaba çekilmek için tüm insanların bir meydanda toplanmasına ........................ denir.", answer: "haşr", options: ["haşr", "ba's", "mizan", "sırat"], explanation: "Haşr, mahşer yerinde toplanmayı ifade eder.", theme: 'unit1', relatedConcept: "Haşr" },
                { id: 'u1_fb5', type: 'fillInTheBlanks', question: "Cehennemin üzerinden geçen, geçmesi zor olan köprüye ........................ denir.", answer: "Sırat Köprüsü", options: ["Sırat Köprüsü", "Cennet Köprüsü", "Mahşer Köprüsü", "Cehennem Köprüsü"], explanation: "Sırat Köprüsü, cennete gidenlerin geçeceği yoldur.", theme: 'unit1', relatedConcept: "Sırat Köprüsü" },
                { id: 'u1_mc1', type: 'multipleChoice', question: "Aşağıdakilerden hangisi dört büyük melekten biri değildir?", options: ["Cebrail", "Mikail", "Azrail", "Hafaza"], answer: "Hafaza", explanation: "Hafaza melekleri, insanları korumakla görevli meleklerdir, dört büyük melekten biri değildir.", theme: 'unit1', relatedConcept: "Melekler" },
                { id: 'u1_mc2', type: 'multipleChoice', question: "Ölümden sonra başlayıp ebediyen devam edecek olan hayatın adı nedir?", options: ["Dünya", "Berzah", "Ahiret", "Kıyamet"], answer: "Ahiret", explanation: "Ahiret, sonsuz yaşamın adıdır.", theme: 'unit1', relatedConcept: "Ahiret" },
                { id: 'u1_mc3', type: 'multipleChoice', question: "Kur'an-ı Kerim'in 114. ve son suresi aşağıdakilerden hangisidir?", options: ["Felak Suresi", "İhlas Suresi", "Nas Suresi", "Kevser Suresi"], answer: "Nas Suresi", explanation: "Nas Suresi, Kur'an'ın son suresidir ve insanlardan ve cinlerden gelen vesveselerden Allah'a sığınmayı anlatır.", theme: 'unit1', relatedConcept: "Nas Suresi" },
                { id: 'u1_mc4', type: 'multipleChoice', question: "Hz. İsa'ya iman edip ona tabi olan on iki kişiye ne ad verilir?", options: ["Ashab", "Ensar", "Muhacir", "Havâri"], answer: "Havâri", explanation: "Havâriler, Hz. İsa'nın en yakın takipçileridir.", theme: 'unit1', relatedConcept: "Havâri" },
                { id: 'u1_mc5', type: 'multipleChoice', question: "Allah'ın (cc) her şeyin sahibi, hâkimi ve idare edicisi olması hangi ismiyle ifade edilir?", options: ["Rab", "Melik", "İlah", "Vesvâs"], answer: "Melik", explanation: "Melik, Allah'ın mutlak hükümdar olduğunu ifade eder.", theme: 'unit1', relatedConcept: "Esma-ül Hüsna" }
            ],
            'unit2': [ // 2. ÜNİTE: Hac ve Kurban
                { id: 'u2_tf1', type: 'trueFalse', question: "Hac, belirli bir vakitte, belirli kutsal mekânları ziyaret etmektir.", answer: "D", explanation: "Hac, İslam'ın beş şartından biridir ve Kâbe ile çevresindeki kutsal mekanların ziyaretini içerir.", theme: 'unit2', relatedConcept: "Hac" },
                { id: 'u2_tf2', type: 'trueFalse', question: "İhram, hac veya umre yapmaya niyet eden kişinin normalde mubah olan bazı fiilleri kendine haram kılmasıdır.", answer: "D", explanation: "İhram, hac ve umre ibadetlerinin şartlarından biridir ve belirli yasakları içerir.", theme: 'unit2', relatedConcept: "İhram" },
                { id: 'u2_tf3', type: 'trueFalse', question: "Tavaf, Kâbe'nin etrafında beş kez dönmekten ibaret bir ibadettir.", answer: "Y", explanation: "Tavaf, Kâbe'nin etrafında yedi kez dönmektir.", theme: 'unit2', relatedConcept: "Tavaf" },
                { id: 'u2_tf4', type: 'trueFalse', question: "Arafat vakfesi, haccın farzlarından biridir.", answer: "D", explanation: "Arafat'ta belirli bir vakitte bulunmak, haccın en önemli farzıdır.", theme: 'unit2', relatedConcept: "Arafat Vakfesi" },
                { id: 'u2_tf5', type: 'trueFalse', question: "Umre, hac mevsiminde yapılan bir ibadettir.", answer: "Y", explanation: "Umre, hac mevsimi dışında yapılabilen, daha kısa bir ibadettir.", theme: 'unit2', relatedConcept: "Umre" },
                { id: 'u2_tf6', type: 'trueFalse', question: "Kurban, sadece et yemek için kesilen bir hayvandır.", answer: "Y", explanation: "Kurban, belli nitelikleri olan bir hayvanı belirli günlerde ibadet niyetiyle kesmektir.", theme: 'unit2', relatedConcept: "Kurban" },
                { id: 'u2_tf7', type: 'trueFalse', question: "Adak kurbanı, kişinin bir dileği gerçekleştiğinde kesilen kurbandır.", answer: "D", explanation: "Adak kurbanı, bir şarta bağlı olarak Allah'a verilen sözün yerine getirilmesidir.", theme: 'unit2', relatedConcept: "Adak Kurbanı" },
                { id: 'u2_tf8', type: 'trueFalse', question: "Hz. İsmail, Hz. İbrahim'in oğlu ve Kâbe'yi onunla birlikte inşa eden peygamberdir.", answer: "D", explanation: "Hz. İsmail, Kâbe'nin inşasında babası Hz. İbrahim'e yardım etmiştir.", theme: 'unit2', relatedConcept: "Hz. İsmail" },
                { id: 'u2_tf9', type: 'trueFalse', question: "Say, Safa ve Merve tepeleri arasında üç kez yürümektir.", answer: "Y", explanation: "Say, Safa ve Merve tepeleri arasında gidiş dönüş şeklinde toplam yedi kez yürümektir.", theme: 'unit2', relatedConcept: "Say" },
                { id: 'u2_tf10', type: 'trueFalse', question: "Zemzem, Kâbe'de bulunan kutsal bir sudur.", answer: "D", explanation: "Zemzem, Mekke'de bulunan tarihi ve kutsal bir kuyudan çıkan sudur.", theme: 'unit2', relatedConcept: "Zemzem" },
                { id: 'u2_fb1', type: 'fillInTheBlanks', question: "Hac veya umre yapmaya niyet eden kişinin giydiği özel elbiseye ........................ denir.", answer: "ihram", options: ["ihram", "cuba", "kaftan", "entari"], explanation: "İhram, hac ve umre ibadetlerinin önemli bir parçasıdır.", theme: 'unit2', relatedConcept: "İhram" },
                { id: 'u2_fb2', type: 'fillInTheBlanks', question: "Kâbe'nin etrafında yedi kez dönmeye ........................ denir.", answer: "tavaf", options: ["tavaf", "say", "vakfe", "şeytan taşlama"], explanation: "Tavaf, Kâbe'yi ziyaret edenlerin yaptığı bir ibadettir.", theme: 'unit2', relatedConcept: "Tavaf" },
                { id: 'u2_fb3', type: 'fillInTheBlanks', question: "Zilhicce ayının dokuzunda Arafat'ta bulunup dua etmeye ........................ denir.", answer: "Arafat Vakfesi", options: ["Arafat Vakfesi", "Müzdelife Vakfesi", "Mina Vakfesi", "Kudüm Tavafı"], explanation: "Arafat vakfesi, haccın en önemli rükünlerinden biridir.", theme: 'unit2', relatedConcept: "Arafat Vakfesi" },
                { id: 'u2_fb4', type: 'fillInTheBlanks', question: "Doğan çocuk için Allah'a (cc) şükür amacıyla kesilen kurbana ........................ denir.", answer: "akika kurbanı", options: ["akika kurbanı", "adak kurbanı", "şükür kurbanı", "heydi kurbanı"], explanation: "Akika kurbanı, yeni doğan çocuk için kesilen bir şükür kurbanıdır.", theme: 'unit2', relatedConcept: "Akika Kurbanı" },
                { id: 'u2_fb5', type: 'fillInTheBlanks', question: "Mekke şehri ve etrafındaki ihram giyilmesinin zorunlu olduğu geniş alana ........................ denir.", answer: "Harem Bölgesi", options: ["Harem Bölgesi", "Mikat Sınırı", "Arafat", "Müzdelife"], explanation: "Harem Bölgesi, belirli dini kuralların geçerli olduğu kutsal alandır.", theme: 'unit2', relatedConcept: "Harem Bölgesi" },
                { id: 'u2_mc1', type: 'multipleChoice', question: "Hac ibadetinde bayramın ilk gününden itibaren kesilen kurbana ne ad verilir?", options: ["Adak Kurbanı", "Akika Kurbanı", "Hedy Kurbanı", "Şükür Kurbanı"], answer: "Hedy Kurbanı", explanation: "Hedy kurbanı, hac ibadetini tamamlayanların kestiği kurbandır.", theme: 'unit2', relatedConcept: "Hedy Kurbanı" },
                { id: 'u2_mc2', type: 'multipleChoice', question: "Hac ve umrede okunan, Allah’a (cc) olan teslimiyete dair duaya ne denir?", options: ["Telbiye", "Tekbir", "Teşbih", "Tahmid"], answer: "Telbiye", explanation: "Telbiye, hac ve umre sırasında 'Lebbeyk Allahümme Lebbeyk' şeklinde okunan duadır.", theme: 'unit2', relatedConcept: "Telbiye" },
                { id: 'u2_mc3', type: 'multipleChoice', question: "Mekke’deki Safa ve Merve tepeleri arasında gidiş dönüş şeklinde yedi kez yürümeye ne denir?", options: ["Tavaf", "Say", "Vakfe", "İhram"], answer: "Say", explanation: "Say, hac ve umre ibadetlerinin bir parçasıdır.", theme: 'unit2', relatedConcept: "Say" },
                { id: 'u2_mc4', type: 'multipleChoice', question: "Kurban Bayramı günlerinde cemre adı verilen yerlere yedişer taş atarak yapılan sembolik ibadete ne denir?", options: ["Tavaf", "Say", "Şeytan Taşlama", "Vakfe"], answer: "Şeytan Taşlama", explanation: "Şeytan taşlama, hac ibadetinin vaciplerindendir.", theme: 'unit2', relatedConcept: "Şeytan Taşlama" },
                { id: 'u2_mc5', type: 'multipleChoice', question: "Kur'an-ı Kerim'de koyun, deve, sığır gibi hayvanlara karşılık gelen kelime hangisidir?", options: ["Nüsük", "Enam", "Kurban", "Hedy"], answer: "Enam", explanation: "Enam, kurbanlık hayvanları ifade eden genel bir terimdir.", theme: 'unit2', relatedConcept: "Enam" }
            ],
            'unit3': [ // 3. ÜNİTE: Ahlaki Davranışlar
                { id: 'u3_tf1', type: 'trueFalse', question: "Ahlak, kişiler arası ilişkileri düzenleyen kurallar bütünüdür.", answer: "D", explanation: "Ahlak, bireyin ve toplumun davranışlarını şekillendiren değerler ve kurallarız.", theme: 'unit3', relatedConcept: "Ahlak" },
                { id: 'u3_tf2', type: 'trueFalse', question: "Adalet, her şeyin olması gerektiği yerde bulunmasıdır.", answer: "D", explanation: "Adalet, hak sahibine hakkını vermek ve doğru davranmaktır.", theme: 'unit3', relatedConcept: "Adalet" },
                { id: 'u3_tf3', type: 'trueFalse', question: "Sabır, hoşa gitmeyen olaylar karşısında şikayet etmek demektir.", answer: "Y", explanation: "Sabır, zorluklar karşısında dayanmak, Allah'a güvenmek ve isyan etmemektir.", theme: 'unit3', relatedConcept: "Sabır" },
                { id: 'u3_tf4', type: 'trueFalse', question: "İsar, kişinin kendi ihtiyacı varken başkalarına yardımda bulunmasıdır.", answer: "D", explanation: "İsar, cömertlik ve özverinin en üst düzeyidir.", theme: 'unit3', relatedConcept: "İsar" },
                { id: 'u3_tf5', type: 'trueFalse', question: "Sadaka, sadece maddi yardımları kapsar.", answer: "Y", explanation: "Sadaka, maddi ve manevi her türlü iyiliği kapsar.", theme: 'unit3', relatedConcept: "Sadaka" },
                { id: 'u3_tf6', type: 'trueFalse', question: "Sorumluluk, kişinin tutum ve davranışlarının sonuçlarını üstlenmesidir.", answer: "D", explanation: "Sorumluluk, bireyin eylemlerinin bilincinde olması ve ve sonuçlarını kabul etmesidir.", theme: 'unit3', relatedConcept: "Sorumluluk" },
                { id: 'u3_tf7', type: 'trueFalse', question: "Vatanseverlik, sadece kendi ülkesini sevmekle sınırlıdır.", answer: "Y", explanation: "Vatanseverlik, ülkesini sevmekle birlikte, ona faydalı olmak ve korumak için çaba göstermektir.", theme: 'unit3', relatedConcept: "Vatanseverlik" },
                { id: 'u3_tf8', type: 'trueFalse', question: "Hz. Salih, Semud kavmine gönderilen bir peygamberdir.", answer: "D", explanation: "Hz. Salih, Semud kavmini tevhide davet etmiştir.", theme: 'unit3', relatedConcept: "Hz. Salih" },
                { id: 'u3_tf9', type: 'trueFalse', question: "Felak Suresi, her türlü kötülükten Allah'a sığınmayı anlatır.", answer: "D", explanation: "Felak Suresi, Allah'tan korunma dilemeyi öğretir.", theme: 'unit3', relatedConcept: "Felak Suresi" },
                { id: 'u3_tf10', type: 'trueFalse', question: "Hâsid, kıskanan, haset eden kişidir.", answer: "D", explanation: "Hâsid, başkasının sahip olduğu nimeti çekemeyen kişidir.", theme: 'unit3', relatedConcept: "Haset" },
                { id: 'u3_fb1', type: 'fillInTheBlanks', question: "Bir insanın yaşadığı toplumun kültürüne göre şekillenmiş ahlaki unsurlara ........................ denir.", answer: "değer", options: ["değer", "tutum", "davranış", "ahlak"], explanation: "Değerler, toplumun kabul ettiği iyi ve doğru davranışlardır.", theme: 'unit3', relatedConcept: "Değer" },
                { id: 'u3_fb2', type: 'fillInTheBlanks', question: "Kişinin herhangi bir müdahaleye maruz kalmadan davranışlarını disiplin etme becerisine ........................ denir.", answer: "öz denetim", options: ["öz denetim", "sorumluluk", "sabır", "dürüstlük"], explanation: "Öz denetim, bireyin kendini kontrol etme yeteneğidir.", theme: 'unit3', relatedConcept: "Öz Denetim" },
                { id: 'u3_fb3', type: 'fillInTheBlanks', question: "Bir başkasına gösterilen hürmet, incelik, özen ve ölçülü davranmaya ........................ denir.", answer: "saygı", options: ["saygı", "sevgi", "dostluk", "adalet"], explanation: "Saygı, başkalarına karşı nazik ve düşünceli olmayı ifade eder.", theme: 'unit3', relatedConcept: "Saygı" },
                { id: 'u3_fb4', type: 'fillInTheBlanks', question: "Allah’ın (cc) rızasını kazanmak için insanın kendisine verilen malların şükrünün bir göstergesi olarak O’nun emrettiği yerlere harcama yapmasına ........................ denir.", answer: "infak", options: ["infak", "sadaka", "zekat", "kurban"], explanation: "İnfak, Allah yolunda harcama yapmaktır.", theme: 'unit3', relatedConcept: "İnfak" },
                { id: 'u3_fb5', type: 'fillInTheBlanks', question: "Semud kavminin Kur’an’da anıldığı diğer isim ........................'dir.", answer: "Ashabü’l-Hicr", options: ["Ashabü’l-Hicr", "Ashabü’l-Kehf", "Ashabü’l-Fil", "Ashabü’l-Uhdud"], explanation: "Ashabü’l-Hicr, Semud kavminin yaşadığı bölgeye atıfta bulunur.", theme: 'unit3', relatedConcept: "Ashabü'l-Hicr" },
                { id: 'u3_mc1', type: 'multipleChoice', question: "Aşağıdakilerden hangisi ahlaki davranışlardan biri değildir?", options: ["Dürüstlük", "Yardımseverlik", "Haset", "Sabır"], answer: "Haset", explanation: "Haset, kıskançlık ve başkasının iyiliğini istememek kötü bir ahlaktır.", theme: 'unit3', relatedConcept: "Ahlak" },
                { id: 'u3_mc2', type: 'multipleChoice', question: "İhtiyacı olana maddi veya manevi yardımda bulunmaya ne denir?", options: ["İnfak", "İsar", "Yardımseverlik", "Sadaka"], answer: "Yardımseverlik", explanation: "Yardımseverlik, başkalarına destek olmayı ifade eder.", theme: 'unit3', relatedConcept: "Yardımseverlik" },
                { id: 'u3_mc3', type: 'multipleChoice', question: "Maddi durumu iyi olanların fazladan ekmek parası ödeyerek ihtiyaç sahiplerine yardım etme geleneği nedir?", options: ["Zekat", "Fitre", "Askıda Ekmek", "Sadaka-i Cariye"], answer: "Askıda Ekmek", explanation: "Askıda Ekmek, Türk kültüründe yaygın bir yardımlaşma geleneğidir.", theme: 'unit3', relatedConcept: "Askıda Ekmek" },
                { id: 'u3_mc4', type: 'multipleChoice', question: "Kur'an-ı Kerim'in 113. suresi aşağıdakilerden hangisidir?", options: ["Nas Suresi", "İhlas Suresi", "Felak Suresi", "Kevser Suresi"], answer: "Felak Suresi", explanation: "Felak Suresi, kötülüklerden Allah'a sığınma duasıdır.", theme: 'unit3', relatedConcept: "Felak Suresi" },
                { id: 'u3_mc5', type: 'multipleChoice', question: "Yaratmak anlamına gelen kelime hangisidir?", options: ["Hâsid", "Gâsık", "Halk", "Vesvâs"], answer: "Halk", explanation: "Halk, Allah'ın yaratma sıfatını ifade eder.", theme: 'unit3', relatedConcept: "Halk" }
            ],
            'unit4': [ // 4. ÜNİTE: Allah'ın Kulu ve Elçisi Hz. Muhammed (s.a.v.) - GÜNCELLENDİ
                // Doğru / Yanlış
                { id: 'u4_tf1', type: 'trueFalse', question: "Hz. Muhammed (s.a.v.), diğer insanlar gibi bir beşer olup, yeme, içme, uyuma gibi insani özelliklere sahipti.", answer: "D", explanation: "Hz. Muhammed (s.a.v.) de bir insandı ve insani ihtiyaçları vardı. Onu ayıran vahiy almasıydı.", theme: 'unit4', relatedConcept: "Beşeriyet" },
                { id: 'u4_tf2', type: 'trueFalse', question: "Hz. Muhammed'i (s.a.v.) diğer insanlardan ayıran en temel özellik çok zengin olmasıydı.", answer: "Y", explanation: "Hz. Muhammed'i (s.a.v.) diğer insanlardan ayıran en temel özellik Allah'tan (c.c.) vahiy almasıydı.", theme: 'unit4', relatedConcept: "Vahiy" },
                { id: 'u4_tf3', type: 'trueFalse', question: "'Üsve-i Hasene' tabiri, Hz. Muhammed'in (s.a.v.) en güzel örnek olduğunu ifade eder.", answer: "D", explanation: "Kur'an-ı Kerim, Hz. Muhammed'i (s.a.v.) Müslümanlar için en güzel örnek (Üsve-i Hasene) olarak tanıtır.", theme: 'unit4', relatedConcept: "Üsve-i Hasene" },
                { id: 'u4_tf4', type: 'trueFalse', question: "Hz. Muhammed (s.a.v.) peygamberlik görevine Medine'de başlamıştır.", answer: "Y", explanation: "Hz. Muhammed (s.a.v.) peygamberlik görevine Mekke'de, Hira Mağarası'nda ilk vahyi alarak başlamıştır.", theme: 'unit4', relatedConcept: "Peygamberlik" },
                { id: 'u4_tf5', type: 'trueFalse', question: "Hicret, Müslümanların Mekke'den Medine'ye göç etmesidir.", answer: "D", explanation: "Mekke'deki baskıların artması üzerine Müslümanlar, Hz. Muhammed'in (s.a.v.) izniyle Medine'ye göç etmişlerdir.", theme: 'unit4', relatedConcept: "Hicret" },
                { id: 'u4_tf6', type: 'trueFalse', question: "Medine Sözleşmesi, Medine'deki farklı topluluklar arasında barış ve bir arada yaşama esaslarını belirlemiştir.", answer: "D", explanation: "Medine Sözleşmesi, Medine'de yaşayan Müslümanlar, Yahudiler ve diğer gruplar arasında imzalanan bir toplumsal antlaşmadır.", theme: 'unit4', relatedConcept: "Medine Sözleşmesi" },
                { id: 'u4_tf7', type: 'trueFalse', question: "Ensar, Mekke'den Medine'ye göç eden Müslümanlara verilen isimdir.", answer: "Y", explanation: "Mekke'den Medine'ye göç eden Müslümanlara Muhacir, onlara yardım eden Medineli Müslümanlara ise Ensar denir.", theme: 'unit4', relatedConcept: "Ensar" },
                { id: 'u4_tf8', type: 'trueFalse', question: "Hz. Muhammed (s.a.v.) 'Hatemü'l-Enbiya' yani peygamberlerin sonuncusudur.", answer: "D", explanation: "İslam inancına göre Hz. Muhammed (s.a.v.), Allah'ın (c.c.) gönderdiği peygamberler zincirinin son halkasıdır.", theme: 'unit4', relatedConcept: "Hatemü'l-Enbiya" },
                { id: 'u4_tf9', type: 'trueFalse', question: "Kâfirûn Suresi, Müslümanlara diğer inançlara hoşgörülü olmalarını ancak kendi inançlarından taviz vermemelerini öğretir.", answer: "D", explanation: "Kâfirûn Suresi, inanç konusunda net bir duruş sergilemeyi ve başkalarının inançlarına saygı duymayı ifade eder.", theme: 'unit4', relatedConcept: "Kâfirûn Suresi" },
                { id: 'u4_tf10', type: 'trueFalse', question: "Hz. Muhammed (s.a.v.) sadece Arap toplumuna gönderilmiş bir peygamberdir.", answer: "Y", explanation: "Hz. Muhammed'in (s.a.v.) peygamberliği evrenseldir; o, bütün insanlığa rahmet olarak gönderilmiştir.", theme: 'unit4', relatedConcept: "Evrensellik" },
                // Boşluk Doldurma
                { id: 'u4_fb1', type: 'fillInTheBlanks', question: "Hz. Muhammed'e (s.a.v.) peygamberlik görevinin verildiği ilk vahiy ........................ Mağarası'nda gelmiştir.", answer: "Hira", options: ["Hira", "Sevr", "Uhud", "Nur"], explanation: "İlk vahiy, Nur Dağı'ndaki Hira Mağarası'nda gelmiştir.", theme: 'unit4', relatedConcept: "Hira Mağarası" },
                { id: 'u4_fb2', type: 'fillInTheBlanks', question: "Hz. Muhammed'in (s.a.v.) sözlerine, davranışlarına ve onayladığı uygulamalara genel olarak ........................ denir.", answer: "Sünnet", options: ["Sünnet", "Hadis", "Fıkıh", "Kelam"], explanation: "Sünnet, Hz. Peygamber'in yoludur ve Müslümanlar için önemli bir rehberdir.", theme: 'unit4', relatedConcept: "Sünnet" },
                { id: 'u4_fb3', type: 'fillInTheBlanks', question: "Mekke'den Medine'ye göç eden Müslümanlara ........................ denir.", answer: "Muhacir", options: ["Muhacir", "Ensar", "Sahabe", "Tabiin"], explanation: "Muhacirler, dinleri uğruna yurtlarını terk eden ilk Müslümanlardır.", theme: 'unit4', relatedConcept: "Muhacir" },
                { id: 'u4_fb4', type: 'fillInTheBlanks', question: "Hz. Muhammed'in (s.a.v.) Allah'tan (c.c.) aldığı mesajları eksiksiz olarak insanlara bildirmesine ........................ denir.", answer: "Tebliğ", options: ["Tebliğ", "Emanet", "Sıdk", "Fetanet"], explanation: "Tebliğ, peygamberlerin temel görevlerinden biridir ve mesajı olduğu gibi ulaştırmak anlamına gelir.", theme: 'unit4', relatedConcept: "Tebliğ" },
                { id: 'u4_fb5', type: 'fillInTheBlanks', question: "Hz. Muhammed'in (s.a.v.) Veda Hutbesi'nde insan hakları, kadın hakları ve ........................ gibi evrensel mesajlar bulunmaktadır.", answer: "eşitlik", options: ["eşitlik", "zenginlik", "savaş", "ayrımcılık"], explanation: "Veda Hutbesi, insanlığa yönelik evrensel değerleri içeren önemli bir konuşmadır; eşitlik ve kardeşlik bu mesajların temelini oluşturur.", theme: 'unit4', relatedConcept: "Veda Hutbesi" },
                // Çoktan Seçmeli
                { id: 'u4_mc1', type: 'multipleChoice', question: "Aşağıdakilerden hangisi Hz. Muhammed'in (s.a.v.) insani yönünü ifade eden bir durum değildir?", options: ["Pazarda alışveriş yapması", "Hasta olduğunda tedavi olması", "Mucizeler göstermesi", "Ailesiyle ilgilenmesi"], answer: "Mucizeler göstermesi", explanation: "Mucizeler, peygamberliğinin bir delili olmakla birlikte, onun beşeri özelliklerinden ziyade Allah'ın (c.c.) ona verdiği özel bir güçtür. Diğer seçenekler onun insani yönünü yansıtır.", theme: 'unit4', relatedConcept: "Beşeriyet" },
                { id: 'u4_mc2', type: 'multipleChoice', question: "Hz. Muhammed'in (s.a.v.) peygamberlik görevini ifade eden 'Risalet' kelimesinin anlamı nedir?", options: ["Güvenilirlik", "Elçilik, mesaj taşıma", "Doğruluk", "Akıllı ve zeki olma"], answer: "Elçilik, mesaj taşıma", explanation: "Risalet, peygamberin Allah'tan (c.c.) aldığı mesajları insanlara ulaştırma görevi, yani elçiliğidir.", theme: 'unit4', relatedConcept: "Risalet" },
                { id: 'u4_mc3', type: 'multipleChoice', question: "Aşağıdakilerden hangisi Hz. Muhammed'in (s.a.v.) Mekke döneminde karşılaştığı zorluklardan biri değildir?", options: ["Müşriklerin baskı ve işkenceleri", "Boykot uygulaması", "Medine Sözleşmesi'nin imzalanması", "Yakınlarının bir kısmını kaybetmesi (Hüzün Yılı)"], answer: "Medine Sözleşmesi'nin imzalanması", explanation: "Medine Sözleşmesi, Hicret'ten sonra Medine döneminde yapılmıştır. Diğerleri Mekke dönemindeki zorluklardır.", theme: 'unit4', relatedConcept: "Mekke Dönemi" },
                { id: 'u4_mc4', type: 'multipleChoice', question: "Hz. Muhammed'in (s.a.v.) Medine'de yaptırdığı, hem ibadet hem de eğitim ve yönetim merkezi olarak kullanılan yapı hangisidir?", options: ["Kâbe", "Mescid-i Aksa", "Mescid-i Nebi", "Kuba Mescidi"], answer: "Mescid-i Nebi", explanation: "Mescid-i Nebi (Peygamber Mescidi), Medine'de bu çok fonksiyonlu amaçlar için inşa edilmiştir.", theme: 'unit4', relatedConcept: "Mescid-i Nebi" },
                { id: 'u4_mc5', type: 'multipleChoice', question: "Kâfirûn Suresi'nde vurgulanan temel ilke aşağıdakilerden hangisidir?", options: ["Zekâtın önemi", "İnanç özgürlüğü ve tevhit ilkesine bağlılık", "Ahiret hayatına iman", "Hac ibadetinin farzları"], answer: "İnanç özgürlüğü ve tevhit ilkesine bağlılık", explanation: "Kâfirûn Suresi, 'Sizin dininiz size, benim dinim banadır' ayetiyle inanç özgürlüğünü ve şirkten uzak durarak tevhide bağlılığı vurgular.", theme: 'unit4', relatedConcept: "Kâfirûn Suresi" }
            ],
            'unit5': [ // 5. ÜNİTE: İslam Düşüncesinde Yorumlar
                { id: 'u5_tf1', type: 'trueFalse', question: "Mezhep, İslam dininin temel ilkeleri üzerinde farklı anlayış ve yorumların ortaya çıkardığı ekollerdir.", answer: "D", explanation: "Mezhepler, dini metinlerin farklı yorumlanmasıyla ortaya çıkan düşünce okullarıdır.", theme: 'unit5', relatedConcept: "Mezhep" },
                { id: 'u5_tf2', type: 'trueFalse', question: "Fıkıh, İslam inanç esaslarını akli ve nakli delillerle açıklayan ilimdir.", answer: "Y", explanation: "Fıkıh, İslam hukukudur. Kelam ise inanç esaslarını açıklar.", theme: 'unit5', relatedConcept: "Fıkıh" },
                { id: 'u5_tf3', type: 'trueFalse', question: "Tefsir, Kur'an-ı Kerim'in ayetlerini açıklama ve yorumlama ilmidir.", answer: "D", explanation: "Tefsir, Kur'an'ın doğru anlaşılması için yapılan bir ilim dalıdır.", theme: 'unit5', relatedConcept: "Tefsir" },
                { id: 'u5_tf4', type: 'trueFalse', question: "Tasavvuf, İslam'ın sadece hukuki boyutunu ele alır.", answer: "Y", explanation: "Tasavvuf, İslam'ın manevi ve ahlaki boyutunu, nefsi arındırma ve Allah'a yakınlaşma yolunu ele alır.", theme: 'unit5', relatedConcept: "Tasavvuf" },
                { id: 'u5_tf5', type: 'trueFalse', question: "Maturidilik, Ehl-i Sünnet kelam ekollerinden biridir.", answer: "D", explanation: "Maturidilik, İmam Maturidi tarafından kurulan bir inanç mezhebidir.", theme: 'unit5', relatedConcept: "Maturidilik" },
                { id: 'u5_tf6', type: 'trueFalse', question: "Hanefilik, Ehl-i Sünnet fıkıh mezheplerinden biridir.", answer: "D", explanation: "Hanefilik, İmam-ı Azam Ebu Hanife tarafından kurulan en yaygın fıkıh mezheplerinden biridir.", theme: 'unit5', relatedConcept: "Hanefilik" },
                { id: 'u5_tf7', type: 'trueFalse', question: "Alevilik, İslam'ın Hz. Ali sevgisi ve Ehl-i Beyt'e bağlılık üzerine kurulu bir yorumudur.", answer: "D", explanation: "Alevilik, İslam düşüncesindeki farklı yorumlardan biridir.", theme: 'unit5', relatedConcept: "Alevilik" },
                { id: 'u5_tf8', type: 'trueFalse', question: "Mevlevilik, Hacı Bektaş Veli'ye nispet edilen tasavvufi bir yoldur.", answer: "Y", explanation: "Mevlevilik, Mevlana Celaleddin Rumi'ye nispet edilir. Hacı Bektaş Veli'ye Bektaşilik nispet edilir.", theme: 'unit5', relatedConcept: "Mevlevilik" },
                { id: 'u5_tf9', type: 'trueFalse', question: "Yunus Emre, Anadolu'da yaşamış büyük bir Türk mutasavvıf ve halk ozanıdır.", answer: "D", explanation: "Yunus Emre, tasavvufi şiirleriyle tanınır.", theme: 'unit5', relatedConcept: "Yunus Emre" },
                { id: 'u5_tf10', type: 'trueFalse', question: "Furkan Suresi 43. ayet, hevasını ilah edinen kişiden bahseder.", answer: "D", explanation: "Bu ayet, nefsinin isteklerini ilah edinenleri eleştirir.", theme: 'unit5', relatedConcept: "Furkan Suresi" },
                { id: 'u5_fb1', type: 'fillInTheBlanks', question: "İslam inanç esaslarını akli ve nakli delillerle açıklayan ilme ........................ denir.", answer: "kelam", options: ["kelam", "fıkıh", "tefsir", "hadis"], explanation: "Kelam, İslam akaidini inceleyen bilim dalıdır.", theme: 'unit5', relatedConcept: "Kelam" },
                { id: 'u5_fb2', type: 'fillInTheBlanks', question: "Hz. Peygamber (sav) ile ashabının yolunu takip eden büyük çoğunluğun oluşturduğu çizgiye ........................ denir.", answer: "Ehl-i Sünnet ve Cemaat", options: ["Ehl-i Sünnet ve Cemaat", "Şia", "Haricilik", "Mutezile"], explanation: "Ehl-i Sünnet, İslam'ın ana akımını temsil eder.", theme: 'unit5', relatedConcept: "Ehl-i Sünnet" },
                { id: 'u5_fb3', type: 'fillInTheBlanks', question: "İmam-ı Azam Ebu Hanife tarafından kurulan fıkıh mezhebi ........................'dir.", answer: "Hanefilik", options: ["Hanefilik", "Şafilik", "Malikilik", "Hanbelilik"], explanation: "Hanefilik, dört büyük Sünni fıkıh mezhebinden biridir.", theme: 'unit5', relatedConcept: "Hanefilik" },
                { id: 'u5_fb4', type: 'fillInTheBlanks', question: "Mevlana Celaleddin Rumi'ye nispet edilen tasavvufi yol ........................'dir.", answer: "Mevlevilik", options: ["Mevlevilik", "Bektaşilik", "Nakşibendilik", "Kadirilik"], explanation: "Mevlevilik, sema ayiniyle tanınan bir tarikattır.", theme: 'unit5', relatedConcept: "Mevlevilik" },
                { id: 'u5_fb5', type: 'fillInTheBlanks', question: "Anadolu'nun Türkleşmesi ve İslamlaşmasında önemli rol oynamış mutasavvıf ........................'dir.", answer: "Hacı Bektaş Veli", options: ["Hacı Bektaş Veli", "Yunus Emre", "Mevlana", "Ahmet Yesevi"], explanation: "Hacı Bektaş Veli, Anadolu'da Aleviliğin yayılmasında etkili olmuştur.", theme: 'unit5', relatedConcept: "Hacı Bektaş Veli" },
                { id: 'u5_mc1', type: 'multipleChoice', question: "İslam hukukunu, dini hükümleri inceleyen ilim dalı hangisidir?", options: ["Kelam", "Fıkıh", "Hadis", "Tefsir"], answer: "Fıkıh", explanation: "Fıkıh, İslam'ın pratik yaşamla ilgili hükümlerini inceler.", theme: 'unit5', relatedConcept: "Fıkıh" },
                { id: 'u5_mc2', type: 'multipleChoice', question: "Hz. Muhammed'in (sav) söz, fiil ve onaylarının derlenmesi ve incelenmesi ilmi hangisidir?", options: ["Fıkıh", "Kelam", "Hadis", "Tefsir"], answer: "Hadis", explanation: "Hadis ilmi, peygamberin sünnetini korur ve inceler.", theme: 'unit5', relatedConcept: "Hadis" },
                { id: 'u5_mc3', type: 'multipleChoice', question: "İmam Eşari tarafından kurulan kelam ekolü hangisidir?", options: ["Maturidilik", "Eşarilik", "Mutezile", "Haricilik"], answer: "Eşarilik", explanation: "Eşarilik, Sünni kelam ekollerinden biridir.", theme: 'unit5', relatedConcept: "Eşarilik" },
                { id: 'u5_mc4', 'type': 'multipleChoice', question: "Şia mezheplerinden biri olup, İmam Cafer es-Sadık'a nispet edilen mezhep hangisidir?", options: ["Hanefilik", "Caferilik", "Malikilik", "Hanbelilik"], answer: "Caferilik", explanation: "Caferilik, Şia'nın en büyük fıkıh mezhebidir.", theme: 'unit5', relatedConcept: "Caferilik" },
                { id: 'u5_mc5', type: 'multipleChoice', question: "Bahaeddin Nakşibend'e nispet edilen tasavvufi yol hangisidir?", options: ["Mevlevilik", "Bektaşilik", "Nakşibendilik", "Kadirilik"], answer: "Nakşibendilik", explanation: "Nakşibendilik, zikir ve sohbetle bilinen bir tarikattır.", theme: 'unit5', relatedConcept: "Nakşibendilik" }
            ]
        };

        /**
         * Verilen soru dizisinin tam olarak 100 soru içerdiğinden emin olur.
         * Dizi 100'den az soru içeriyorsa, sayı 100'e ulaşana kadar mevcut soruları rastgele çoğaltır.
         * Daha fazla soru içeriyorsa, 100'e kadar keser.
         * @param {Array<Object>} questionsArray - Bir ünite için sorular dizisi.
         * @returns {Array<Object>} Tam olarak 100 soru içeren bir dizi.
         */
        function ensureOneHundredQuestions(questionsArray) {
            let currentQuestions = [...questionsArray]; // Orijinali değiştirmemek için sığ bir kopya oluştur
            const targetCount = 100;

            if (currentQuestions.length >= targetCount) {
                return currentQuestions.slice(0, targetCount); // Zaten 100 veya daha fazlaysa, ilk 100'ü al
            }

            // 100'den azsa, 100'e ulaşana kadar soruları rastgele çoğalt
            const originalLength = currentQuestions.length;
            while (currentQuestions.length < targetCount) {
                const randomIndex = Math.floor(Math.random() * originalLength);
                const questionToDuplicate = currentQuestions[randomIndex];
                // Daha sonra benzersiz kimlikler gerekiyorsa, ve soru nesneleri değiştirilebilirse,
                // kopyalanan soru için yeni bir nesne oluştur.
                currentQuestions.push({ ...questionToDuplicate, id: `${questionToDuplicate.id}_copy_${currentQuestions.length}` });
            }
            return currentQuestions;
        }

        // DOM öğeleri (genel olarak bildirildi ancak onload'da atandı)
        let participantManagementScreen; // Yeni ana ekran
        let leaderboardContainer; // Lider tablosu için konteyner
        let newParticipantNameInputMain; // Ana ekranda yeni katılımcı girişi
        let addNewParticipantMainButton; // Ana ekranda yeni katılımcı ekleme düğmesi
        let showRegisteredUsersButton; // Kayıtlı kullanıcıları gösterme düğmesi
        let unitSelectionScreen; // Ünite seçim ekranı için yeni ekran
        let gameModeSelectionScreen; // Oyun modu seçimi için mevcut ekran
        let gameModeMessage; // Oyun modu seçimi için mesaj gösterimi
        let gamePanel; // Ana oyun alanı (skor, ızgara, quiz içeriği)
        let scoreBoardContainer; // Skor tablosu için ana konteyner
        let currentParticipantDisplay; // Mevcut katılımcının adı ve skoru için gösterim
        let quizContentContainer;
        let questionContainer;
        let feedbackDiv;
        let finalScoreContainer;
        let overallResultDiv;
        let resetGameButton;
        let questionCounterDisplay;
        let questionNavigationContainer;
        let timerDisplay;
        let gridInstructionMessage;
        let questionScreenInstructionMessage;
        let fullscreenOverlay;
        let returnToMainMenuGridButton; // Soru ızgarasından ana menüye dönme düğmesi
        let returnToQuestionGridButton; // Quiz içeriğinden soru ızgarasına dönme düğmesi
        let finalParticipantScoresDisplay; // Son katılımcı skor tablosu için konteyner
        let goToMainSiteButton; // Ana siteye gitme düğmesi (ana menüden)
        let participantSelectionModal; // Katılımcı seçimi için modal
        let existingParticipantsButtonsContainer; // Modalda katılımcı butonları için konteyner
        let selectExistingParticipantButton; // Modalda katılımcı seçme düğmesi
        let editSelectedParticipantButton; // Yeni: Modalda seçili katılımcıyı düzenleme düğmesi
        let newParticipantNameInput; // Modalda giriş (HTML'den kaldırıldı, ancak referans için değişken tutuldu)
        let nextTurnButton; // Takım modunda sonraki tur için düğme
        let teamSetupModal; // Takım kurulumu için modal
        let numTeamsInput; // Takım sayısı için giriş
        let teamNameInputsContainer; // Dinamik takım adı girişleri için konteyner
        let startOverButton; // Baştan başlama için yeni düğme
        let confirmResetModal; // Yeni onay modalı
        let confirmResetYesButton; // Onay modalında evet düğmesi
        let confirmResetNoButton; // Onay modalında hayır düğmesi
        let editParticipantModal; // Yeni katılımcı düzenleme modalı
        let editParticipantNameInput; // Katılımcı düzenleme modalında giriş alanı
        let editParticipantScoreInput; // Düzenleme modalında skor için yeni giriş
        let editParticipantErrorMessage; // Katılımcı düzenleme modalında hata mesajı
        let editParticipantScoreErrorMessage; // Düzenleme modalında skor için yeni hata mesajı


        /**
         * Benzersiz bir ID (UUID v4) oluşturur.
         * @returns {string} Benzersiz bir ID.
         */
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        /**
         * Takımları localStorage'dan yükler.
         */
        function loadTeams() {
            const storedTeams = localStorage.getItem(LOCAL_STORAGE_KEY_TEAMS);
            if (storedTeams) {
                window.teams = JSON.parse(storedTeams);
            } else {
                window.teams = []; // Bulunamazsa boş başlat
            }
        }

        /**
         * Takımları localStorage'a kaydeder.
         */
        function saveTeams() {
            localStorage.setItem(LOCAL_STORAGE_KEY_TEAMS, JSON.stringify(window.teams));
        }

        /**
         * Oyun durumunu (mevcut ünite, mod, cevaplanmış sorular) localStorage'dan yükler.
         */
        function loadGameState() {
            window.currentUnit = localStorage.getItem(LOCAL_STORAGE_KEY_CURRENT_UNIT);
            window.gameMode = localStorage.getItem(LOCAL_STORAGE_KEY_GAME_MODE);
            const storedAnsweredQuestions = localStorage.getItem(LOCAL_STORAGE_KEY_ANSWERED_QUESTIONS);
            if (storedAnsweredQuestions) {
                window.answeredQuestions = JSON.parse(storedAnsweredQuestions);
            } else {
                window.answeredQuestions = {};
            }
        }

        /**
         * Oyun durumunu localStorage'a kaydeder.
         */
        function saveGameState() {
            localStorage.setItem(LOCAL_STORAGE_KEY_CURRENT_UNIT, window.currentUnit);
            localStorage.setItem(LOCAL_STORAGE_KEY_GAME_MODE, window.gameMode);
            localStorage.setItem(LOCAL_STORAGE_KEY_ANSWERED_QUESTIONS, JSON.stringify(window.answeredQuestions));
        }

        /**
         * Katılımcı yönetimi ekranında lider tablosunu render eder.
         */
        function renderLeaderboard() {
            leaderboardContainer.innerHTML = ''; // Önceki içeriği temizle
            if (window.teams.length === 0) {
                leaderboardContainer.innerHTML = '<p class="text-gray-600 text-center">Henüz öğrenci yok.</p>'; // Metin burada değiştirildi
                return;
            }

            const leaderboardList = document.createElement('div');
            leaderboardList.classList.add('leaderboard-list');

            // Lider tablosu öğeleri için bir renk kümesi tanımla
            const leaderboardItemColors = [
                'color-0', 'color-1', 'color-2', 'color-3', 'color-4',
                'color-5', 'color-6', 'color-7', 'color-8', 'color-9'
            ];

            // Katılımcıları puana göre azalan sırada sırala
            const sortedParticipants = [...window.teams].sort((a, b) => b.score - a.score);

            sortedParticipants.forEach((p, index) => {
                const listItem = document.createElement('div');
                listItem.classList.add('leaderboard-item');
                // Dinamik olarak bir renk sınıfı ata
                listItem.classList.add(leaderboardItemColors[index % leaderboardItemColors.length]);

                if (p.id === window.currentTeamId) {
                    listItem.classList.add('active-participant'); // Aktif katılımcıyı vurgula
                }
                listItem.innerHTML = `
                    <span class="leaderboard-rank">${index + 1}.</span>
                    <span class="leaderboard-name">${p.name}</span>
                    <span class="leaderboard-score">${p.score} Puan</span>
                `;
                leaderboardList.appendChild(listItem);
            });
            leaderboardContainer.appendChild(leaderboardList);
        }

        /**
         * Ana ekrandan yeni bir katılımcı ekler ve ünite seçimine devam eder.
         */
        window.addNewParticipantAndProceed = function() {
            const newName = newParticipantNameInputMain.value.trim();
            if (newName) {
                let participantToAdd = null;
                const existing = window.teams.find(p => p.name.toLowerCase() === newName.toLowerCase());
                if (existing) {
                    participantToAdd = existing;
                } else {
                    participantToAdd = { id: generateUUID(), name: newName, score: 0 };
                    window.teams.push(participantToAdd); // Takımlar dizisine ekle
                }
                
                window.currentTeamId = participantToAdd.id;
                saveTeams(); // Güncellenmiş takımları kaydet
                newParticipantNameInputMain.value = ''; // Girişi temizle

                participantManagementScreen.classList.add('hidden');
                unitSelectionScreen.classList.remove('hidden');
                setGameBackground('general'); // Arka planı ünite seçimi için genele sıfırla
                updateParticipantDisplay(); // Mevcut katılımcı gösterimini güncelle
            } else {
                console.warn("Lütfen yeni katılımcı adını girin.");
            }
        };

        /**
         * Mevcut kayıtlı kullanıcıları seçmek için modalı gösterir.
         */
        window.showRegisteredUsersScreen = function() {
            existingParticipantsButtonsContainer.innerHTML = ''; // Önceki butonları temizle
            selectedParticipantIdInModal = null; // Seçimi sıfırla

            // Düzenle butonunu başlangıçta devre dışı bırak
            editSelectedParticipantButton.disabled = true;
            selectExistingParticipantButton.disabled = true; // Seç butonunu da başlangıçta devre dışı bırak

            if (window.teams.length > 0) {
                window.teams.forEach((p, index) => {
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('participant-item-wrapper');
                    wrapper.dataset.participantId = p.id;

                    const nameDisplay = document.createElement('span');
                    nameDisplay.classList.add('participant-name-display');
                    nameDisplay.textContent = p.name;
                    wrapper.appendChild(nameDisplay);

                    // Seçim için sarmalayıcıya tıklama dinleyicisi ekle
                    wrapper.onclick = () => {
                        // Tüm sarmalayıcılardan 'selected-participant' sınıfını kaldır
                        document.querySelectorAll('#existing-participants-buttons .participant-item-wrapper').forEach(item => {
                            item.classList.remove('selected-participant');
                        });
                        // Tıklanan sarmalayıcıya 'selected-participant' sınıfını ekle
                        wrapper.classList.add('selected-participant');
                        selectedParticipantIdInModal = p.id;
                        selectExistingParticipantButton.disabled = false; // "Seç ve Başla" butonunu etkinleştir
                        editSelectedParticipantButton.disabled = false; // "Düzenle" butonunu etkinleştir
                    };

                    // Zaten seçiliyse vurgula
                    if (window.currentTeamId === p.id) {
                        wrapper.classList.add('selected-participant');
                        selectedParticipantIdInModal = p.id; // Zaten seçiliyse ayarlandığından emin ol
                        selectExistingParticipantButton.disabled = false;
                        editSelectedParticipantButton.disabled = false; // Zaten seçiliyse "Düzenle"yi etkinleştir
                    }

                    existingParticipantsButtonsContainer.appendChild(wrapper);
                });
            } else {
                existingParticipantsButtonsContainer.innerHTML = '<p class="text-gray-600 text-sm col-span-full">Henüz kayıtlı öğrenci yok.</p>'; // Metin burada değiştirildi
            }
            participantSelectionModal.classList.remove('hidden');
            participantSelectionModal.classList.add('show');
        };

        /**
         * Bir katılımcının adını ve skorunu düzenlemek için modalı gösterir.
         * @param {string} id - Düzenlenecek katılımcının ID'si.
         */
        window.showEditParticipantModal = function(id) {
            participantIdToEdit = id;
            const participant = window.teams.find(p => p.id === id);
            if (participant) {
                editParticipantNameInput.value = participant.name;
                editParticipantScoreInput.value = participant.score; // Skoru doldur
                editParticipantErrorMessage.textContent = ''; // Önceki hatayı temizle
                editParticipantErrorMessage.classList.add('hidden'); // Hata mesajını gizle
                editParticipantScoreErrorMessage.textContent = ''; // Önceki hatayı temizle
                editParticipantScoreErrorMessage.classList.add('hidden'); // Hata mesajını gizle
                editParticipantModal.classList.remove('hidden');
                editParticipantModal.classList.add('show');
            }
        };

        /**
         * Bir katılımcının adını ve skorunu düzenlemek için modalı gizler.
         */
        window.hideEditParticipantModal = function() {
            editParticipantModal.classList.remove('show');
            setTimeout(() => {
                editParticipantModal.classList.add('hidden');
            }, 300);
            participantIdToEdit = null; // Düzenlenen katılımcının ID'sini temizle
        };

        /**
         * Düzenlenen katılımcı adını ve skorunu kaydeder.
         */
        window.saveEditedParticipantName = function() {
            const newName = editParticipantNameInput.value.trim();
            const newScore = parseInt(editParticipantScoreInput.value); // Skoru tam sayı olarak al

            let hasError = false;

            if (!newName) {
                editParticipantErrorMessage.textContent = 'İsim boş bırakılamaz.';
                editParticipantErrorMessage.classList.remove('hidden');
                hasError = true;
            } else {
                editParticipantErrorMessage.textContent = '';
                editParticipantErrorMessage.classList.add('hidden');
            }

            const existingParticipantWithSameName = window.teams.find(p => p.name.toLowerCase() === newName.toLowerCase() && p.id !== participantIdToEdit);
            if (existingParticipantWithSameName) {
                editParticipantErrorMessage.textContent = 'Bu isimde başka bir katılımcı zaten var.';
                editParticipantErrorMessage.classList.remove('hidden');
                hasError = true;
            }

            if (isNaN(newScore) || newScore < 0) { // Skoru doğrula
                editParticipantScoreErrorMessage.textContent = 'Puan geçerli bir sayı olmalı ve negatif olamaz.';
                editParticipantScoreErrorMessage.classList.remove('hidden');
                hasError = true;
            } else {
                editParticipantScoreErrorMessage.textContent = '';
                editParticipantScoreErrorMessage.classList.add('hidden');
            }

            if (hasError) {
                return;
            }

            const participantIndex = window.teams.findIndex(p => p.id === participantIdToEdit);
            if (participantIndex !== -1) {
                window.teams[participantIndex].name = newName;
                window.teams[participantIndex].score = newScore; // Skoru güncelle
                saveTeams();
                renderLeaderboard(); // Ana lider tablosunu yeniden render et
                showRegisteredUsersScreen(); // Katılımcı seçim ekranını yeniden render et
                window.hideEditParticipantModal();
            } else {
                editParticipantErrorMessage.textContent = 'Katılımcı bulunamadı.'; // Yedek hata
                editParticipantErrorMessage.classList.remove('hidden');
            }
        };

        /**
         * Bir katılımcının adını ve skorunu düzenlemeyi iptal eder.
         */
        window.cancelEditParticipantName = function() {
            window.hideEditParticipantModal();
        };

        /**
         * Modal'dan mevcut bir katılımcının seçimini yönetir.
         */
        window.selectExistingParticipant = function() {
            if (selectedParticipantIdInModal) {
                window.currentTeamId = selectedParticipantIdInModal;
                saveTeams(); // currentTeamId'yi kaydet (takımlar durumunun bir parçası)
                window.hideParticipantSelectionModal(); // Genel fonksiyonu çağır
                participantManagementScreen.classList.add('hidden');
                unitSelectionScreen.classList.remove('hidden');
                setGameBackground('general');
                updateParticipantDisplay();
            } else {
                console.warn("Lütfen bir katılımcı seçin.");
            }
        };

        /**
         * Katılımcı seçim modalını gizler.
         */
        window.hideParticipantSelectionModal = function() { // Genel yapıldı
            participantSelectionModal.classList.remove('show');
            setTimeout(() => {
                participantSelectionModal.classList.add('hidden');
            }, 300);
        }

        /**
         * Ünite seçimini yönetir, ünite seçim ekranını gizler ve oyun modu seçimini gösterir.
         * @param {string} unitId - Seçilen ünitenin ID'si.
         */
        window.selectUnit = async function(unitId) {
            window.currentUnit = unitId;
            // Doğrudan oyun paneline geç, oyun modunu örtük olarak 'individual' olarak ayarla
            window.gameMode = 'individual'; 
            unitSelectionScreen.classList.add('hidden');
            gameModeSelectionScreen.classList.add('hidden'); // Bunun her zaman gizli olduğundan emin ol
            gamePanel.classList.remove('hidden'); // Oyun panelini göster
            setGameBackground(unitId);
            gameModeMessage.classList.add('hidden');
            saveGameState(); // Seçilen ünite ve oyun modunu kaydet
            startGame(); // Oyunu doğrudan başlat
        };

        /**
         * Oyun modu seçimini yönetir (Bireysel veya Takım).
         * Bu fonksiyon artık sadece açıkça yönlendirildiğinde çağrılır, ünite seçiminden değil.
         * @param {string} mode - Seçilen oyun modu ('individual' veya 'team').
         */
        window.selectGameMode = function(mode) {
            window.gameMode = mode;
            gameModeSelectionScreen.classList.add('hidden');
            saveGameState(); // Oyun modunu kaydet

            if (mode === 'individual') {
                gamePanel.classList.remove('hidden');
                startGame();
            } else if (mode === 'team') {
                if (window.teams.length < 2 || window.teams.some(t => t.id.startsWith('player'))) { 
                    window.teams = []; // Takım kurulumu için bireysel oyuncuları temizle
                    window.showTeamSetupModal(); // Genel fonksiyonu çağır
                } else {
                    gamePanel.classList.remove('hidden');
                    startGame();
                }
            }
        };

        /**
         * Takım kurulum modalını gösterir.
         */
        window.showTeamSetupModal = function() { // Genel yapıldı
            teamSetupModal.classList.remove('hidden');
            teamSetupModal.classList.add('show');
            numTeamsInput.value = ''; // Önceki girişi temizle
            teamNameInputsContainer.innerHTML = ''; // Dinamik girişleri temizle
        }

        /**
         * Takım kurulum modalını gizler.
         */
        window.hideTeamSetupModal = function() { // Genel yapıldı
            teamSetupModal.classList.remove('show');
            setTimeout(() => {
                teamSetupModal.classList.add('hidden');
            }, 300);
        }

        /**
         * Girilen takım sayısına göre takım adı giriş alanları oluşturur.
         */
        window.generateTeamNameInputs = function() {
            const num = parseInt(numTeamsInput.value);
            teamNameInputsContainer.innerHTML = ''; // Mevcut girişleri temizle

            if (isNaN(num) || num < 2 || num > 10) { // Takımları 2 ile 10 arasında sınırla
                teamNameInputsContainer.innerHTML = '<p class="text-red-500 text-sm">Lütfen 2 ile 10 arasında bir takım sayısı girin.</p>';
                return;
            }

            for (let i = 0; i < num; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `team-name-input-${i}`;
                input.classList.add('w-full', 'p-2', 'border', 'rounded', 'team-name-input');
                input.placeholder = `Takım ${i + 1} Adı`;
                input.value = `Takım ${i + 1}`; // Varsayılan isim
                teamNameInputsContainer.appendChild(input);
            }
        };

        /**
         * Takım adlarını gönderir ve oyunu takım modunda başlatır.
         */
        window.submitTeamSetup = function() {
            window.teams = []; // Yeni takım kurulumu için mevcut katılımcıları temizle
            let allNamesValid = true;
            const teamNameInputs = teamNameInputsContainer.querySelectorAll('.team-name-input');

            if (teamNameInputs.length === 0) {
                console.warn("Lütfen önce takım sayısını girip isimleri oluşturun.");
                return;
            }

            teamNameInputs.forEach((input, index) => {
                const name = input.value.trim();
                if (!name) {
                    allNamesValid = false;
                    console.warn(`Takım ${index + 1} için bir isim girmeniz gerekiyor.`);
                    return;
                }
                window.teams.push({ id: `team${index + 1}`, name: name, score: 0 });
            });

            if (!allNamesValid) {
                console.warn("Tüm takım isimlerini girmeniz gerekiyor.");
                return;
            }

            saveTeams(); // Yeni oluşturulan takımları kaydet
            window.hideTeamSetupModal(); // Genel fonksiyonu çağır
            gamePanel.classList.remove('hidden'); // Ana oyun panelini göster
            startGame();
        };

        /**
         * Oyun durumunu başlatır, soruları karıştırır ve soru ızgarasını görüntüler.
         * @param {boolean} resuming - Oyuna devam ediliyorsa true, yeni bir oyunsa false.
         */
        window.startGame = function(resuming = false) {
            if (!resuming) {
                window.currentQuestionIndex = 0;
                window.answeredQuestions = {}; // Yeni oyun için cevaplanmış soruları sıfırla
                if (window.gameMode === 'team') {
                    window.teams.forEach(team => team.score = 0); // Yeni takım oyunu için skorları sıfırla
                } 
                // ÖNEMLİ: Bireysel mod için, skoru burada sıfırlamıyoruz.
                // Skorlar bireysel oyuncular için oturumlar arasında birikecek.
                
                window.currentTeamId = window.currentTeamId || (window.teams.length > 0 ? window.teams[0].id : null); // currentTeamId'nin ayarlandığından emin ol
                
                saveTeams(); // Başlangıç skorlarını/durumunu kaydet (takım modundaysa skorlar sıfırlanır; bireysel moddaysa kalır)
                saveGameState(); // Cevaplanmış soruları kaydet (yeni oyun için boş)
            }
            
            shuffledQuestions = shuffleArray(ensureOneHundredQuestions(unitQuestions[window.currentUnit]));
            
            quizContentContainer.classList.add('hidden');
            finalScoreContainer.classList.add('hidden');
            questionNavigationContainer.classList.remove('hidden');
            
            // Oyun panelinde skor tablosunu ve mevcut katılımcı gösterimini gizle
            scoreBoardContainer.classList.add('hidden'); 
            currentParticipantDisplay.classList.add('hidden');
            
            updateParticipantDisplay(); // Bu, gizli öğeleri hala güncelleyecek, sorun değil.
            renderQuestionNumbers(); // Soru numaralarının ilk render'ı
            gridInstructionMessage.classList.remove('hidden');
            questionScreenInstructionMessage.classList.add('hidden');
            if (questionCounterDisplay) {
                questionCounterDisplay.classList.remove('hidden');
            }
            setGameBackground(window.currentUnit);
            nextTurnButton.classList.add('hidden'); // Sonraki tur butonunu başlangıçta gizle
        };

        /**
         * Katılımcı/takım gösterimini mevcut katılımcının/takımın adı ve skoruyla günceller.
         */
        function updateParticipantDisplay() {
            // Kaldırıldı: if (scoreBoardContainer) scoreBoardContainer.classList.remove('hidden');
            // Bu öğe artık oyun panelinde kasıtlı olarak gizlenmiştir.

            if (scoreBoardContainer && currentParticipantDisplay) {
                scoreBoardContainer.innerHTML = ''; // Önceki içeriği temizle
                const scoreTable = document.createElement('div');
                scoreTable.classList.add('score-table');

                // Katılımcıları/takımları puana göre azalan sırada sırala
                const sortedEntities = [...window.teams].sort((a, b) => b.score - a.score);

                sortedEntities.forEach((entity) => {
                    const scoreCell = document.createElement('div');
                    scoreCell.classList.add('score-cell');
                    if (window.currentTeamId === entity.id) {
                        scoreCell.classList.add('active-participant');
                    }
                    scoreCell.innerHTML = `
                        <div class="flex flex-col items-center">
                            <span class="participant-name text-lg font-bold flex items-center gap-1">
                                ${entity.name}
                            </span>
                        </div>
                        <div class="flex flex-col items-center mt-2">
                            <span class="text-sm opacity-80 mb-1">Puan</span>
                            <span class="participant-score text-3xl font-extrabold">${entity.score}</span>
                        </div>
                    `;
                    scoreTable.appendChild(scoreCell);
                });
                scoreBoardContainer.appendChild(scoreTable);

                const currentEntity = window.teams.find(p => p.id === window.currentTeamId);
                if (currentEntity) {
                    currentParticipantDisplay.textContent = `Sıra: ${currentEntity.name}`;
                } else {
                    currentParticipantDisplay.textContent = "Sıra: Katılımcı/Takım Seçin";
                }
            }
            if (gridInstructionMessage) {
                const currentEntity = window.teams.find(p => p.id === window.currentTeamId);
                if (currentEntity) {
                    gridInstructionMessage.textContent = `Sıra ${currentEntity.name}'da. Henüz cevaplanmamış bir soru seçin.`;
                } else {
                    gridInstructionMessage.textContent = `Bir soru seçerek başlayın.`;
                }
            }
        }

        /**
         * Mevcut soruyu, seçeneklerini render eder ve zamanlayıcıyı ayarlar.
         */
        function renderCurrentQuestion() {
            // Quiz içerik konteynerinin görünür ve tam ekran kaplamasının aktif olduğundan emin ol
            quizContentContainer.classList.remove('hidden');
            questionNavigationContainer.classList.add('hidden');
            fullscreenOverlay.classList.remove('hidden');
            setTimeout(() => fullscreenOverlay.classList.add('show'), 10);
            quizContentContainer.classList.add('fullscreen-active');
            hideFinalScore(); // Bir soru açıldığında son skorun gizlendiğinden emin ol
            gridInstructionMessage.classList.add('hidden'); // Izgara talimatlarını gizle

            if (questionCounterDisplay) {
                questionCounterDisplay.classList.add('hidden');
            }

            feedbackDiv.classList.remove('show', 'correct', 'incorrect', 'animate-in');
            feedbackDiv.innerHTML = '';
            
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            questionScreenInstructionMessage.classList.add('hidden');
            nextTurnButton.classList.add('hidden'); // Sonraki tur butonunu gizle

            const q = shuffledQuestions[window.currentQuestionIndex];
            
            // Soru daha önce doğru cevaplandıysa, ızgaraya dönme butonunu gizle
            // Yeni bir deneme veya daha önce yanlışsa, göster.
            if (window.answeredQuestions[q.id]) { // Sadece doğru cevaplandıysa kontrol eder
                returnToQuestionGridButton.classList.remove('hidden'); // İnceleme için her zaman ızgaraya dönme butonunu göster
            } else {
                returnToQuestionGridButton.classList.remove('hidden');
            }

            // Tüm soruların doğru cevaplanıp cevaplanmadığını kontrol et ve son skoru göster
            const allCorrectlyAnswered = shuffledQuestions.every(q => window.answeredQuestions[q.id]);
            if (allCorrectlyAnswered) {
                showFinalScore();
                return;
            }

            setGameBackground(q.theme || window.currentUnit);
            questionCounterDisplay.textContent = `Soru ${shuffledQuestions.indexOf(q) + 1} / ${shuffledQuestions.length}`;
            
            questionContainer.classList.add('question-block-closed');

            // Mevcut soru için puanları hesapla
            let questionPoints = 0;
            if (q.type === 'trueFalse') {
                questionPoints = 5;
            } else if (q.type === 'fillInTheBlanks' || q.type === 'multipleChoice') {
                questionPoints = 10;
            }

            let questionHtml = `<p class="question-points">${questionPoints} Puan</p>`; // Puanları göster
            questionHtml += `<p class="question-text">${q.question}</p>`;
            let optionsHtml = '<div class="options-container">';
            let optionsToShuffle = [];

            if (q.type === 'trueFalse') {
                optionsToShuffle = ["Doğru", "Yanlış"];
            } else if (q.type === 'fillInTheBlanks' || q.type === 'multipleChoice') {
                // Sadece 4 seçeneğin kullanıldığından emin ol
                optionsToShuffle = [...q.options.slice(0, 4)]; 
            }
            
            const shuffledOptions = shuffleArray(optionsToShuffle);
            // Seçenekler için sadece ilk 4 rengi kullan
            const optionColors = [
                'option-color-1', 'option-color-2', 'option-color-3', 'option-color-4' 
            ];

            shuffledOptions.forEach((option, optIndex) => {
                const colorClass = optionColors[optIndex % optionColors.length];
                optionsHtml += `
                    <label class="option-label ${colorClass}">
                        <input type="radio" name="${q.id}" value="${option}" onchange="checkCurrentAnswer()">
                        <span>${option}</span>
                    </label>
                `;
            });
            optionsHtml += '</div>';
            questionHtml += optionsHtml;
            
            questionContainer.innerHTML = questionHtml;
            
            setTimeout(() => {
                questionContainer.classList.remove('question-block-closed');
            }, 50);

            // Soru daha önce cevaplandıysa (doğru bir şekilde) kontrol et
            if (window.answeredQuestions[q.id]) {
                const currentAnswerState = window.answeredQuestions[q.id]; 
                
                const selectedRadio = document.querySelector(`input[name="${q.id}"][value="${currentAnswerState.userAnswer}"]`);
                if (selectedRadio) {
                    selectedRadio.checked = true;
                }
                document.querySelectorAll(`input[name="${q.id}"]`).forEach(radio => radio.disabled = true);

                // Çözülmüş sorular için her zaman doğru geri bildirim ve açıklama göster
                displayFeedback(true, q.answer, q.explanation); // Orijinal doğru cevabı ve açıklamayı geç
                
                let correctOptionValue = q.answer;
                if (q.type === 'trueFalse') {
                    correctOptionValue = (q.answer === 'D' ? 'Doğru' : 'Yanlış');
                }
                const correctRadio = document.querySelector(`input[name="${q.id}"][value="${correctOptionValue}"]`);
                if (correctRadio) {
                    const correctLabel = correctRadio.closest('label');
                    if (correctLabel) {
                        correctLabel.classList.add('correct-option-highlight');
                    }
                }

                const answeredByTeam = window.teams.find(t => t.id === currentAnswerState.solvedByTeamId);
                const answeredByTeamName = answeredByTeam ? answeredByTeam.name : 'Bilinmeyen Takım';
                
                questionScreenInstructionMessage.textContent = `Bu soru ${answeredByTeamName} tarafından doğru cevaplandı. Soru ekranına dönmek için 'Soru Ekranına Dön' butonuna tıklayın.`;
                questionScreenInstructionMessage.classList.remove('hidden');
                nextTurnButton.classList.add('hidden'); // Zaten çözüldüyse sonraki tur yok
            } else { // Soru answeredQuestions'ta değilse, yeni bir deneme (veya daha önce yanlış)
                startTimer();
                const currentEntity = window.teams.find(p => p.id === window.currentTeamId);
                questionScreenInstructionMessage.textContent = `Sıra ${currentEntity ? currentEntity.name : 'sizde'}'de! Soruyu cevaplamak için süreniz var.`;
                questionScreenInstructionMessage.classList.remove('hidden');
            }

            updateParticipantDisplay();
            renderQuestionNumbers();
        }

        /**
         * Mevcut soru için geri sayım zamanlayıcısını başlatır.
         */
        function startTimer() {
            timer = initialTimerValue;
            timerDisplay.classList.remove('hidden');
            timerDisplay.classList.remove('warning', 'critical');
            timerDisplay.textContent = `Kalan Süre: ${timer} saniye`;

            timerInterval = setInterval(() => {
                timer--;
                timerDisplay.textContent = `Kalan Süre: ${timer} saniye`;

                if (timer <= 10 && timer > 5) {
                    timerDisplay.classList.add('warning');
                    timerDisplay.classList.remove('critical');
                    Tone.start(); // Ses bağlamının başladığından emin ol
                    timerSynth.triggerAttackRelease("A4", "16n"); // Uyarı sesi çal
                } else if (timer <= 5) {
                    timerDisplay.classList.add('critical');
                    timerDisplay.classList.remove('warning');
                    Tone.start(); // Ses bağlamının başladığından emin ol
                    timerSynth.triggerAttackRelease("A4", "16n"); // Kritik uyarı sesi çal
                } else {
                    timerDisplay.classList.remove('warning', 'critical');
                }

                if (timer <= 0) {
                    handleTimeout();
                }
            }, 1000);
        }

        /**
         * Zamanlayıcı bittiğinde durumu yönetir.
         */
        async function handleTimeout() {
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            Tone.start(); // Ses bağlamının başladığından emin ol
            incorrectSynth.triggerAttackRelease("C3", "8n"); // Yanlış sesi çal

            const q = shuffledQuestions[window.currentQuestionIndex];
            
            document.querySelectorAll(`input[name="${q.id}"]`).forEach(radio => radio.disabled = true);

            // Sadece "Süre Doldu." geri bildirimi göster, doğru cevap veya açıklama yok
            displayFeedback(false, null, null); 

            // Zaman aşımından sonra her zaman lider tablosuna dön
            window.returnToQuestionsGrid(); // Bu fonksiyon artık lider tablosuna götürür
        }

        /**
         * Kullanıcının seçtiği cevabı doğru cevapla karşılaştırır.
         */
        window.checkCurrentAnswer = async function() {
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');

            const q = shuffledQuestions[window.currentQuestionIndex];
            let userAnswer;
            let isCorrect = false;
            let timeTaken = initialTimerValue - timer;

            const selected = document.querySelector(`input[name="${q.id}"]:checked`);
            userAnswer = selected ? selected.value : '';
            
            let actualAnswer = q.answer;
            if (q.type === 'trueFalse') {
                actualAnswer = (q.answer === 'D' ? 'Doğru' : 'Yanlış');
            }

            isCorrect = (userAnswer === actualAnswer);

            if (selected) {
                selected.closest('label').classList.add('selected-animation');
            }

            const currentEntity = window.teams.find(p => p.id === window.currentTeamId);

            if (isCorrect) {
                if (currentEntity) { 
                    let pointsToAdd = 0;
                    if (q.type === 'trueFalse') {
                        pointsToAdd = 5;
                    } else if (q.type === 'fillInTheBlanks' || q.type === 'multipleChoice') {
                        pointsToAdd = 10;
                    }
                    
                    currentEntity.score += pointsToAdd; // Takım/katılımcı için skoru güncelle
                    // Hızlı cevaplama için bonus puanlar (ilk 10 saniye içinde)
                    if (timeTaken <= 10) {
                        currentEntity.score += 5; // Bonus 5 puan
                    }
                }
                Tone.start(); // Ses bağlamının başladığından emin ol
                correctSynth.triggerAttackRelease("C5", "8n"); // Doğru sesi çal

                // Sadece doğru cevaplandıysa doğru seçeneği vurgula
                let correctOptionValue = q.answer;
                if (q.type === 'trueFalse') {
                    correctOptionValue = (q.answer === 'D' ? 'Doğru' : 'Yanlış');
                }
                const correctRadio = document.querySelector(`input[name="${q.id}"][value="${correctOptionValue}"]`);
                if (correctRadio) {
                    const correctLabel = correctRadio.closest('label');
                    if (correctLabel) {
                        correctLabel.classList.add('correct-option-highlight');
                        correctLabel.classList.add('correct-animation');
                    }
                }
                // Doğru cevaplandı olarak sakla
                window.answeredQuestions[q.id] = { solvedByTeamId: window.currentTeamId, userAnswer: userAnswer, timeTaken: timeTaken };

            } else { // Yanlışsa
                Tone.start(); // Ses bağlamının başladığından emin ol
                incorrectSynth.triggerAttackRelease("C3", "8n"); // Yanlış sesi çal

                const selectedLabel = selected.closest('label');
                if (selectedLabel) {
                    selectedLabel.classList.add('incorrect-selected-option');
                    selectedLabel.classList.add('incorrect-animation');
                }
                // Yanlışsa doğru cevabı vurgulama (artık her iki mod için de)
                // Yanlış cevapları window.answeredQuestions'ta saklama
            }

            // Geri bildirimi göster (oyun moduna ve doğruluğa göre açıklama ile veya açıklamasız)
            if (isCorrect) {
                displayFeedback(true, q.answer, q.explanation); // Doğru cevaplar için her zaman doğru cevabı ve açıklamayı göster
            } else {
                displayFeedback(false, null, null); // Yanlış cevaplar için sadece "Yanlış" geri bildirimi göster
            }
            
            document.querySelectorAll(`input[name="${q.id}"]`).forEach(radio => radio.disabled = true);

            updateParticipantDisplay();
            renderQuestionNumbers();
            saveTeams(); // Güncellenmiş skorları kaydet
            saveGameState(); // Cevaplanmış soruları kaydet
            
            // Cevapladıktan sonra her zaman lider tablosuna dön
            window.returnToQuestionsGrid(); // Bu fonksiyon artık lider tablosuna götürür
        }

        /**
         * Kullanıcıya geri bildirim (doğru/yanlış) görüntüler.
         * @param {boolean} isCorrect - Cevap doğruysa true, aksi takdirde false.
         * @param {string} correctAnswer - Doğru cevap metni (isteğe bağlı, bireysel mod için).
         * @param {string} explanation - Cevabın açıklaması (isteğe bağlı, bireysel mod için).
         */
        function displayFeedback(isCorrect, correctAnswer, explanation) {
            feedbackDiv.classList.add('show'); 
            feedbackDiv.classList.remove('animate-in', 'correct', 'incorrect'); 

            if (isCorrect) {
                feedbackDiv.classList.add('correct');
                let icon = '✅';
                feedbackDiv.innerHTML = `<span class="feedback-icon">${icon}</span> Doğru!`;
                // Oyun modundan bağımsız olarak doğru cevaplar için her zaman açıklama göster
                if (explanation) { 
                    feedbackDiv.innerHTML += `<p class="explanation-text">${explanation}</p>`;
                }
            } else {
                feedbackDiv.classList.add('incorrect');
                let icon = '❌';
                feedbackDiv.innerHTML = `<span class="feedback-icon">${icon}</span> Yanlış.`;
                // Yanlış cevaplar için doğru cevabı veya açıklamayı gösterme
            }
            feedbackDiv.classList.add('animate-in');
        }

        /**
         * Soru navigasyon ızgarasını render eder.
         */
        function renderQuestionNumbers() {
            questionNavigationContainer.innerHTML = '';
            
            const questionsForDisplay = [...shuffledQuestions]; 

            questionsForDisplay.forEach((q, displayIndex) => { 
                const navItem = document.createElement('span');
                navItem.classList.add('question-nav-item');
                navItem.textContent = displayIndex + 1; 
                
                navItem.dataset.questionId = q.id; 

                // Sorunun doğru cevaplanıp cevaplanmadığını kontrol et
                if (window.answeredQuestions[q.id]) {
                    navItem.classList.add('answered-correctly');
                    navItem.onclick = () => {
                        window.selectQuestionById(q.id); // Doğru cevaplanmış soruları incelemeye izin ver
                    };
                } else {
                    // Cevaplanmamış veya yanlış cevaplanmış sorular tıklanabilir
                    navItem.onclick = () => {
                        window.selectQuestionById(q.id);
                    };
                }

                // Soru şu anda quiz içeriğinde görüntüleniyorsa, aktif olarak işaretle
                if (q.id === shuffledQuestions[window.currentQuestionIndex]?.id && !quizContentContainer.classList.contains('hidden')) {
                    navItem.classList.add('active-question');
                } else {
                    navItem.classList.remove('active-question');
                }
                
                questionNavigationContainer.appendChild(navItem);
            });
        }

        /**
         * ID'sine göre bir soru seçer ve render eder.
         * @param {string} questionId - Seçilecek sorunun ID'si.
         */
        window.selectQuestionById = function(questionId) {
            const originalIndex = shuffledQuestions.findIndex(q => q.id === questionId);
            if (originalIndex !== -1) {
                const selectedQuestion = shuffledQuestions[originalIndex];
                window.currentQuestionIndex = originalIndex; // Mevcut soru indeksini hemen ayarla

                // Bu yeni akışta, ünite seçimine ulaşmadan önce bir katılımcının seçildiği varsayılır.
                // Bu nedenle, soruyu doğrudan render edebiliriz.
                renderCurrentQuestion();
            } else {
                console.error("ID'si bulunamayan soru:", questionId);
            }
        };

        /**
         * Quiz içeriğinden veya soru ızgarasından katılımcı yönetimi ekranına (lider tablosu) döner.
         * Bu fonksiyon eski returnToQuestionsGrid'in yerini alır.
         */
        window.returnToQuestionsGrid = function() {
            quizContentContainer.classList.add('hidden');
            questionNavigationContainer.classList.add('hidden'); // Soru navigasyonunu gizle
            gamePanel.classList.add('hidden'); // Oyun panelini gizle
            if (questionCounterDisplay) {
                questionCounterDisplay.classList.add('hidden');
            }
            hideFinalScore();
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            
            // Katılımcı yönetimi ekranına geri dön
            participantManagementScreen.classList.remove('hidden');
            renderLeaderboard(); // Lider tablosunu güncelle
            updateParticipantDisplay(); // Lider tablosu ekranında mevcut katılımcı gösterimini güncelle
            gridInstructionMessage.classList.add('hidden'); // Izgara talimatlarını gizle
            questionScreenInstructionMessage.classList.add('hidden');
            nextTurnButton.classList.add('hidden'); // Sonraki tur butonunu gizle

            setGameBackground('general');

            fullscreenOverlay.classList.remove('show');
            setTimeout(() => fullscreenOverlay.classList.add('hidden'), 300);
            quizContentContainer.classList.remove('fullscreen-active');
        }

        /**
         * Takım modunda sıradaki takımın sırasına geçer.
         * Bu fonksiyon artık yeni bireysel odaklı akışta büyük ölçüde kullanılmaz.
         */
        window.moveToNextTurn = function() {
            if (window.gameMode === 'team') {
                const currentTeamIndex = window.teams.findIndex(t => t.id === window.currentTeamId);
                const nextTeamIndex = (currentTeamIndex + 1) % window.teams.length;
                window.currentTeamId = window.teams[nextTeamIndex].id;
                // Sonraki tura geçtikten sonra, soru ızgarasına (şimdi lider tablosuna gider) dön
                window.returnToQuestionsGrid(); // Genel fonksiyonu çağır
            } else {
                // Bireysel modda, bu düğme gizlidir, ancak bir şekilde tıklanırsa, lider tablosuna git
                window.returnToQuestionsGrid(); // Genel fonksiyonu çağır
            }
        };

        /**
         * Son skor ekranını görüntüler.
         */
        function showFinalScore() {
            quizContentContainer.classList.add('hidden');
            questionNavigationContainer.classList.add('hidden');
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            returnToQuestionGridButton.classList.add('hidden');
            nextTurnButton.classList.add('hidden'); // Son skorda sonraki tur butonunu gizle

            finalScoreContainer.classList.remove('hidden');
            resetGameButton.classList.remove('hidden');
            gridInstructionMessage.classList.add('hidden');
            questionScreenInstructionMessage.classList.add('hidden');
            setGameBackground(window.currentUnit);

            fullscreenOverlay.classList.remove('show');
            setTimeout(() => fullscreenOverlay.classList.add('hidden'), 300);
            quizContentContainer.classList.remove('fullscreen-active');

            let maxScore = 0;
            if (window.teams.length > 0) {
                maxScore = Math.max(...window.teams.map(p => p.score));
            }

            let winners = [];
            if (window.teams.length > 0) {
                winners = window.teams.filter(p => p.score === maxScore);
            }

            let winnerMessage = '';
            if (winners.length === 1) {
                winnerMessage = `${winners[0].name} kazandı! 🎉`;
                overallResultDiv.classList.add('correct');
                overallResultDiv.classList.remove('incorrect');
            } else if (winners.length > 1) {
                winnerMessage = `${winners.map(p => p.name).join(' ve ')} berabere kaldı! 🤝`;
                overallResultDiv.classList.remove('correct', 'incorrect');
            } else {
                winnerMessage = `Henüz kimse puan alamadı.`; // Oyun oynandıysa olmamalı
                overallResultDiv.classList.remove('correct', 'incorrect');
            }

            // Son katılımcı/takım skorlarını yeni tablo formatında render et
            finalParticipantScoresDisplay.innerHTML = ''; // Önceki içeriği temizle
            const finalScoreTable = document.createElement('div');
            finalScoreTable.classList.add('score-table');

            // Son gösterim için katılımcıları/takımları puana göre sırala
            const sortedEntities = [...window.teams].sort((a, b) => b.score - a.score);

            sortedEntities.forEach((entity) => {
                const scoreCell = document.createElement('div');
                scoreCell.classList.add('score-cell');
                scoreCell.innerHTML = `
                    <div class="flex flex-col items-center">
                        <span class="participant-name text-lg font-bold flex items-center gap-1">
                            ${entity.name}
                        </span>
                    </div>
                    <div class="flex flex-col items-center mt-2">
                        <span class="text-sm opacity-80 mb-1">Puan</span>
                        <span class="participant-score text-3xl font-extrabold">${entity.score}</span>
                    </div>
                `;
                finalScoreTable.appendChild(scoreCell);
            });
            finalParticipantScoresDisplay.appendChild(finalScoreTable);


            overallResultDiv.innerHTML = `<p class="mt-4 text-xl font-bold">${winnerMessage}</p>`;
            overallResultDiv.classList.add('show');
        }

        /**
         * Son skor ekranını gizler.
         */
        function hideFinalScore() {
            finalScoreContainer.classList.add('hidden');
            resetGameButton.classList.add('hidden');
        }

        /**
         * Bir diziyi rastgele karıştırır.
         * @param {Array} array - Karıştırılacak dizi.
         * @returns {Array} Karıştırılmış dizi.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        /**
         * Oyunu sıfırlamak için onay modalını gösterir.
         */
        window.showResetConfirmation = function() {
            confirmResetModal.classList.remove('hidden');
            confirmResetModal.classList.add('show');
        };

        /**
         * Oyunu sıfırlamak için onay modalını gizler.
         */
        window.hideResetConfirmation = function() {
            confirmResetModal.classList.remove('show');
            setTimeout(() => {
                confirmResetModal.classList.add('hidden');
            }, 300);
        };

        /**
         * Oyunu başlangıç durumuna (katılımcı yönetimi ekranı) sıfırlar ve tüm verileri temizler.
         * Bu fonksiyon artık onay modalının "Evet" düğmesi tarafından çağrılır.
         */
        window.confirmResetGame = function() {
            window.teams = []; // Tam sıfırlama için tüm takımları/katılımcıları temizle
            window.currentTeamId = null;
            window.currentQuestionIndex = 0;
            window.answeredQuestions = {};
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            shuffledQuestions = [];
            window.currentUnit = null;
            window.gameMode = null; // Oyun modunu sıfırla
            window.selectedQuestionIdForModal = null; // Bunu da sıfırla

            localStorage.removeItem(LOCAL_STORAGE_KEY_TEAMS);
            localStorage.removeItem(LOCAL_STORAGE_KEY_CURRENT_UNIT);
            localStorage.removeItem(LOCAL_STORAGE_KEY_GAME_MODE);
            localStorage.removeItem(LOCAL_STORAGE_KEY_ANSWERED_QUESTIONS);

            quizContentContainer.classList.add('hidden');
            hideFinalScore();
            questionNavigationContainer.classList.add('hidden');
            gamePanel.classList.add('hidden');
            unitSelectionScreen.classList.add('hidden'); // Ünite seçiminin gizli olduğundan emin ol
            gameModeSelectionScreen.classList.add('hidden'); // Oyun modu seçiminin gizli olduğundan emin ol
            participantManagementScreen.classList.remove('hidden'); // Katılımcı yönetimini göster
            gridInstructionMessage.classList.add('hidden');
            questionScreenInstructionMessage.classList.add('hidden');
            returnToQuestionGridButton.classList.add('hidden');
            nextTurnButton.classList.add('hidden'); // Sonraki tur butonunu gizle
            if (questionCounterDisplay) {
                questionCounterDisplay.classList.add('hidden');
            }
            setGameBackground('general');

            fullscreenOverlay.classList.remove('show');
            setTimeout(() => fullscreenOverlay.classList.add('hidden'), 300);
            quizContentContainer.classList.remove('fullscreen-active');

            if (currentParticipantDisplay) {
                currentParticipantDisplay.textContent = "Sıra: Katılımcı/Takım Seçin"; 
                currentParticipantDisplay.classList.remove('text-gray-600', 'font-normal');
                currentParticipantDisplay.classList.add('current-participant-display');
            }
            renderLeaderboard(); // Boş lider tablosunu yeniden render et
            applyButtonColors();
            window.hideResetConfirmation(); // Sıfırlamadan sonra onay modalını gizle
        }

        /**
         * Katılımcı yönetimi ekranına döner.
         */
        window.returnToMainMenu = function() {
            // Bu fonksiyon artık 'katılımcı yönetimine dön' olarak işlev görür.
            // Mevcut oyun oturumu durumunu sıfırlar, ancak katılımcı verilerini korur.
            window.currentTeamId = null;
            window.currentQuestionIndex = 0;
            window.answeredQuestions = {}; // Bu oturum için cevaplanmış soruları temizle
            clearInterval(timerInterval);
            timerDisplay.classList.add('hidden');
            shuffledQuestions = [];
            window.currentUnit = null;
            window.gameMode = null;
            window.selectedQuestionIdForModal = null;

            // Burada localStorage'ı temizleme, sadece resetGame() bunu yapar
            localStorage.removeItem(LOCAL_STORAGE_KEY_CURRENT_UNIT);
            localStorage.removeItem(LOCAL_STORAGE_KEY_GAME_MODE);
            localStorage.removeItem(LOCAL_STORAGE_KEY_ANSWERED_QUESTIONS);

            quizContentContainer.classList.add('hidden');
            hideFinalScore();
            questionNavigationContainer.classList.add('hidden');
            gamePanel.classList.add('hidden');
            unitSelectionScreen.classList.add('hidden');
            gameModeSelectionScreen.classList.add('hidden');
            participantManagementScreen.classList.remove('hidden'); // Katılımcı yönetimini göster
            gridInstructionMessage.classList.add('hidden');
            questionScreenInstructionMessage.classList.add('hidden');
            returnToQuestionGridButton.classList.add('hidden');
            nextTurnButton.classList.add('hidden');
            if (questionCounterDisplay) {
                questionCounterDisplay.classList.add('hidden');
            }
            setGameBackground('general');

            fullscreenOverlay.classList.remove('show');
            setTimeout(() => fullscreenOverlay.classList.add('hidden'), 300);
            quizContentContainer.classList.remove('fullscreen-active');

            if (currentParticipantDisplay) {
                currentParticipantDisplay.textContent = "Sıra: Katılımcı/Takım Seçin"; 
                currentParticipantDisplay.classList.remove('text-gray-600', 'font-normal');
                currentParticipantDisplay.classList.add('current-participant-display');
            }
            // Kaldırıldı: if (scoreBoardContainer) { scoreBoardContainer.classList.remove('hidden'); }
            renderLeaderboard(); // Mevcut skorlarla lider tablosunu yeniden render et
            applyButtonColors();
        }

        /**
         * Oyun modu seçiminden ünite seçim ekranına döner.
         * Bu fonksiyon artık sadece açıkça yönlendirildiğinde çağrılır, ana akışta ünite seçiminden değil.
         */
        window.returnToUnitSelection = function() { // Genel yapıldı
            gameModeSelectionScreen.classList.add('hidden');
            unitSelectionScreen.classList.remove('hidden');
            gameModeMessage.classList.add('hidden');
            setGameBackground('general');
            window.hideParticipantSelectionModal(); // Genel fonksiyonu çağır
            window.hideTeamSetupModal(); // Genel fonksiyonu çağır
        };

        /**
         * Ünite seçiminden katılımcı yönetimi ekranına döner.
         */
        window.returnToParticipantManagement = function() {
            unitSelectionScreen.classList.add('hidden');
            participantManagementScreen.classList.remove('hidden');
            setGameBackground('general');
            renderLeaderboard(); // Lider tablosunu yeniden render et
        };

        /**
         * Buton renkleri ve gölgeleri için belirli Tailwind CSS sınıflarını uygular.
         */
        function applyButtonColors() {
            const removeAllButtonColors = (element) => {
                const allColors = [
                    'bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50',
                    'bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50',
                    'bg-purple-600', 'hover:bg-purple-700', 'shadow-purple-500/50',
                    'bg-yellow-600', 'hover:bg-yellow-700', 'shadow-yellow-500/50',
                    'bg-pink-600', 'hover:bg-pink-700', 'shadow-pink-500/50',
                    'bg-indigo-600', 'hover:bg-indigo-700', 'shadow-indigo-500/50',
                    'bg-red-600', 'hover:bg-red-700', 'shadow-red-500/50',
                    'bg-teal-600', 'hover:bg-teal-700', 'shadow-teal-500/50',
                    'bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50',
                    'bg-orange-600', 'hover:bg-orange-700', 'shadow-orange-500/50'
                ];
                element.classList.remove(...allColors);
            };

            const buttonColorSets = [
                ['bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50'],
                ['bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50'],
                ['bg-purple-600', 'hover:bg-purple-700', 'shadow-purple-500/50'],
                ['bg-yellow-600', 'hover:bg-yellow-700', 'shadow-yellow-500/50'],
                ['bg-pink-600', 'hover:bg-pink-700', 'shadow-pink-500/50'],
                ['bg-indigo-600', 'hover:bg-indigo-700', 'shadow-indigo-500/50'],
                ['bg-red-600', 'hover:bg-red-700', 'shadow-red-500/50'],
                ['bg-teal-600', 'hover:bg-teal-700', 'shadow-teal-500/50']
            ];

            const unitButtons = document.querySelectorAll('#unit-selection-screen .action-button'); 
            unitButtons.forEach((button, index) => {
                removeAllButtonColors(button);
                button.classList.add(...buttonColorSets[index % buttonColorSets.length]);
            });

            // Katılımcı Yönetimi Ekranı butonları
            if (addNewParticipantMainButton) {
                removeAllButtonColors(addNewParticipantMainButton);
                addNewParticipantMainButton.classList.add('bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50', 'main-action-button'); /* main-action-button eklendi */
            }
            if (showRegisteredUsersButton) {
                removeAllButtonColors(showRegisteredUsersButton);
                showRegisteredUsersButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50', 'main-action-button'); /* main-action-button eklendi */
            }
            if (goToMainSiteButton) {
                removeAllButtonColors(goToMainSiteButton);
                goToMainSiteButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }
            // Yeni "Baştan Başla" düğmesi
            if (startOverButton) {
                removeAllButtonColors(startOverButton);
                startOverButton.classList.add('bg-red-600', 'hover:bg-red-700', 'shadow-red-500/50');
            }

            // Oyun modu seçim butonları
            const individualModeButton = document.getElementById('individual-mode-button');
            if (individualModeButton) {
                removeAllButtonColors(individualModeButton);
                individualModeButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50');
            }
            const teamModeButton = document.getElementById('team-mode-button');
            if (teamModeButton) {
                removeAllButtonColors(teamModeButton);
                teamModeButton.classList.add('bg-purple-600', 'hover:bg-purple-700', 'shadow-purple-500/50');
            }
            const returnToUnitSelectionButton = document.getElementById('return-to-unit-selection-button');
            if (returnToUnitSelectionButton) {
                removeAllButtonColors(returnToUnitSelectionButton);
                returnToUnitSelectionButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }

            // Oyun paneli butonları
            if (returnToQuestionGridButton) {
                removeAllButtonColors(returnToQuestionGridButton);
                returnToQuestionGridButton.classList.add('bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50');
            }
            if (returnToMainMenuGridButton) {
                removeAllButtonColors(returnToMainMenuGridButton);
                returnToMainMenuGridButton.classList.add('bg-purple-600', 'hover:bg-purple-700', 'shadow-purple-500/50');
            }
            if (resetGameButton) {
                removeAllButtonColors(resetGameButton);
                resetGameButton.classList.add('bg-red-600', 'hover:bg-red-700', 'shadow-red-500/50');
            }
            if (document.getElementById('return-to-main-menu-from-final-button')) {
                const finalReturnButton = document.getElementById('return-to-main-menu-from-final-button');
                removeAllButtonColors(finalReturnButton);
                finalReturnButton.classList.add('bg-orange-600', 'hover:bg-orange-700', 'shadow-orange-500/50');
            }
            const goToMainSiteButtons = document.querySelectorAll('[id^="go-to-main-site-button-"]');
            goToMainSiteButtons.forEach(button => {
                removeAllButtonColors(button);
                button.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            });

            // Modal butonları
            if (nextTurnButton) {
                removeAllButtonColors(nextTurnButton);
                nextTurnButton.classList.add('bg-yellow-600', 'hover:bg-yellow-700', 'shadow-yellow-500/50');
            }
            const generateTeamNamesButton = document.getElementById('generate-team-names-button');
            if (generateTeamNamesButton) {
                removeAllButtonColors(generateTeamNamesButton);
                generateTeamNamesButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50');
            }
            const submitTeamSetupButton = document.getElementById('submit-team-setup-button');
            if (submitTeamSetupButton) {
                removeAllButtonColors(submitTeamSetupButton);
                submitTeamSetupButton.classList.add('bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50');
            }
            const cancelTeamSetupButton = document.getElementById('cancel-team-setup-button');
            if (cancelTeamSetupButton) {
                removeAllButtonColors(cancelTeamSetupButton);
                cancelTeamSetupButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }
            const selectExistingParticipantButtonElement = document.getElementById('select-existing-participant-button');
            if (selectExistingParticipantButtonElement) {
                removeAllButtonColors(selectExistingParticipantButtonElement);
                selectExistingParticipantButtonElement.classList.add('bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-500/50');
            }
            // Katılımcı seçim modalında yeni düzenle düğmesi
            if (editSelectedParticipantButton) {
                removeAllButtonColors(editSelectedParticipantButton);
                editSelectedParticipantButton.classList.add('bg-yellow-500', 'hover:bg-yellow-600', 'shadow-yellow-500/50');
            }
            // Katılımcı seçim modalında "İptal Et" düğmesi için renk
            const cancelParticipantSelectionButton = document.getElementById('cancel-participant-selection-button');
            if (cancelParticipantSelectionButton) {
                removeAllButtonColors(cancelParticipantSelectionButton);
                cancelParticipantSelectionButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }

            const returnToParticipantManagementFromUnitButton = document.getElementById('return-to-participant-management-from-unit');
            if (returnToParticipantManagementFromUnitButton) {
                removeAllButtonColors(returnToParticipantManagementFromUnitButton);
                returnToParticipantManagementFromUnitButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }

            // Onay modalı butonları
            if (confirmResetYesButton) {
                removeAllButtonColors(confirmResetYesButton);
                confirmResetYesButton.classList.add('bg-red-600', 'hover:bg-red-700', 'shadow-red-500/50');
            }
            if (confirmResetNoButton) {
                removeAllButtonColors(confirmResetNoButton);
                confirmResetNoButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }
            
            // Katılımcı düzenleme modalı butonları
            const saveEditParticipantButton = document.getElementById('save-edit-participant-button');
            if (saveEditParticipantButton) {
                removeAllButtonColors(saveEditParticipantButton);
                saveEditParticipantButton.classList.add('bg-green-600', 'hover:bg-green-700', 'shadow-green-500/50');
            }
            const cancelEditParticipantButton = document.getElementById('cancel-edit-participant-button');
            if (cancelEditParticipantButton) {
                removeAllButtonColors(cancelEditParticipantButton);
                cancelEditParticipantButton.classList.add('bg-gray-600', 'hover:bg-gray-700', 'shadow-gray-500/50');
            }
        }

        // Sayfa yüklendiğinde ilk kurulum
        window.onload = async function() { 
            // DOM öğelerini burada ata, yüklendiğinden emin olmak için
            participantManagementScreen = document.getElementById('participant-management-screen');
            leaderboardContainer = document.getElementById('leaderboard-container');
            newParticipantNameInputMain = document.getElementById('new-participant-name-input-main');
            addNewParticipantMainButton = document.getElementById('add-new-participant-main-button');
            showRegisteredUsersButton = document.getElementById('show-registered-users-button');
            startOverButton = document.getElementById('start-over-button'); // Yeni düğmeyi ata
            unitSelectionScreen = document.getElementById('unit-selection-screen');
            gameModeSelectionScreen = document.getElementById('game-mode-selection-screen');
            gameModeMessage = document.getElementById('game-mode-message');
            gamePanel = document.getElementById('game-panel');
            scoreBoardContainer = document.getElementById('score-board-container');
            currentParticipantDisplay = document.getElementById('current-participant-display');
            quizContentContainer = document.getElementById('quiz-content');
            questionContainer = document.getElementById('current-question-container');
            feedbackDiv = document.getElementById('current-question-feedback');
            overallResultDiv = document.getElementById('overall-result'); 
            finalScoreContainer = document.getElementById('final-score-container');
            resetGameButton = document.getElementById('reset-game-button');
            questionCounterDisplay = document.getElementById('question-counter');
            questionNavigationContainer = document.getElementById('question-navigation');
            timerDisplay = document.getElementById('timer-display');
            gridInstructionMessage = document.getElementById('grid-instruction-message'); 
            questionScreenInstructionMessage = document.getElementById('question-screen-instruction-message'); 
            fullscreenOverlay = document.getElementById('fullscreen-overlay');
            returnToMainMenuGridButton = document.getElementById('return-to-main-menu-grid-button');
            returnToQuestionGridButton = document.getElementById('return-to-question-grid-button');
            finalParticipantScoresDisplay = document.getElementById('final-participant-scores-display');
            goToMainSiteButton = document.getElementById('go-to-main-site-button');
            participantSelectionModal = document.getElementById('participant-selection-modal');
            existingParticipantsButtonsContainer = document.getElementById('existing-participants-buttons');
            selectExistingParticipantButton = document.getElementById('select-existing-participant-button');
            editSelectedParticipantButton = document.getElementById('edit-selected-participant-button'); // Yeni düzenle düğmesini ata
            nextTurnButton = document.getElementById('next-turn-button');
            teamSetupModal = document.getElementById('team-setup-modal');
            numTeamsInput = document.getElementById('num-teams-input');
            teamNameInputsContainer = document.getElementById('team-name-inputs-container');
            confirmResetModal = document.getElementById('confirm-reset-modal'); // Yeni modalı ata
            confirmResetYesButton = document.getElementById('confirm-reset-yes'); // Yeni düğmeleri ata
            confirmResetNoButton = document.getElementById('confirm-reset-no'); // Yeni düğmeleri ata
            editParticipantModal = document.getElementById('edit-participant-modal'); // Yeni düzenleme modalını ata
            editParticipantNameInput = document.getElementById('edit-participant-name-input'); // Yeni girişi ata
            editParticipantScoreInput = document.getElementById('edit-participant-score-input'); // Yeni skor girişini ata
            editParticipantErrorMessage = document.getElementById('edit-participant-error-message'); // Yeni hata mesajını ata
            editParticipantScoreErrorMessage = document.getElementById('edit-participant-score-error-message'); // Yeni skor hata mesajını ata

            // Takımları ve oyun durumunu yükle
            loadTeams();
            loadGameState();

            // Başlangıçta katılımcı yönetimi ekranını göster ve diğerlerini gizle
            participantManagementScreen.classList.remove('hidden');
            unitSelectionScreen.classList.add('hidden');
            gameModeSelectionScreen.classList.add('hidden');
            gamePanel.classList.add('hidden');
            questionCounterDisplay.classList.add('hidden');
            returnToQuestionGridButton.classList.add('hidden');
            nextTurnButton.classList.add('hidden');
            teamSetupModal.classList.add('hidden');
            confirmResetModal.classList.add('hidden'); // Onay modalının gizli olduğundan emin ol
            editParticipantModal.classList.add('hidden'); // Katılımcı düzenleme modalının gizli olduğundan emin ol
            
            setGameBackground('general');
            renderLeaderboard(); // İlk yüklemede lider tablosunu render et
            applyButtonColors();

            // Tone.js sentezleyicilerini başlat
            correctSynth = new Tone.Synth().toDestination();
            incorrectSynth = new Tone.Synth().toDestination();
            timerSynth = new Tone.Synth().toDestination();

            // "Siteye Dön" butonları için olay dinleyicileri ekle
            const allGoToSiteButtons = document.querySelectorAll('[id^="go-to-main-site-button"]');
            allGoToSiteButtons.forEach(button => {
                button.addEventListener('click', () => {
                    window.location.href = 'https://ozeme42.github.io/yunus/index.html';
                });
            });

            // Modal kapatma butonları için olay dinleyicileri ekle
            document.getElementById('close-participant-modal').addEventListener('click', window.hideParticipantSelectionModal); // Genel fonksiyonu çağır
            document.getElementById('close-team-modal').addEventListener('click', window.hideTeamSetupModal); // Genel fonksiyonu çağır
            document.getElementById('close-reset-modal').addEventListener('click', window.hideResetConfirmation); // Sıfırlama modalı için kapatma düğmesi
            document.getElementById('close-edit-participant-modal').addEventListener('click', window.hideEditParticipantModal); // Katılımcı düzenleme modalı için kapatma düğmesi

            // Katılımcı seçim modalında yeni "Düzenle" düğmesi için olay dinleyicisi ekle
            if (editSelectedParticipantButton) {
                editSelectedParticipantButton.addEventListener('click', () => {
                    if (selectedParticipantIdInModal) {
                        window.showEditParticipantModal(selectedParticipantIdInModal);
                    }
                });
            }
        };
    </script>
</head>
<body>
    <div id="fullscreen-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden opacity-0 transition-opacity duration-300"></div>

    <div id="participant-selection-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-participant-modal" class="modal-close-button">✖</button>
            <h3>Kayıtlı Katılımcı Seçimi</h3>
            <div id="existing-participants-buttons" class="mb-4">
                </div>
            <div class="button-group mt-6">
                <button id="select-existing-participant-button" class="action-button" onclick="selectExistingParticipant()">Seç ve Başla</button>
                <button id="edit-selected-participant-button" class="action-button" disabled>Düzenle</button> <button id="cancel-participant-selection-button" class="action-button" onclick="window.hideParticipantSelectionModal()">İptal Et</button>
            </div>
        </div>
    </div>

    <div id="edit-participant-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-edit-participant-modal" class="modal-close-button">✖</button>
            <h3>Katılımcı Adını Düzenle</h3>
            <label for="edit-participant-name-input" class="block text-gray-700 text-base font-medium mb-1 text-left">Adı:</label>
            <input type="text" id="edit-participant-name-input" class="edit-participant-modal-input" placeholder="Yeni Katılımcı Adı">
            <p id="edit-participant-error-message" class="text-red-500 text-sm mt-0 mb-2 text-left hidden"></p>

            <label for="edit-participant-score-input" class="block text-gray-700 text-base font-medium mb-1 text-left">Puanı:</label>
            <input type="number" id="edit-participant-score-input" class="edit-participant-modal-input" placeholder="Yeni Puan">
            <p id="edit-participant-score-error-message" class="text-red-500 text-sm mt-0 mb-2 text-left hidden"></p>

            <div class="button-group mt-6">
                <button id="save-edit-participant-button" class="action-button" onclick="saveEditedParticipantName()">Kaydet</button>
                <button id="cancel-edit-participant-button" class="action-button" onclick="cancelEditParticipantName()">İptal Et</button>
            </div>
        </div>
    </div>

    <div id="team-setup-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-team-modal" class="modal-close-button">✖</button>
            <h3>Takım Ayarları</h3>
            <label for="num-teams-input" class="block text-gray-700 text-lg font-medium mb-2">Takım Sayısı (2-10):</label>
            <input type="number" id="num-teams-input" class="w-full p-2 border rounded mb-4" min="2" max="10" value="2" onchange="generateTeamNameInputs()">
            <div class="button-group mb-4">
                <button id="generate-team-names-button" class="action-button" onclick="generateTeamNameInputs()">İsimleri Oluştur</button>
            </div>
            <div id="team-name-inputs-container" class="team-name-inputs">
                </div>
            <div class="button-group mt-6">
                <button id="submit-team-setup-button" class="action-button" onclick="submitTeamSetup()">Oyuna Başla</button>
                <button id="cancel-team-setup-button" class="action-button" onclick="window.returnToUnitSelection()">İptal Et</button>
            </div>
        </div>
    </div>

    <div id="confirm-reset-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-reset-modal" class="modal-close-button">✖</button>
            <h3>Oyunu Baştan Başlat</h3>
            <p class="text-gray-700 text-xl mb-6">Tüm kayıtlı öğrenci verileri ve puanları silinecektir. Emin misiniz?</p>
            <div class="button-group">
                <button id="confirm-reset-yes" class="action-button" onclick="confirmResetGame()">Evet, Eminim</button>
                <button id="confirm-reset-no" class="action-button" onclick="hideResetConfirmation()">Hayır, İptal Et</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Din Kültürü ve Ahlak Bilgisi Bilgi Yarışması</h1>

        <div id="participant-management-screen" class="player-selection-screen">
            <div id="leaderboard-container" class="score-table-container">
                </div>

            <div class="w-full max-w-lg">
                <input type="text" id="new-participant-name-input-main" class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg mb-4 focus:outline-none focus:border-blue-500" placeholder="Yeni Öğrenci Adı">
                <div class="flex justify-center gap-4 mb-4">
                    <button id="add-new-participant-main-button" class="action-button flex-1 main-action-button" onclick="addNewParticipantAndProceed()">Yeni Öğrenci Ekle ve Başla</button>
                    <button id="show-registered-users-button" class="action-button flex-1 main-action-button" onclick="showRegisteredUsersScreen()">Kayıtlı Öğrenci Seç</button>
                </div>
            </div>
            <div class="button-group mt-8 w-full max-w-2xl mx-auto">
                <button id="start-over-button" class="action-button flex-1" onclick="showResetConfirmation()">Baştan Başla</button>
                <button id="go-to-main-site-button" class="action-button flex-1" onclick="window.location.href = 'https://ozeme42.github.io/yunus/index.html';">Siteye Dön</button>
            </div>
        </div>

        <div id="unit-selection-screen" class="player-selection-screen hidden">
            <h2>Ünite Seçimi</h2>
            <div class="selection-buttons">
                <button class="action-button" onclick="selectUnit('unit1')">1. Ünite: Melek ve Ahiret İnancı</button>
                <button class="action-button" onclick="selectUnit('unit2')">2. Ünite: Hac ve Kurban</button>
                <button class="action-button" onclick="selectUnit('unit3')">3. Ünite: Ahlaki Davranışlar</button>
                <button class="action-button" onclick="selectUnit('unit4')">4. Ünite: Allah'ın Kulu ve Elçisi Hz. Muhammed (s.a.v.)</button>
                <button class="action-button" onclick="selectUnit('unit5')">5. Ünite: İslam Düşüncesinde Yorumlar</button>
            </div>
            <button id="return-to-participant-management-from-unit" class="action-button mt-8" onclick="returnToParticipantManagement()">Geri Dön</button>
        </div>

        <div id="game-mode-selection-screen" class="player-selection-screen hidden">
            <h2>Oyun Modu Seçimi</h2>
            <div class="selection-buttons">
                <button id="individual-mode-button" class="action-button" onclick="selectGameMode('individual')">Bireysel Oyna</button>
                <button id="team-mode-button" class="action-button" onclick="selectGameMode('team')">Takımlı Oyna</button>
            </div>
            <p id="game-mode-message" class="text-red-500 font-bold mt-4 hidden"></p>
            <button id="return-to-unit-selection-button" class="action-button mt-8" onclick="window.returnToUnitSelection()">Ünite Seçimine Dön</button>
        </div>

        <div id="game-panel" class="hidden">
            <div id="score-board-container" class="score-table-container">
                </div>
            <div id="current-participant-display" class="current-participant-display">Sıra: Katılımcı Seçin</div>

            <div id="grid-instruction-message" class="text-center text-md font-medium text-gray-700 mb-4"></div>
            <div id="question-navigation" class="question-navigation">
                </div>
            
            <div class="button-group mt-4" id="question-grid-buttons">
                <button id="return-to-main-menu-grid-button" class="action-button" onclick="returnToMainMenu()">Ana Sayfaya Dön</button>
                <button id="go-to-main-site-button-grid" class="action-button" onclick="window.location.href = 'https://ozeme42.github.io/yunus/index.html';">Siteye Dön</button>
            </div>

            <div id="quiz-content" class="hidden">
                <div class="question-area">
                    <div id="question-counter" class="question-counter"></div>
                    <div id="timer-display" class="timer-display hidden"></div>
                    <div id="current-question-container" class="question-block">
                        </div>
                </div>
                <div id="current-question-feedback" class="feedback-message"></div>
                <div class="button-group mt-4">
                    <button id="next-turn-button" class="action-button next-button hidden" onclick="moveToNextTurn()">Sonraki Oyuncu</button>
                    <button id="return-to-question-grid-button" class="action-button return-button" onclick="window.returnToQuestionsGrid()">Soru Ekranına Dön</button>
                </div>
                <div id="question-screen-instruction-message" class="text-center text-md font-medium text-gray-700 mt-2 hidden"></div>
            </div>

            <div id="final-score-container" class="hidden">
                <div id="overall-result" class="feedback-message"></div>
                <div id="final-participant-scores-display" class="score-table-container"></div>
                <button id="reset-game-button" class="action-button" onclick="resetGame()">Yeniden Başla</button>
                <button id="return-to-main-menu-from-final-button" class="action-button mt-4" onclick="returnToMainMenu()">Ana Sayfaya Dön</button>
                <button id="go-to-main-site-button-final" class="action-button mt-4" onclick="window.location.href = 'https://ozeme42.github.io/yunus/index.html';">Siteye Dön</button>
            </div>
        </div>
    </div>
</body>
</html>
