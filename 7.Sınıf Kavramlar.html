<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kavram Bilgi Yarışması</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2f7; /* Light blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Changed to border-box for better layout control */
            overflow-x: hidden;
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .container {
            background-color: #ffffff;
            border-radius: 0;
            box-shadow: none;
            max-width: 100%;
            width: 100%;
            height: 100vh;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2.5rem 1rem;
            box-sizing: border-box;
            overflow-y: auto; /* Enable scrolling for editor content */
            padding-top: 2rem; /* Başlık için üstten boşluk */
        }
        .concept-box {
            min-width: 120px;
            max-width: 220px;
            min-height: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #000000;
            font-size: 1.05rem;
            font-weight: bold;
            border-radius: 9999px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out, background-color 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            cursor: pointer;
            position: relative;
            animation: bubbleFloat var(--animation-duration) ease-in-out var(--animation-delay) infinite alternate;
        }
        .concept-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
            z-index: 1;
        }
        .concept-box span {
            position: relative;
            z-index: 2;
            padding: 0.75rem 1rem;
            text-align: center;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.2;
            display: block;
        }

        .concept-box:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .concept-box.correct {
            background-color: #10B981;
            border-color: #047857;
            box-shadow: 0 0 35px rgba(16, 185, 129, 1);
            border-width: 5px;
            border-style: solid;
            transform: scale(1.08);
        }
        .concept-box.incorrect {
            border-color: #EF4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
        }
        .quiz-area {
            width: 100%;
            max-width: none;
            text-align: left;
            background: linear-gradient(to right, #A8D8FF, #4D94FF);
            border: 3px dashed #67a9cf;
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .question-line {
            display: flex;
            flex-direction: column; /* Changed to column to stack question and answer */
            align-items: flex-start;
            margin-bottom: 1.5rem;
            width: 100%;
        }
        .question-line h2 {
            margin-right: 0.5rem;
            margin-bottom: 0;
            flex-shrink: 0;
            font-size: 2.25rem;
        }
        .question-line p {
            flex-grow: 1;
            margin-bottom: 0;
            font-size: 1.5rem;
        }

        .message-box {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            width: 100%;
        }
        .message-box.success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .message-box.error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .action-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            width: 100%;
        }
        .action-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .action-button:active {
            transform: translateY(0);
        }
        .button-group {
            display: flex;
            gap: 1rem;
            width: 100%;
            max-width: none;
            margin-top: 2rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        .button-group .action-button {
            flex: 1;
        }
        .reset-button {
            background-color: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            width: 100%;
            max-width: none;
        }
        .reset-button:hover {
            background-color: #4b5563;
        }

        /* Responsive grid for concept boxes */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* Max 8 concepts, so 4 columns for 2 rows */
            justify-content: center;
            gap: 1rem;
            max-width: 900px; /* Limit max width for better visual */
            margin: 0 auto; /* Center the grid */
        }

        /* Timer display style */
        #timerDisplay {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            text-align: center;
            padding: 0.5rem 1rem;
            background-color: transparent;
            border-radius: 0.5rem;
            box-shadow: none;
            z-index: 10;
        }
        #timerDisplay.warning {
            color: #EF4444;
        }

        /* Checkmark icon style */
        .concept-box .checkmark {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .concept-box.correct .checkmark {
            opacity: 1;
        }


        /* Media queries for responsive column reduction/expansion */
        @media (max-width: 992px) {
            .concept-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (max-width: 768px) {
            .concept-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 640px) {
            .concept-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 480px) {
            .concept-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        /* Bubble animation definition */
        @keyframes bubbleFloat {
            0% { transform: translate(0px, 0px) scale(1); opacity: 0.9; }
            50% { transform: translate(var(--translate-x), var(--translate-y)) scale(1.02); opacity: 0.95; }
            100% { transform: translate(0px, 0px) scale(1); opacity: 0.9; }
        }

        /* Unit selection screen styles */
        #mainMenuScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            padding: 2rem;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        /* New unit grid style */
        .unit-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Default 3 columns */
            gap: 1.5rem; /* Gap between cards */
            width: 90%; /* Occupy more width */
            max-width: 1200px; /* Max width for the grid */
            justify-items: center; /* Center items in the grid */
            margin: 0 auto; /* Added to center the grid itself */
            flex-grow: 1; /* Allow unit grid to grow and push button down */
            align-items: center; /* Center items vertically within the grid area */
        }
        .unit-card {
            padding: 1.5rem;
            border-radius: 1rem;
            width: 100%; /* Take full width of its grid column */
            aspect-ratio: 4/3; /* Maintain aspect ratio for better visual consistency */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            font-size: 1.25rem;
            font-weight: 600;
            color: #333; /* Darker text for better contrast on gradients */
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0,0,0,0.1); /* Subtle border */
        }
        .unit-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .unit-card.selected {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 0 3px #3b82f6; /* Blue glow and thicker border */
            border-color: #3b82f6;
        }
        .main-quiz-content {
            display: none; /* Hidden by default */
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        /* Editor specific styles - These are hidden in normal mode */
        #editorScreen {
            display: none;
        }
        .editor-section {
            display: none;
        }
        .editor-list-item {
            display: none;
        }
        .editor-controls {
            display: none;
        }
        .editor-form {
            display: none;
        }
        .editor-form-buttons {
            display: none;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .modal-content h4 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .modal-content input[type="text"],
        .modal-content textarea {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #ccc;
            font-size: 1rem;
            width: 100%;
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .modal-save-btn {
            background-color: #3b82f6;
            color: white;
        }
        .modal-save-btn:hover {
            background-color: #2563eb;
        }
        .modal-cancel-btn {
            background-color: #6b7280;
            color: white;
        }
        .modal-cancel-btn:hover {
            background-color: #4b5563;
        }
        .modal-confirm-btn {
            background-color: #f44336;
            color: white;
        }
        .modal-confirm-btn:hover {
            background-color: #da190b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-bold text-gray-800 mb-6">Kavram Bilgi Yarışması</h1>

        <div id="mainMenuScreen">
            <div id="unitCardsContainer" class="unit-grid">
                </div>
            <button id="startQuizBtn" class="action-button px-8 py-3 text-xl" style="display: none;">Yarışmayı Başlat</button>
            </div>

        <div id="mainQuizContent" class="main-quiz-content">
            <div id="quizArea" class="quiz-area">
                <div class="question-line">
                    <h2 class="text-3xl font-bold text-gray-700">Soru:</h2>
                    <p id="questionText" class="text-xl text-gray-800"></p>
                </div>
                <div id="timerDisplay">50</div>
                <div id="feedback" class="message-box mt-4" style="display: none;"></div>
            </div>

            <div id="conceptBoxes" class="concept-grid w-full justify-items-center">
            </div>

            <div class="button-group">
                <button id="nextQuestionBtn" class="action-button">Sonraki Soru</button>
            </div>

            <button id="resetQuizBtn" class="reset-button">Yarışmayı Yeniden Başlat</button>
            <button id="returnToMainMenuFromQuizBtn" class="action-button bg-gray-500 hover:bg-gray-700 mt-4">Ana Menüye Dön</button>
        </div>

        <div id="editorScreen" style="display: none;"></div>
    </div>

    <div id="customModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h4 id="modalTitle"></h4>
            <p id="modalMessage" class="text-gray-700"></p>
            <input type="text" id="modalInput1" style="display: none;">
            <input type="text" id="modalInput2" style="display: none;">
            <textarea id="modalTextarea" style="display: none;"></textarea>
            <div class="modal-buttons">
                <button id="modalConfirmBtn" class="modal-confirm-btn" style="display: none;">Evet</button>
                <button id="modalSaveBtn" class="modal-save-btn" style="display: none;">Kaydet</button>
                <button id="modalCancelBtn" class="modal-cancel-btn">İptal</button>
            </div>
        </div>
    </div>

    <script>
        // Ünite ve kavram verileri (7. Sınıf Din Kültürü ve Ahlak Bilgisi müfredatına uygun olarak güncellenmiştir)
        let units = [
            {
                id: 'unit1-7th',
                name: 'Ünite 1: Melek ve Ahiret İnancı',
                concepts: [
                    {
                        id: 'melek',
                        name: 'Melek',
                        color: 'bg-blue-600',
                        questions: [
                            { question: 'Allah\'ın nurdan yarattığı, gözle görülmeyen, daima Allah\'a ibadet eden varlıklara ne denir?' },
                            { question: 'Vahiy getiren, rızıkları dağıtan, ruhları alan gibi çeşitli görevleri olan varlıklar kimlerdir?' }
                        ]
                    },
                    {
                        id: 'ahiret',
                        name: 'Ahiret',
                        color: 'bg-green-600',
                        questions: [
                            { question: 'Dünya hayatından sonra başlayacak olan sonsuz hayata ne denir?' },
                            { question: 'İnsanların dünyada yaptıkları iyilik ve kötülüklerin karşılığını göreceği yer neresidir?' }
                        ]
                    },
                    {
                        id: 'kaza-kader',
                        name: 'Kaza ve Kader',
                        color: 'bg-purple-600',
                        questions: [
                            { question: 'Allah\'ın her şeyi önceden bilip takdir etmesine ne denir?' },
                            { question: 'Allah\'ın takdir ettiği şeylerin zamanı gelince gerçekleşmesine ne denir?' }
                        ]
                    },
                    {
                        id: 'ecel',
                        name: 'Ecel',
                        color: 'bg-red-600',
                        questions: [
                            { question: 'Her canlının yaşayacağı ömrün sonuna ne denir?' },
                            { question: 'İnsanların ve diğer canlıların ölüm zamanının belirlenmiş olmasına ne denir?' }
                        ]
                    },
                    {
                        id: 'ruzgar',
                        name: 'Rızık',
                        color: 'bg-yellow-600',
                        questions: [
                            { question: 'Allah\'ın canlılara verdiği yiyecek, içecek ve diğer nimetlere ne denir?' },
                            { question: 'İnsanların yaşamlarını sürdürmeleri için gerekli olan her türlü maddi ve manevi imkana ne denir?' }
                        ]
                    },
                    {
                        id: 'irade',
                        name: 'İrade',
                        color: 'bg-indigo-600',
                        questions: [
                            { question: 'İnsanın tercih etme ve karar verme yeteneğine ne denir?' },
                            { question: 'İnsanın iyi ve kötü arasında seçim yapabilme gücünü ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'sorumluluk',
                        name: 'Sorumluluk',
                        color: 'bg-pink-600',
                        questions: [
                            { question: 'İnsanın yaptığı işlerden ve tercihlerden dolayı hesap verme yükümlülüğüne ne denir?' },
                            { question: 'İnsanın akıllı ve irade sahibi olması nedeniyle yükümlü olduğu görevlere ne denir?' }
                        ]
                    },
                    {
                        id: 'salih-amel',
                        name: 'Salih Amel',
                        color: 'bg-teal-600',
                        questions: [
                            { question: 'Allah rızası için yapılan her türlü güzel iş ve davranışa ne denir?' },
                            { question: 'İyilik, doğruluk, adalet gibi değerlere uygun olarak yapılan işlere ne denir?' }
                        ]
                    },
                    {
                        id: 'tevekkul',
                        name: 'Tevekkül',
                        color: 'bg-orange-600',
                        questions: [
                            { question: 'Bir işi yaparken tüm gayreti gösterdikten sonra sonucunu Allah\'a bırakmaya ne denir?' },
                            { question: 'Çalışıp çabaladıktan sonra Allah\'a güvenip dayanmayı ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'ayetel-kursi',
                        name: 'Ayetel Kürsi',
                        color: 'bg-cyan-600',
                        questions: [
                            { question: 'Bakara Suresi\'nin 255. ayeti olup, Allah\'ın yüceliğini ve kudretini anlatan ayet nedir?' },
                            { question: 'Kur\'an-ı Kerim\'in en büyük ayeti olarak bilinen ve Allah\'ın sıfatlarını içeren ayet nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit2-7th',
                name: 'Ünite 2: Hac ve Kurban',
                concepts: [
                    {
                        id: 'hac',
                        name: 'Hac',
                        color: 'bg-blue-500',
                        questions: [
                            { question: 'İslam\'ın beş şartından biri olan, imkanı olan Müslümanların Kâbe\'yi ve diğer kutsal yerleri ziyaret etmesi ibadetine ne denir?' },
                            { question: 'Belirli bir zamanda ve belirli kurallara göre yapılan kutsal yolculuk nedir?' }
                        ]
                    },
                    {
                        id: 'ihram',
                        name: 'İhram',
                        color: 'bg-green-500',
                        questions: [
                            { question: 'Hac veya umre ibadeti için giyilen özel kıyafete ve bu kıyafetle girilen manevi hale ne denir?' },
                            { question: 'Hac ibadetine başlarken giyilen dikişsiz beyaz örtüye ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'kabe',
                        name: 'Kâbe',
                        color: 'bg-red-500',
                        questions: [
                            { question: 'Mekke\'de bulunan, Müslümanların namaz kılarken yöneldikleri kutsal yapıya ne denir?' },
                            { question: 'Allah\'ın evi olarak da bilinen ve hac ibadetinin merkezi olan yapı nedir?' }
                        ]
                    },
                    {
                        id: 'tavaf',
                        name: 'Tavaf',
                        color: 'bg-yellow-500',
                        questions: [
                            { question: 'Kâbe\'nin etrafında yedi defa dönmeye ne denir?' },
                            { question: 'Hac ve umre ibadetlerinin önemli bir rüknü olan, Kâbe çevresinde yapılan dönüş eylemi nedir?' }
                        ]
                    },
                    {
                        id: 'say',
                        name: 'Sa\'y',
                        color: 'bg-purple-500',
                        questions: [
                            { question: 'Safa ve Merve tepeleri arasında yedi defa gidip gelmeye ne denir?' },
                            { question: 'Hac ve umre ibadetlerinde yapılan, Hz. Hacer\'in su arayışını temsil eden koşuşturma nedir?' }
                        ]
                    },
                    {
                        id: 'arafat',
                        name: 'Arafat',
                        color: 'bg-indigo-500',
                        questions: [
                            { question: 'Hac ibadetinin en önemli rüknü olan vakfenin yapıldığı kutsal dağ ve çevresindeki bölgeye ne denir?' },
                            { question: 'Hacıların Zilhicce ayının 9. günü toplandığı ve dua ettiği yer neresidir?' }
                        ]
                    },
                    {
                        id: 'muzdelife',
                        name: 'Müzdelife',
                        color: 'bg-teal-500',
                        questions: [
                            { question: 'Arafat\'tan sonra hacıların gecelediği ve şeytan taşlamak için taş topladığı bölgeye ne denir?' },
                            { question: 'Hac ibadetinde Arafat ile Mina arasında yer alan, vakfe yapılan ikinci yer neresidir?' }
                        ]
                    },
                    {
                        id: 'mina',
                        name: 'Mina',
                        color: 'bg-orange-500',
                        questions: [
                            { question: 'Hac ibadetinde şeytan taşlama ve kurban kesme gibi vazifelerin yapıldığı bölgeye ne denir?' },
                            { question: 'Mekke yakınlarında bulunan ve hacıların kurban kestiği, şeytan taşladığı vadiye ne denir?' }
                        ]
                    },
                    {
                        id: 'kurban',
                        name: 'Kurban',
                        color: 'bg-cyan-500',
                        questions: [
                            { question: 'Allah\'a yaklaşmak ve O\'nun rızasını kazanmak amacıyla belirli şartlara uygun hayvanı kesmeye ne denir?' },
                            { question: 'İslam dininde Kurban Bayramı\'nda kesilen ve etleri dağıtılan hayvanlara ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'tekbir',
                        name: 'Tekbir',
                        color: 'bg-lime-500',
                        questions: [
                            { question: '"Allahüekber" diyerek Allah\'ın büyüklüğünü ve yüceliğini dile getirmeye ne denir?' },
                            { question: 'Namazda, ezanda ve Kurban Bayramı\'nda sıkça söylenen ifade nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit3-7th',
                name: 'Ünite 3: Ahlaki Davranışlar',
                concepts: [
                    {
                        id: 'dogruluk',
                        name: 'Doğruluk',
                        color: 'bg-blue-700',
                        questions: [
                            { question: 'Sözde ve davranışta dürüst olmaya, gerçeği söylemeye ne denir?' },
                            { question: 'Yalan söylememek, hile yapmamak gibi erdemleri içeren ahlaki ilke nedir?' }
                        ]
                    },
                    {
                        id: 'adalet',
                        name: 'Adalet',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Her hak sahibine hakkını vermeye, eşit ve tarafsız davranmaya ne denir?' },
                            { question: 'Hukukta ve ilişkilerde dengeyi ve hakkaniyeti sağlamayı ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'ihsan',
                        name: 'İhsan',
                        color: 'bg-red-700',
                        questions: [
                            { question: 'Allah\'ı görüyormuş gibi ibadet etmeye, her işi en güzel şekilde yapmaya ne denir?' },
                            { question: 'Bir işi en iyi şekilde, eksiksiz ve kusursuz yapma çabasını ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'yardimlasma',
                        name: 'Yardımlaşma',
                        color: 'bg-yellow-700',
                        questions: [
                            { question: 'İnsanların birbirine destek olması, zor zamanlarda dayanışma göstermesine ne denir?' },
                            { question: 'Toplumda birlik ve beraberliği sağlayan, ihtiyaç sahiplerine el uzatma eylemi nedir?' }
                        ]
                    },
                    {
                        id: 'guven',
                        name: 'Güven',
                        color: 'bg-purple-700',
                        questions: [
                            { question: 'Birine veya bir şeye inanma, itimat etme duygusuna ne denir?' },
                            { question: 'Sözünde durma, emanete sahip çıkma gibi özelliklerle kazanılan değer nedir?' }
                        ]
                    },
                    {
                        id: 'saygi',
                        name: 'Saygı',
                        color: 'bg-indigo-700',
                        questions: [
                            { question: 'Başkalarının haklarına, düşüncelerine ve varlıklarına değer vermeye ne denir?' },
                            { question: 'Büyükleri, yaşlıları ve farklı görüşteki insanları hoşgörüyle karşılamayı içeren ahlaki davranış nedir?' }
                        ]
                    },
                    {
                        id: 'sevgi',
                        name: 'Sevgi',
                        color: 'bg-pink-700',
                        questions: [
                            { question: 'Birine karşı duyulan derin bağlılık ve şefkat duygusuna ne denir?' },
                            { question: 'İnsanları, hayvanları, doğayı ve tüm varlıkları kapsayan, Allah rızası için duyulan his nedir?' }
                        ]
                    },
                    {
                        id: 'hosgoru',
                        name: 'Hoşgörü',
                        color: 'bg-teal-700',
                        questions: [
                            { question: 'Farklı düşünce ve inançlara sahip insanlara anlayışla yaklaşmaya ne denir?' },
                            { question: 'Kendi görüşünden farklı olanları kabul etme ve onlara tahammül etme erdemi nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit4',
                name: 'Ünite 4: Hz. Muhammed (s.a.v.)',
                concepts: [
                    {
                        id: 'allahin-kulu-hz-muhammed',
                        name: 'Allah\'ın Kulu Hz. Muhammed',
                        color: 'bg-blue-600',
                        questions: [
                            { question: 'Zâriyat suresi 56. ayete göre Allah (c.c.) insanları hangi amaçla yaratmıştır?' },
                            { question: 'Hz. Muhammed (s.a.v.)\'in diğer insanlar gibi temel ihtiyaçlarını karşılaması ve hayatı boyunca zorluklarla karşılaşması onun hangi yönünü gösterir?' },
                            { question: 'Hz. Muhammed\'in (s.a.v.) kendi işlerini kendisi yapması, geçimini sağlamak için çalışması ve hastalandığında tedavi olması onun hangi özelliğini vurgular?' }
                        ]
                    },
                    {
                        id: 'peygamberlerin-insan-olmasi',
                        name: 'Peygamberlerin İnsan Olması',
                        color: 'bg-green-600',
                        questions: [
                            { question: 'Furkân suresi 7. ayete göre müşrikler, peygamberlerin hangi özelliğini bahane ederek iman etmemişlerdir?' },
                            { question: 'Peygamberlerin, vahyin muhatabı olan insanlara örnek olabilmesi için hangi özelliğe sahip olması gerekir?' }
                        ]
                    },
                    {
                        id: 'vahiy-almasi',
                        name: 'Vahiy Alması',
                        color: 'bg-purple-600',
                        questions: [
                            { question: 'Hz. Muhammed\'in (s.a.v.) insanlardan ayrılan en önemli özelliği nedir?' },
                            { question: 'Allah\'ın (c.c.) peygamberlerine Cebrail aracılığıyla gönderdiği ilahi bilgilere ne ad verilir?' },
                            { question: 'Peygamberlerin Allah ile iletişim kurma şekli ve ilahi mesajları alma süreci hangi kavramla ifade edilir?' }
                        ]
                    },
                    {
                        id: 'allahin-elcisi-hz-muhammed',
                        name: 'Allah\'ın Elçisi Hz. Muhammed',
                        color: 'bg-red-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.) kırk yaşına geldiğinde hangi görevle görevlendirilmiştir? Bu görevin temel amacı nedir?' },
                            { question: 'Peygamberlerin Allah\'tan (c.c.) aldıkları vahiyleri insanlara ulaştırma sorumluluğuna ne denir? Bu sorumluluk, peygamberin hangi sıfatıyla ilişkilidir?' }
                        ]
                    },
                    {
                        id: 'son-peygamber',
                        name: 'Son Peygamber',
                        color: 'bg-yellow-600',
                        questions: [
                            { question: 'Hametül Enbiya ne anlama gelmektedir?' }
                        ]
                    },
                    {
                        id: 'rahmet-peygamberi',
                        color: 'bg-indigo-600',
                        name: 'Rahmet Peygamberi',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in Taif\'te taşlanmasına rağmen onlara beddua etmek yerine hidayet dilemesi, Mekke\'nin fethinde genel af ilan etmesi gibi örnekler, onun hangi özelliğini gösterir? Bu özellik, onun peygamberlik görevini nasıl etkilemiştir ve Müslümanlar için nasıl bir örnek teşkil eder?' }
                        ]
                    },
                    {
                        id: 'kurani-aciklayici',
                        name: 'Kur\'an\'ı Açıklayıcı',
                        color: 'bg-pink-600',
                        questions: [
                            { question: 'Hz. Muhammed\'in (s.a.v.) sadece vahyi bildirmekle kalmayıp, vahiylerdeki mesajları açıklama görevi nedir?' }
                        ]
                    },
                    {
                        id: 'uyarici-ve-mujdeleyici',
                        name: 'Uyarıcı ve Müjdeleyici',
                        color: 'bg-teal-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in insanları yaptıkları hatalara karşı nazikçe uyarması ve iyi yaşam sürmeleri halinde cennete gideceklerini bildirmesi onun hangi görevlerini gösterir?' },
                            { question: 'Peygamberlerin insanlara baskı kurmadan, sadece doğru yolu göstererek ve güzel sonuçları müjdeleyerek yaptıkları görev nedir?' }
                        ]
                    },
                    {
                        id: 'guzel-ahlaki-tamamlamak',
                        name: 'Güzel Ahlakı Tamamlamak',
                        color: 'bg-orange-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in yaşamını Kur\'an\'ın ilkeleri doğrultusunda geçirmesi ve daima ahlaklı bir yaşam sürmesi hangi amacını gösterir?' },
                            { question: 'Peygamberimizin "Ben ancak güzel ahlakı tamamlamak için gönderildim" hadisi, onun hangi misyonunu özetler? Bu misyonun İslam ahlakındaki yeri ve önemi nedir?' },
                            { question: 'Hz. Peygamber\'in (s.a.v.) ahlaki değerleri yaşayarak insanlara örnek olması ve bu değerleri yayma çabası hangi kavramla ifade edilir?' }
                        ]
                    },
                    {
                        id: 'kafirun-suresi-anlami',
                        name: 'Kafirun Suresi',
                        color: 'bg-cyan-600',
                        questions: [
                            { question: 'Mekkeli müşriklerin Hz. Muhammed\'e (s.a.v.) bir sene kendi ilahlarına tapmasını, bir sene de kendilerinin İslam\'a iman etme teklifini reddetmesi üzerine indirilen sure hangisidir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit5',
                name: 'Ünite 5: İslam Düşüncesinde Yorumlar',
                concepts: [
                    {
                        id: 'din',
                        name: 'Din',
                        color: 'bg-lime-600',
                        questions: [
                            { question: 'Allah\'ın (c.c.) peygamberler aracılığıyla bildirdiği kurallar bütününe ne denir?' },
                            { question: 'Vahiy yoluyla gönderilen ve ilahi kurallardan oluşan, değişmez olan kavram nedir?' },
                            { question: 'İnsanların dünya ve ahiret mutluluğunu sağlamayı amaçlayan ilahi sistem nedir?' }
                        ]
                    },
                    {
                        id: 'din-anlayisi',
                        name: 'Din Anlayışı',
                        color: 'bg-emerald-600',
                        questions: [
                            { question: 'İnsanların Kur\'an ve sünneti anlama ve yorumlama çabalarıyla ortaya çıkan görüşlere ne denir?' },
                            { question: 'Vahyin yorumuna dayanan ve insanların bakış açısına göre zamanla değişebilen kavram nedir?' },
                            { question: 'İslam\'ın temel kaynakları olan Kur\'an ve sünneti farklı şekillerde yorumlama süreçlerinin bütününe ne denir?' }
                        ]
                    },
                    {
                        id: 'yorum-farkliliklarinin-sebepleri',
                        name: 'Yorum Farklılıklarının Sebepleri',
                        color: 'bg-rose-600',
                        questions: [
                            // { question: 'İslam düşüncesinde yorum farklılıklarının ortaya çıkış sebeplerinden üç tanesini belirtiniz.' }, // Bu soru kaldırıldı
                            { question: 'Toplumsal, kültürel, coğrafi farklılıklar, alimlerin farklı metotları ve değişen şartlar hangi duruma yol açmıştır?' },
                            { question: 'İnsan yapısı, eğitim seviyesi, örf ve âdetler, bilimsel ve teknolojik gelişmelerin din anlayışına etkisi hangi kavramla açıklanır?' }
                        ]
                    },
                    {
                        id: 'itikadi-yorumlar-genel',
                        name: 'İtikadi (İnanç) Yorumlar (Genel)',
                        color: 'bg-fuchsia-600',
                        questions: [
                            { question: 'İslam düşüncesindeki yorum biçimlerinden, temel inanç esaslarını ele alanlara ne denir?' },
                            { question: 'Allah\'ın varlığı ve birliği, melekler, kitaplar, peygamberler, ahiret ve kaza-kader gibi konuları ele alan yorumlar hangi kategoriye girer?' }
                        ]
                    },
                    {
                        id: 'fikhi-yorumlar-genel',
                        name: 'Fıkhi (İbadet) Yorumlar (Genel)',
                        color: 'bg-violet-600',
                        questions: [
                            { question: 'İslam düşüncesindeki yorum biçimlerinden, temel ibadetler ve helal-haram hükümleriyle ilgili olanlara ne denir?' },
                            { question: 'Namazın kılınışı, abdestin alınışı, oruç, zekat ve hac gibi ibadetlerin detaylarını açıklayan yorumlar hangi başlık altında toplanır?' }
                        ]
                    },
                    {
                        id: 'tasavvufi-yorumlar-genel',
                        name: 'Tasavvufi (Ahlak) Yorumlar (Genel)',
                        color: 'bg-amber-600',
                        questions: [
                            { question: 'İslam\'ın manevi yönünü ön plana çıkaran, yaratıcıya samimi duygularla bağlanmayı hedefleyen yorum biçimi nedir?' },
                            { question: 'Güzel ahlakı ve Allah\'a (c.c.) yakın olmayı arzu eden alimlerin farklı görüşler dile getirdiği ilim dalı nedir?' }
                        ]
                    },
                    {
                        id: 'mezhep',
                        name: 'Mezhep',
                        color: 'bg-sky-600',
                        questions: [
                            { question: 'Dinin inanç esaslarını veya hükümlerini yorumlamada özgün yöntemleri olan düşünce sistemine ne denir?' },
                            { question: 'Kur\'an ve sünneti anlama ve yorumlama amacını taşıyan, âlimlerin farklı metotlar geliştirdiği düşünce sistemi nedir?' }
                        ]
                    },
                    {
                        id: 'ocak',
                        name: 'Ocak',
                        color: 'bg-gray-600',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte cem erkânını yürüten ve Ehl-i beyt soyundan geldiğine inanılan dedelerin soyunu ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'cem-toreni',
                        name: 'Cem',
                        color: 'bg-blue-700',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte belirli zamanlarda yapılan dini törene, bir tür zikre ne denir?' }
                        ]
                    },
                    {
                        id: 'cemevi',
                        name: 'Cemevi',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Cem törenlerinin yapıldığı kutsal mekâna ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'musahiplik',
                        name: 'Musahiplik',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Evli iki çiftin dede huzurunda birbirlerini kollama ve destekleme sözü vermesiyle oluşan önemli kurum nedir?' }
                        ]
                    },
                    {
                        id: 'razilik-kul-hakki',
                        name: 'Razılık ve Kul Hakkı',
                        color: 'bg-red-700',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte kul hakkına riayet etmeyenlerin cemlere katılamayacağını belirten önemli ilkeler nedir?' }
                        ]
                    },
                    {
                        id: 'semah',
                        name: 'Semah',
                        color: 'bg-purple-700',
                        questions: [
                            { question: 'Cemlerde müzik eşliğinde yapılan coşkulu dönme haline, ibadet olarak kabul edilen eyleme ne denir?' }
                        ]
                    },
                    {
                        id: 'gulbank',
                        name: 'Gülbank',
                        color: 'bg-yellow-700',
                        questions: [
                            { question: 'Alevilikteki duaya ne denir, genellikle dede tarafından okunur ve "Allah Allah" ifadeleriyle başlar ve sonlanır?' }
                        ]
                    },
                    {
                        id: 'hizir-orucu',
                        name: 'Hızır Orucu',
                        color: 'bg-indigo-700',
                        questions: [
                            { question: 'Genellikle üç gün tutulan ve Hızır (a.s.) anısına yapılan oruç nedir?' }
                        ]
                    },
                    {
                        id: 'muharrem-orucu',
                        name: 'Muharrem Orucu',
                        color: 'bg-pink-700',
                        questions: [
                            { question: 'Muharrem ayının ilk on iki gününde tutulan matem orucuna ne denir, Hz. Hüseyin ve Kerbela şehitleri anısına tutulur?' },
                            { question: 'Muharrem ayının onuncu günü ne olarak bilinir?' }
                        ]
                    },
                    // Mezhep Soruları - Sadece Türü ve Kurucusu
                    {
                        id: 'hanefilik-mezhep',
                        name: 'Hanefilik',
                        color: 'bg-teal-700',
                        questions: [
                            { question: 'Kurucusu İmam-ı Azam Ebu Hanife olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'malikilik-mezhep',
                        name: 'Malikilik',
                        color: 'bg-orange-700',
                        questions: [
                            { question: 'Kurucusu İmam Malik olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'safiilik-mezhep',
                        name: 'Şafiilik',
                        color: 'bg-cyan-700',
                        questions: [
                            { question: 'Kurucusu İmam Şafii olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'hanbelilik-mezhep',
                        name: 'Hanbelilik',
                        color: 'bg-lime-700',
                        questions: [
                            { question: 'Kurucusu Ahmed b. Hanbel olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'caferilik-mezhep',
                        name: 'Caferilik',
                        color: 'bg-emerald-700',
                        questions: [
                            { question: 'Kurucusu Cafer-i Sadık olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'esarilik-mezhep',
                        name: 'Eşarilik',
                        color: 'bg-rose-700',
                        questions: [
                            { question: 'Kurucusu Ebu\'l-Hasan el-Eş\'ari olan itikadi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'maturidilik-mezhep',
                        name: 'Maturidilik',
                        color: 'bg-fuchsia-700',
                        questions: [
                            { question: 'Kurucusu İmam Maturidi olan itikadi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'yesevilik-ekol',
                        name: 'Yesevilik',
                        color: 'bg-violet-700',
                        questions: [
                            { question: 'Kurucusu Hoca Ahmed Yesevi olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'kadirilik-ekol',
                        name: 'Kadirilik',
                        color: 'bg-amber-700',
                        questions: [
                            { question: 'Kurucusu Abdülkadir Geylani olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'mevlevilik-ekol',
                        name: 'Mevlevilik',
                        color: 'bg-sky-700',
                        questions: [
                            { question: 'Kurucusu Mevlana Celaleddin Rumi olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'nakşibendilik-ekol',
                        name: 'Nakşibendilik',
                        color: 'bg-gray-700',
                        questions: [
                            { question: 'Kurucusu Bahauddin Nakşibend olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'alevilik-bektasilik-ekol',
                        name: 'Alevilik-Bektaşilik',
                        color: 'bg-blue-800',
                        questions: [
                            { question: 'Hacı Bektaş Veli\'nin öğretileri etrafında şekillenen tasavvufi ekol hangisidir?' }
                        ]
                    }
                ]
            }
        ];

        // Diğer DOM elemanları
        const mainMenuScreen = document.getElementById('mainMenuScreen');
        const unitCardsContainer = document.getElementById('unitCardsContainer');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const mainQuizContent = document.getElementById('mainQuizContent');
        const quizArea = document.getElementById('quizArea');
        const questionText = document.getElementById('questionText');
        const conceptBoxesContainer = document.getElementById('conceptBoxes');
        const feedbackDiv = document.getElementById('feedback');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const resetQuizBtn = document.getElementById('resetQuizBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const returnToMainMenuFromQuizBtn = document.getElementById('returnToMainMenuFromQuizBtn');

        // Modal elemanları
        const customModalOverlay = document.getElementById('customModalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalInput1 = document.getElementById('modalInput1');
        const modalInput2 = document.getElementById('modalInput2');
        const modalTextarea = document.getElementById('modalTextarea');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');


        let allQuestions = [];
        let currentQuestionIndex = 0;
        let answeredConceptIds = new Set(); // Keep track of answered concept IDs
        let timer;
        let timeLeft;
        const INITIAL_TIME = 50; // Initial time for each question

        let selectedUnitId = null; // To store the currently selected unit ID

        // Function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Prepare questions based on selected unit
        function prepareQuestions() {
            let conceptsToUse = [];
            if (selectedUnitId === 'all-units') {
                // If "Tüm Üniteler" is selected, combine all concepts from all units
                conceptsToUse = units.flatMap(unit => unit.concepts);
            } else {
                // Otherwise, find the selected unit and use its concepts
                const selectedUnit = units.find(unit => unit.id === selectedUnitId);
                if (selectedUnit) {
                    conceptsToUse = selectedUnit.concepts;
                }
            }

            allQuestions = [];
            conceptsToUse.forEach(concept => {
                concept.questions.forEach(q => {
                    allQuestions.push({
                        question: q.question,
                        correctConcept: concept.name,
                        correctConceptId: concept.id
                    });
                });
            });
            allQuestions = shuffleArray(allQuestions);
            currentQuestionIndex = 0;
            answeredConceptIds.clear(); // Clear answered concepts for a new quiz
        }

        // Update available questions by removing answered ones
        function updateAvailableQuestions() {
            allQuestions = allQuestions.filter(q => !answeredConceptIds.has(q.correctConceptId));
            allQuestions = shuffleArray(allQuestions); // Reshuffle remaining questions
            currentQuestionIndex = 0; // Reset index for the new filtered list
        }


        // Display the current question
        function displayQuestion() {
            // Reset state
            feedbackDiv.style.display = 'none';
            feedbackDiv.className = 'message-box mt-4';
            nextQuestionBtn.style.display = 'block';
            disableConceptBoxes(false); // Enable concept boxes for new question
            clearTimeout(timer); // Clear any existing timer
            timerDisplay.classList.remove('warning'); // Remove warning class

            if (allQuestions.length === 0) {
                questionText.textContent = 'Tebrikler! Tüm soruları tamamladınız.';
                nextQuestionBtn.style.display = 'none';
                disableConceptBoxes(true);
                timerDisplay.style.display = 'none'; // Hide timer when quiz is over
                return;
            }

            const currentQuestion = allQuestions[currentQuestionIndex];
            // Sadece soruyu göster, kavramı gösterme
            questionText.innerHTML = `<strong>Tanım:</strong> ${currentQuestion.question}`;

            // Start timer
            timeLeft = INITIAL_TIME;
            timerDisplay.textContent = timeLeft;
            timerDisplay.style.display = 'block'; // Ensure timer is visible
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 10) {
                    timerDisplay.classList.add('warning'); // Add warning for last 10 seconds
                }
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    feedbackDiv.textContent = 'Süre doldu! Doğru cevap: ' + currentQuestion.correctConcept;
                    feedbackDiv.className = 'message-box mt-4 error';
                    feedbackDiv.style.display = 'block';
                    disableConceptBoxes(true); // Disable input after time runs out
                }
            }, 1000);
        }

        // Render concept boxes
        function renderConcepts() {
            conceptBoxesContainer.innerHTML = ''; // Clear previous concepts

            let conceptsToRender = [];
            if (selectedUnitId === 'all-units') {
                conceptsToRender = units.flatMap(unit => unit.concepts);
            } else {
                const selectedUnit = units.find(unit => unit.id === selectedUnitId);
                if (selectedUnit) {
                    conceptsToRender = selectedUnit.concepts;
                }
            }

            // Filter out concepts that have been answered
            let remainingConcepts = conceptsToRender.filter(concept => !answeredConceptIds.has(concept.id));

            // Get the current correct concept
            const currentQuestion = allQuestions[currentQuestionIndex];
            const correctConcept = remainingConcepts.find(c => c.id === currentQuestion.correctConceptId);

            let conceptsForDisplay = [];

            if (correctConcept) {
                conceptsForDisplay.push(correctConcept); // Add the correct concept first
                // Filter out the correct concept from remaining to pick others
                remainingConcepts = remainingConcepts.filter(c => c.id !== correctConcept.id);
            }

            // Add up to 7 other random concepts from the remaining ones
            shuffleArray(remainingConcepts);
            for (let i = 0; i < Math.min(7, remainingConcepts.length); i++) {
                conceptsForDisplay.push(remainingConcepts[i]);
            }

            // Shuffle the concepts for display to randomize their positions
            shuffleArray(conceptsForDisplay);

            // Render concept boxes
            conceptsForDisplay.forEach(concept => {
                const conceptBox = document.createElement('div');
                conceptBox.className = `concept-box ${concept.color} flex items-center justify-center p-4 rounded-full shadow-lg cursor-pointer transform transition-all duration-200 ease-in-out`;
                conceptBox.setAttribute('data-concept-id', concept.id);

                // Apply random animation delays and translations for bubble effect
                conceptBox.style.setProperty('--animation-duration', `${Math.random() * 3 + 4}s`);
                conceptBox.style.setProperty('--animation-delay', `${Math.random() * 2}s`);
                conceptBox.style.setProperty('--translate-x', `${(Math.random() - 0.5) * 20}px`);
                conceptBox.style.setProperty('--translate-y', `${(Math.random() - 0.5) * 20}px`);

                const span = document.createElement('span');
                span.textContent = concept.name;
                conceptBox.appendChild(span);

                const checkmarkIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                checkmarkIcon.setAttribute("class", "checkmark");
                checkmarkIcon.setAttribute("fill", "none");
                checkmarkIcon.setAttribute("viewBox", "0 0 24 24");
                checkmarkIcon.setAttribute("stroke", "currentColor");
                checkmarkIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
                conceptBox.appendChild(checkmarkIcon);

                conceptBox.addEventListener('click', () => checkAnswer(conceptBox, concept.id));
                conceptBoxesContainer.appendChild(conceptBox);
            });
        }

        // Check the selected answer
        function checkAnswer(selectedBox, selectedConceptId) {
            clearInterval(timer); // Stop the timer
            disableConceptBoxes(true); // Disable further clicks

            const currentQuestion = allQuestions[currentQuestionIndex];
            const correctConceptId = currentQuestion.correctConceptId;

            const allConceptBoxes = document.querySelectorAll('.concept-box');
            allConceptBoxes.forEach(box => {
                if (box.getAttribute('data-concept-id') === String(correctConceptId)) {
                    box.classList.add('correct');
                }
            });

            if (String(selectedConceptId) === String(correctConceptId)) {
                feedbackDiv.textContent = 'Doğru cevap! Harikasın!';
                feedbackDiv.className = 'message-box mt-4 success';
                answeredConceptIds.add(correctConceptId); // Add to answered concepts
            } else {
                selectedBox.classList.add('incorrect');
                feedbackDiv.textContent = 'Yanlış cevap. Doğru cevap: ' + currentQuestion.correctConcept;
                feedbackDiv.className = 'message-box mt-4 error';
            }
            feedbackDiv.style.display = 'block';
        }

        // Disable/enable concept boxes
        function disableConceptBoxes(disable) {
            const conceptBoxes = document.querySelectorAll('.concept-box');
            conceptBoxes.forEach(box => {
                box.style.pointerEvents = disable ? 'none' : 'auto';
                if (!disable) {
                    box.classList.remove('correct', 'incorrect');
                }
            });
        }

        // Render unit cards for main menu
        function renderUnitCards() {
            unitCardsContainer.innerHTML = ''; // Clear previous unit cards
            // Add "Tüm Üniteler" card if it doesn't exist already
            if (!units.some(unit => unit.id === 'all-units')) {
                const allConceptsCombined = units.flatMap(unit => unit.concepts);
                units.push({
                    id: 'all-units',
                    name: 'Tüm Üniteler',
                    concepts: allConceptsCombined
                });
            }

            units.forEach(unit => {
                const unitCard = document.createElement('div');
                unitCard.className = `unit-card bg-gradient-to-br from-blue-200 to-blue-400 text-blue-800 ${unit.id === selectedUnitId ? 'selected' : ''}`;
                unitCard.textContent = unit.name;
                unitCard.setAttribute('data-unit-id', unit.id);
                unitCard.addEventListener('click', () => selectUnit(unit.id));
                unitCardsContainer.appendChild(unitCard);
            });

            // Show start quiz button only if a unit is selected
            startQuizBtn.style.display = selectedUnitId ? 'block' : 'none';
        }

        // Select a unit
        function selectUnit(unitId) {
            selectedUnitId = unitId;
            renderUnitCards(); // Re-render to show selection
        }

        // Event Listeners
        startQuizBtn.addEventListener('click', () => {
            if (selectedUnitId) {
                prepareQuestions();
                renderConcepts();
                displayQuestion();
                mainMenuScreen.style.display = 'none';
                mainQuizContent.style.display = 'flex';
            }
        });

        // Move to the next question
        nextQuestionBtn.addEventListener('click', () => {
            updateAvailableQuestions(); // Re-filter and shuffle available questions
            renderConcepts(); // Re-render concepts to remove the answered one and reflow the grid
            displayQuestion(); // Display the next question
        });

        // Restart the quiz
        resetQuizBtn.addEventListener('click', () => {
            answeredConceptIds.clear(); // Clear the set of answered concepts
            prepareQuestions(); // Re-prepare and shuffle all questions
            renderConcepts(); // Re-render all concept boxes (new shuffled order)
            displayQuestion(); // Display the first question
            nextQuestionBtn.style.display = 'block'; // Ensure next button is visible on reset
        });

        // Return to Main Menu from Quiz Screen
        returnToMainMenuFromQuizBtn.addEventListener('click', () => {
            mainQuizContent.style.display = 'none';
            mainMenuScreen.style.display = 'flex';
            clearInterval(timer); // Stop timer when returning to main menu
            selectedUnitId = null; // Clear selected unit for a fresh start
            answeredConceptIds.clear(); // Clear answered concepts for a fresh start
            renderUnitCards(); // Render unit cards to show selection status correctly
        });

        // On application load
        document.addEventListener('DOMContentLoaded', () => {
            // "Tüm Üniteler" seçeneğinin zaten eklenip eklenmediğini kontrol et
            const allUnitsExist = units.some(unit => unit.id === 'all-units');

            // "Ek Kavramlar" ünitesini units dizisinden kaldır (eğer varsa)
            units = units.filter(unit => unit.id !== 'additional-concepts-unit');

            if (!allUnitsExist) {
                // units dizisindeki tüm ünitelerin kavramlarını birleştir
                const allConceptsCombined = units.flatMap(unit => unit.concepts);

                // `units` dizisine yeni "Tüm Üniteler" birimini ekle
                units.push({
                    id: 'all-units',
                    name: 'Tüm Üniteler',
                    concepts: allConceptsCombined
                });
            }

            // Başlangıçta hiçbir ünite seçili olmasın, kullanıcının seçmesini bekleyelim
            selectedUnitId = null;

            renderUnitCards(); // Ana menüyü ilk göstermek için ünite kartlarını render et
            mainQuizContent.style.display = 'none'; // Yarışma içeriğinin başlangıçta gizli olduğundan emin ol
            mainMenuScreen.style.display = 'flex'; // Ana menünün başlangıçta görünür olduğundan emin ol
        });
    </script>
</body>
</html>
