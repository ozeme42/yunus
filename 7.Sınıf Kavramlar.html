<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kavram Bilgi Yarışması</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Temel stil tanımlamaları */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0f2f7; /* Açık mavi arka plan */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ekran yüksekliğinin tamamını kapla */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow-x: hidden; /* Yatay kaydırmayı engelle, mobil uyumluluk için kritik */
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .container {
            background-color: #ffffff;
            border-radius: 0;
            box-shadow: none;
            max-width: 100%; /* Her zaman ekran genişliğine uyum sağlar */
            width: 100%;
            height: 100vh; /* Mobil cihazlarda dikey alanı kaplar */
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem; /* Esnek boşluklar */
            padding: 2.5rem 1rem; /* Mobil cihazlar için uygun padding */
            box-sizing: border-box;
            overflow-y: auto; /* İçerik taştığında dikey kaydırmaya izin verir */
            padding-top: 2rem;
        }
        .concept-box {
            min-width: 120px;
            max-width: 200px;
            min-height: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #000000;
            font-size: 1.05rem; /* Esnek font boyutu */
            font-weight: bold;
            border-radius: 9999px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, border-color 0.2s ease-in-out, background-color 0.2s ease-in-out, opacity 0.5s ease-in-out; /* Opaklık geçişi eklendi */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            cursor: pointer;
            position: relative;
            animation: bubbleFloat var(--animation-duration) ease-in-out var(--animation-delay) infinite alternate;
        }
        .concept-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
            z-index: 1;
        }
        .concept-box span {
            position: relative;
            z-index: 2;
            padding: 0.75rem 1rem;
            text-align: center;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.2;
            display: block;
        }

        .concept-box:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        /* Görsel Geri Bildirim Stilleri */
        .concept-box.correct {
            background-color: #d4edda; /* Açık yeşil */
            border-color: #28a745; /* Koyu yeşil */
            animation: fadeAndScaleIn .3s ease-out;
        }

        .concept-box.incorrect {
            background-color: #f8d7da; /* Açık kırmızı */
            border-color: #dc3545; /* Koyu kırmızı */
            animation: shake .3s ease-out;
        }

        /* Animasyonlar */
        @keyframes fadeAndScaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .quiz-area {
            width: 100%;
            max-width: none; /* Sabit genişlik yerine esnek genişlik */
            text-align: left;
            background: linear-gradient(to right, #A8D8FF, #4D94FF);
            border: 3px dashed #67a9cf;
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .question-line {
            display: flex;
            flex-direction: column;
            align-items: center; /* Soru metnini yatayda ortala */
            margin-bottom: 1.5rem;
            width: 100%;
            text-align: center; /* Metni kendi içinde ortala */
        }
        .question-line h2 {
            margin-right: 0.5rem;
            margin-bottom: 0;
            flex-shrink: 0;
            font-size: 2.25rem;
            display: none; /* "Tanım:" etiketini gizle */
        }
        .question-line p {
            flex-grow: 1;
            margin-bottom: 0;
            font-size: 1.5rem; /* Esnek font boyutu */
            text-align: center; /* Paragraf metnini ortala */
        }

        .message-box {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-weight: 600;
            text-align: center;
            width: 100%;
        }
        .message-box.success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .message-box.error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .action-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem; /* Dokunmatik hedefler için uygun boyut */
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            width: 100%; /* Mobil cihazlarda tam genişlik */
        }
        .action-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .action-button:active {
            transform: translateY(0);
        }
        .button-group {
            display: flex;
            flex-direction: column; /* Mobil cihazlarda butonları alt alta sırala */
            gap: 1rem; /* Esnek boşluklar */
            width: 100%;
            max-width: none;
            margin-top: 2rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        @media (min-width: 640px) { /* Geniş ekranlarda butonları yan yana sırala */
            .button-group {
                flex-direction: row;
            }
        }
        .button-group .action-button {
            flex: 1;
        }
        .reset-button {
            background-color: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem; /* Dokunmatik hedefler için uygun boyut */
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            width: 100%; /* Mobil cihazlarda tam genişlik */
            max-width: none;
        }
        .reset-button:hover {
            background-color: #4b5563;
        }

        /* Kavram kutuları için duyarlı ızgara */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* Varsayılan olarak 5 sütun (10 eleman için 2 sıra) */
            justify-content: center;
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Zamanlayıcı stili */
        #timerDisplay {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            text-align: center;
            padding: 0.5rem 1rem;
            background-color: transparent;
            border-radius: 0.5rem;
            box-shadow: none;
            z-index: 10;
        }
        #timerDisplay.warning {
            color: #EF4444;
        }

        /* Onay işareti stili (şu an kullanılmıyor ama gelecekteki geliştirmeler için bırakıldı) */
        .concept-box .checkmark {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .concept-box.correct .checkmark {
            opacity: 1;
        }

        /* Duyarlı sütun ayarlamaları (mobil öncelikli) */
        @media (max-width: 1200px) {
            .concept-grid {
                grid-template-columns: repeat(4, 1fr); /* 1200px altı için 4 sütun */
            }
        }
        @media (max-width: 992px) {
            .concept-grid {
                grid-template-columns: repeat(3, 1fr); /* 992px altı için 3 sütun */
            }
        }
        @media (max-width: 768px) {
            .concept-grid {
                grid-template-columns: repeat(2, 1fr); /* 768px altı için 2 sütun */
            }
            /* Mobil cihazlar için kavram kutusu boyutlarını küçült */
            .concept-box {
                min-width: 90px; /* Daha küçük minimum genişlik */
                max-width: 150px; /* Daha küçük maksimum genişlik */
                min-height: 80px; /* Daha küçük minimum yükseklik */
                font-size: 0.9rem; /* Daha küçük font boyutu */
                padding: 0.5rem 0.75rem; /* Daha küçük padding */
            }
            .concept-box span {
                padding: 0.5rem 0.75rem; /* İç metin padding'i */
            }
        }
        @media (max-width: 480px) {
            .concept-grid {
                grid-template-columns: repeat(1, 1fr); /* 480px altı (mobil) için tek sütun */
            }
            /* Çok küçük mobil ekranlar için kavram kutusu boyutlarını daha da küçült */
            .concept-box {
                min-width: 80px;
                max-width: 120px;
                min-height: 70px;
                font-size: 0.8rem;
                padding: 0.4rem 0.6rem;
            }
            .concept-box span {
                padding: 0.4rem 0.6rem;
            }
        }


        /* Baloncuk animasyonu tanımı */
        @keyframes bubbleFloat {
            0% { transform: translate(0px, 0px) scale(1); opacity: 0.9; }
            50% { transform: translate(var(--translate-x), var(--translate-y)) scale(1.02); opacity: 0.95; }
            100% { transform: translate(0px, 0px) scale(1); opacity: 0.9; }
        }

        /* Ünite seçim ekranı stilleri */
        #mainMenuScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            padding: 2rem;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        /* Ünite ızgarası için duyarlı stil */
        .unit-grid {
            display: grid;
            /* Ekran genişliğine göre otomatik sütun sayısı, her sütun minimum 180px */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            width: 90%; /* Yüzde tabanlı genişlik */
            max-width: 1400px; /* Daha geniş ekranlar için maksimum genişliği artır */
            justify-items: center;
            margin: 0 auto;
            flex-grow: 1;
            align-items: center;
        }
        .unit-card {
            padding: 1.5rem;
            border-radius: 1rem;
            width: 100%;
            aspect-ratio: 4/3; /* En boy oranını koru */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            font-size: 1.25rem; /* Varsayılan font boyutu */
            font-weight: 600;
            color: #333;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0,0,0,0.1);
            overflow-wrap: break-word; /* Uzun başlıkların kelime bazında satır atlamasını sağlar */
        }
        /* Mobil cihazlar için ünite kartı font boyutu ayarlaması */
        @media (max-width: 480px) {
            .unit-card {
                font-size: 0.95rem; /* Daha küçük ekranlarda font boyutunu küçült */
                padding: 1rem; /* Daha küçük padding */
            }
        }
        .unit-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .unit-card.selected {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 0 3px #3b82f6;
            border-color: #3b82f6;
        }
        .main-quiz-content {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        /* Özel Modal Stilleri */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%; /* Mobil uyumluluk için yüzde tabanlı genişlik */
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .modal-content h4 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }
        .modal-content input[type="text"],
        .modal-content textarea {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #ccc;
            font-size: 1rem;
            width: 100%;
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .modal-save-btn {
            background-color: #3b82f6;
            color: white;
        }
        .modal-save-btn:hover {
            background-color: #2563eb;
        }
        .modal-cancel-btn {
            background-color: #6b7280;
            color: white;
        }
        .modal-cancel-btn:hover {
            background-color: #4b5563;
        }
        .modal-confirm-btn {
            background-color: #f44336;
            color: white;
        }
        .modal-confirm-btn:hover {
            background-color: #da190b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mainTitle" class="text-4xl font-bold text-gray-800 mb-6">Kavram Bilgi Yarışması</h1>

        <div id="mainMenuScreen">
            <div id="unitCardsContainer" class="unit-grid">
                </div>
            <button id="startQuizBtn" class="action-button px-8 py-3 text-xl" style="display: none;">Yarışmayı Başlat</button>
            <button id="returnToHomePageBtn" class="action-button bg-purple-600 hover:bg-purple-700 mt-4 px-8 py-3 text-xl">Ana Sayfaya Dön</button>
            </div>

        <div id="mainQuizContent" class="main-quiz-content">
            <div id="quizArea" class="quiz-area">
                <div class="question-line">
                    <p id="questionText" class="text-xl text-gray-800"></p>
                </div>
                <div id="timerDisplay">30</div> <div id="feedback" class="message-box mt-4" style="display: none;"></div>
            </div>

            <div id="conceptBoxes" class="concept-grid w-full justify-items-center">
            </div>

            <div class="button-group">
                <button id="nextQuestionBtn" class="action-button">Sonraki Soru</button>
                <button id="showAnswerBtn" class="action-button bg-orange-500 hover:bg-orange-600">Cevabı Göster</button>
            </div>

            <button id="resetQuizBtn" class="reset-button">Yarışmayı Yeniden Başlat</button>
            <button id="returnToMainMenuFromQuizBtn" class="action-button bg-gray-500 hover:bg-gray-700 mt-4">Ana Menüye Dön</button>
        </div>

        <div id="editorScreen" style="display: none;"></div>
    </div>

    <div id="customModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h4 id="modalTitle"></h4>
            <p id="modalMessage" class="text-gray-700"></p>
            <input type="text" id="modalInput1" style="display: none;">
            <input type="text" id="modalInput2" style="display: none;">
            <textarea id="modalTextarea" style="display: none;"></textarea>
            <div class="modal-buttons">
                <button id="modalConfirmBtn" class="modal-confirm-btn" style="display: none;">Evet</button>
                <button id="modalSaveBtn" class="modal-save-btn" style="display: none;">Kaydet</button>
                <button id="modalCancelBtn" class="modal-cancel-btn">İptal</button>
            </div>
        </div>
    </div>

    <script>
        // Unit and concept data (updated for 7th grade Religious Culture and Moral Knowledge curriculum)
        let units = [
            {
                id: 'unit1-7th',
                name: 'Ünite 1: Melek ve Ahiret İnancı',
                bgColor: 'bg-blue-100', /* Renk eklendi */
                concepts: [
                    {
                        id: 'melek',
                        name: 'Melek',
                        color: 'bg-blue-600',
                        questions: [
                            { question: 'Allah\'ın nurdan yarattığı, gözle görülmeyen, daima Allah\'a ibadet eden varlıklara ne denir?' },
                            { question: 'Vahiy getiren, rızıkları dağıtan, ruhları alan gibi çeşitli görevleri olan varlıklar kimlerdir?' }
                        ]
                    },
                    {
                        id: 'ahiret',
                        name: 'Ahiret',
                        color: 'bg-green-600',
                        questions: [
                            { question: 'Dünya hayatından sonra başlayacak olan sonsuz hayata ne denir?' },
                            { question: 'İnsanların dünyada yaptıkları iyilik ve kötülüklerin karşılığını göreceği yer neresidir?' }
                        ]
                    },
                    {
                        id: 'kaza-kader',
                        name: 'Kaza ve Kader',
                        color: 'bg-purple-600',
                        questions: [
                            { question: 'Allah\'ın her şeyi önceden bilip takdir etmesine ne denir?' },
                            { question: 'Allah\'ın takdir ettiği şeylerin zamanı gelince gerçekleşmesine ne denir?' }
                        ]
                    },
                    {
                        id: 'ecel',
                        name: 'Ecel',
                        color: 'bg-red-600',
                        questions: [
                            { question: 'Her canlının yaşayacağı ömrün sonuna ne denir?' },
                            { question: 'İnsanların ve diğer canlıların ölüm zamanının belirlenmiş olmasına ne denir?' }
                        ]
                    },
                    {
                        id: 'ruzgar',
                        name: 'Rızık',
                        color: 'bg-yellow-600',
                        questions: [
                            { question: 'Allah\'ın canlılara verdiği yiyecek, içecek ve diğer nimetlere ne denir?' },
                            { question: 'İnsanların yaşamlarını sürdürmeleri için gerekli olan her türlü maddi ve manevi imkana ne denir?' }
                        ]
                    },
                    {
                        id: 'irade',
                        name: 'İrade',
                        color: 'bg-indigo-600',
                        questions: [
                            { question: 'İnsanın tercih etme ve karar verme yeteneğine ne denir?' },
                            { question: 'İnsanın iyi ve kötü arasında seçim yapabilme gücünü ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'sorumluluk',
                        name: 'Sorumluluk',
                        color: 'bg-pink-600',
                        questions: [
                            { question: 'İnsanın yaptığı işlerden ve tercihlerden dolayı hesap verme yükümlülüğüne ne denir?' },
                            { question: 'İnsanın akıllı ve irade sahibi olması nedeniyle yükümlü olduğu görevlere ne denir?' }
                        ]
                    },
                    {
                        id: 'salih-amel',
                        name: 'Salih Amel',
                        color: 'bg-teal-600',
                        questions: [
                            { question: 'Allah rızası için yapılan her türlü güzel iş ve davranışa ne denir?' },
                            { question: 'İyilik, doğruluk, adalet gibi değerlere uygun olarak yapılan işlere ne denir?' }
                        ]
                    },
                    {
                        id: 'tevekkul',
                        name: 'Tevekkül',
                        color: 'bg-orange-600',
                        questions: [
                            { question: 'Bir işi yaparken tüm gayreti gösterdikten sonra sonucunu Allah\'a bırakmaya ne denir?' },
                            { question: 'Çalışıp çabaladıktan sonra Allah\'a güvenip dayanmayı ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'ayetel-kursi',
                        name: 'Ayetel Kürsi',
                        color: 'bg-cyan-600',
                        questions: [
                            { question: 'Bakara Suresi\'nin 255. ayeti olup, Allah\'ın yüceliğini ve kudretini anlatan ayet nedir?' },
                            { question: 'Kur\'an-ı Kerim\'in en büyük ayeti olarak bilinen ve Allah\'ın sıfatlarını içeren ayet nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit2-7th',
                name: 'Ünite 2: Hac ve Kurban',
                bgColor: 'bg-green-100', /* Renk eklendi */
                concepts: [
                    {
                        id: 'hac',
                        name: 'Hac',
                        color: 'bg-blue-500',
                        questions: [
                            { question: 'İslam\'ın beş şartından biri olan, imkanı olan Müslümanların Kâbe\'yi ve diğer kutsal yerleri ziyaret etmesi ibadetine ne denir?' },
                            { question: 'Belirli bir zamanda ve belirli kurallara göre yapılan kutsal yolculuk nedir?' }
                        ]
                    },
                    {
                        id: 'ihram',
                        name: 'İhram',
                        color: 'bg-green-500',
                        questions: [
                            { question: 'Hac veya umre ibadeti için giyilen özel kıyafete ve bu kıyafetle girilen manevi hale ne denir?' },
                            { question: 'Hac ibadetine başlarken giyilen dikişsiz beyaz örtüye ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'kabe',
                        name: 'Kâbe',
                        color: 'bg-red-500',
                        questions: [
                            { question: 'Mekke\'de bulunan, Müslümanların namaz kılarken yöneldikleri kutsal yapıya ne denir?' },
                            { question: 'Allah\'ın evi olarak da bilinen ve hac ibadetinin merkezi olan yapı nedir?' }
                        ]
                    },
                    {
                        id: 'tavaf',
                        name: 'Tavaf',
                        color: 'bg-yellow-500',
                        questions: [
                            { question: 'Kâbe\'nin etrafında yedi defa dönmeye ne denir?' },
                            { question: 'Hac ve umre ibadetlerinin önemli bir rüknü olan, Kâbe çevresinde yapılan dönüş eylemi nedir?' }
                        ]
                    },
                    {
                        id: 'say',
                        name: 'Sa\'y',
                        color: 'bg-purple-500',
                        questions: [
                            { question: 'Safa ve Merve tepeleri arasında yedi defa gidip gelmeye ne denir?' },
                            { question: 'Hac ve umre ibadetlerinde yapılan, Hz. Hacer\'in su arayışını temsil eden koşuşturma nedir?' }
                        ]
                    },
                    {
                        id: 'arafat',
                        name: 'Arafat',
                        color: 'bg-indigo-500',
                        questions: [
                            { question: 'Hac ibadetinin en önemli rüknü olan vakfenin yapıldığı kutsal dağ ve çevresindeki bölgeye ne denir?' },
                            { question: 'Hacıların Zilhicce ayının 9. günü toplandığı ve dua ettiği yer neresidir?' }
                        ]
                    },
                    {
                        id: 'muzdelife',
                        name: 'Müzdelife',
                        color: 'bg-teal-500',
                        questions: [
                            { question: 'Arafat\'tan sonra hacıların gecelediği ve şeytan taşlamak için taş topladığı bölgeye ne denir?' },
                            { question: 'Hac ibadetinde Arafat ile Mina arasında yer alan, vakfe yapılan ikinci yer neresidir?' }
                        ]
                    },
                    {
                        id: 'mina',
                        name: 'Mina',
                        color: 'bg-orange-500',
                        questions: [
                            { question: 'Hac ibadetinde şeytan taşlama ve kurban kesme gibi vazifelerin yapıldığı bölgeye ne denir?' },
                            { question: 'Mekke yakınlarında bulunan ve hacıların kurban kestiği, şeytan taşladığı vadiye ne denir?' }
                        ]
                    },
                    {
                        id: 'kurban',
                        name: 'Kurban',
                        color: 'bg-cyan-500',
                        questions: [
                            { question: 'Allah\'a yaklaşmak ve O\'nun rızasını kazanmak amacıyla belirli şartlara uygun hayvanı kesmeye ne denir?' },
                            { question: 'İslam dininde Kurban Bayramı\'nda kesilen ve etleri dağıtılan hayvanlara ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'tekbir',
                        name: 'Tekbir',
                        color: 'bg-lime-500',
                        questions: [
                            { question: '"Allahüekber" diyerek Allah\'ın büyüklüğünü ve yüceliğini dile getirmeye ne denir?' },
                            { question: 'Namazda, ezanda ve Kurban Bayramı\'nda sıkça söylenen ifade nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit3-7th',
                name: 'Ünite 3: Ahlaki Davranışlar',
                bgColor: 'bg-purple-100', /* Renk eklendi */
                concepts: [
                    {
                        id: 'dogruluk',
                        name: 'Doğruluk',
                        color: 'bg-blue-700',
                        questions: [
                            { question: 'Sözde ve davranışta dürüst olmaya, gerçeği söylemeye ne denir?' },
                            { question: 'Yalan söylememek, hile yapmamak gibi erdemleri içeren ahlaki ilke nedir?' }
                        ]
                    },
                    {
                        id: 'adalet',
                        name: 'Adalet',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Her hak sahibine hakkını vermeye, eşit ve tarafsız davranmaya ne denir?' },
                            { question: 'Hukukta ve ilişkilerde dengeyi ve hakkaniyeti sağlamayı ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'ihsan',
                        name: 'İhsan',
                        color: 'bg-red-700',
                        questions: [
                            { question: 'Allah\'ı görüyormuş gibi ibadet etmeye, her işi en güzel şekilde yapmaya ne denir?' },
                            { question: 'Bir işi en iyi şekilde, eksiksiz ve kusursuz yapma çabasını ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'yardimlasma',
                        name: 'Yardımlaşma',
                        color: 'bg-yellow-700',
                        questions: [
                            { question: 'İnsanların birbirine destek olması, zor zamanlarda dayanışma göstermesine ne denir?' },
                            { question: 'Toplumda birlik ve beraberliği sağlayan, ihtiyaç sahiplerine el uzatma eylemi nedir?' }
                        ]
                    },
                    {
                        id: 'guven',
                        name: 'Güven',
                        color: 'bg-purple-700',
                        questions: [
                            { question: 'Birine veya bir şeye inanma, itimat etme duygusuna ne denir?' },
                            { question: 'Sözünde durma, emanete sahip çıkma gibi özelliklerle kazanılan değer nedir?' }
                        ]
                    },
                    {
                        id: 'saygi',
                        name: 'Saygı',
                        color: 'bg-indigo-700',
                        questions: [
                            { question: 'Başkalarının haklarına, düşüncelerine ve varlıklarına değer vermeye ne denir?' },
                            { question: 'Büyükleri, yaşlıları ve farklı görüşteki insanları hoşgörüyle karşılamayı içeren ahlaki davranış nedir?' }
                        ]
                    },
                    {
                        id: 'sevgi',
                        name: 'Sevgi',
                        color: 'bg-pink-700',
                        questions: [
                            { question: 'Birine karşı duyulan derin bağlılık ve şefkat duygusuna ne denir?' },
                            { question: 'İnsanları, hayvanları, doğayı ve tüm varlıkları kapsayan, Allah rızası için duyulan his nedir?' }
                        ]
                    },
                    {
                        id: 'hosgoru',
                        name: 'Hoşgörü',
                        color: 'bg-teal-700',
                        questions: [
                            { question: 'Farklı düşünce ve inançlara sahip insanlara anlayışla yaklaşmaya ne denir?' },
                            { question: 'Kendi görüşünden farklı olanları kabul etme ve onlara tahammül etme erdemi nedir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit4',
                name: 'Ünite 4: Hz. Muhammed (s.a.v.)',
                bgColor: 'bg-yellow-100', /* Renk eklendi */
                concepts: [
                    {
                        id: 'allahin-kulu-hz-muhammed',
                        name: 'Allah\'ın Kulu Hz. Muhammed',
                        color: 'bg-blue-600',
                        questions: [
                            { question: 'Zâriyat suresi 56. ayete göre Allah (c.c.) insanları hangi amaçla yaratmıştır?' },
                            { question: 'Hz. Muhammed (s.a.v.)\'in diğer insanlar gibi temel ihtiyaçlarını karşılaması ve hayatı boyunca zorluklarla karşılaşması onun hangi yönünü gösterir?' },
                            { question: 'Hz. Muhammed\'in (s.a.v.) kendi işlerini kendisi yapması, geçimini sağlamak için çalışması ve hastalandığında tedavi olması onun hangi özelliğini vurgular?' }
                        ]
                    },
                    {
                        id: 'peygamberlerin-insan-olmasi',
                        name: 'Peygamberlerin İnsan Olması',
                        color: 'bg-green-600',
                        questions: [
                            { question: 'Furkân suresi 7. ayete göre müşrikler, peygamberlerin hangi özelliğini bahane ederek iman etmemişlerdir?' },
                            { question: 'Peygamberlerin, vahyin muhatabı olan insanlara örnek olabilmesi için hangi özelliğe sahip olması gerekir?' }
                        ]
                    },
                    {
                        id: 'vahiy-almasi',
                        name: 'Vahiy Alması',
                        color: 'bg-purple-600',
                        questions: [
                            { question: 'Hz. Muhammed\'in (s.a.v.) insanlardan ayrılan en önemli özelliği nedir?' },
                            { question: 'Allah\'ın (c.c.) peygamberlerine Cebrail aracılığıyla gönderdiği ilahi bilgilere ne ad verilir?' },
                            { question: 'Peygamberlerin Allah ile iletişim kurma şekli ve ilahi mesajları alma süreci hangi kavramla ifade edilir?' }
                        ]
                    },
                    {
                        id: 'allahin-elcisi-hz-muhammed',
                        name: 'Allah\'ın Elçisi Hz. Muhammed',
                        color: 'bg-red-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.) kırk yaşına geldiğinde hangi görevle görevlendirilmiştir? Bu görevin temel amacı nedir?' },
                            { question: 'Peygamberlerin Allah\'tan (c.c.) aldıkları vahiyleri insanlara ulaştırma sorumluluğuna ne denir? Bu sorumluluk, peygamberin hangi sıfatıyla ilişkilidir?' }
                        ]
                    },
                    {
                        id: 'son-peygamber',
                        name: 'Son Peygamber',
                        color: 'bg-yellow-600',
                        questions: [
                            { question: 'Hametül Enbiya ne anlama gelmektedir?' }
                        ]
                    },
                    {
                        id: 'rahmet-peygamberi',
                        color: 'bg-indigo-600',
                        name: 'Rahmet Peygamberi',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in Taif\'te taşlanmasına rağmen onlara beddua etmek yerine hidayet dilemesi, Mekke\'nin fethinde genel af ilan etmesi gibi örnekler, onun hangi özelliğini gösterir? Bu özellik, onun peygamberlik görevini nasıl etkilemiştir ve Müslümanlar için nasıl bir örnek teşkil eder?' }
                        ]
                    },
                    {
                        id: 'kurani-aciklayici',
                        name: 'Kur\'an\'ı Açıklayıcı',
                        color: 'bg-pink-600',
                        questions: [
                            { question: 'Hz. Muhammed\'in (s.a.v.) sadece vahyi bildirmekle kalmayıp, vahiylerdeki mesajları açıklama görevi nedir?' }
                        ]
                    },
                    {
                        id: 'uyarici-ve-mujdeleyici',
                        name: 'Uyarıcı ve Müjdeleyici',
                        color: 'bg-teal-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in insanları yaptıkları hatalara karşı nazikçe uyarması ve iyi yaşam sürmeleri halinde cennete gideceklerini bildirmesi onun hangi görevlerini gösterir?' },
                            { question: 'Peygamberlerin insanlara baskı kurmadan, sadece doğru yolu göstererek ve güzel sonuçları müjdeleyerek yaptıkları görev nedir?' }
                        ]
                    },
                    {
                        id: 'guzel-ahlaki-tamamlamak',
                        name: 'Güzel Ahlakı Tamamlamak',
                        color: 'bg-orange-600',
                        questions: [
                            { question: 'Hz. Muhammed (s.a.v.)\'in yaşamını Kur\'an\'ın ilkeleri doğrultusunda geçirmesi ve daima ahlaklı bir yaşam sürmesi hangi amacını gösterir?' },
                            { question: 'Peygamberimizin "Ben ancak güzel ahlakı tamamlamak için gönderildim" hadisi, onun hangi misyonunu özetler? Bu misyonun İslam ahlakındaki yeri ve önemi nedir?' },
                            { question: 'Hz. Peygamber\'in (s.a.v.) ahlaki değerleri yaşayarak insanlara örnek olması ve bu değerleri yayma çabası hangi kavramla ifade edilir?' }
                        ]
                    },
                    {
                        id: 'kafirun-suresi-anlami',
                        name: 'Kafirun Suresi',
                        color: 'bg-cyan-600',
                        questions: [
                            { question: 'Mekkeli müşriklerin Hz. Muhammed\'e (s.a.v.) bir sene kendi ilahlarına tapmasını, bir sene de kendilerinin İslam\'a iman etme teklifini reddetmesi üzerine indirilen sure hangisidir?' }
                        ]
                    }
                ]
            },
            {
                id: 'unit5',
                name: 'Ünite 5: İslam Düşüncesinde Yorumlar',
                bgColor: 'bg-red-100', /* Renk eklendi */
                concepts: [
                    {
                        id: 'din',
                        name: 'Din',
                        color: 'bg-lime-600',
                        questions: [
                            { question: 'Allah\'ın (c.c.) peygamberler aracılığıyla bildirdiği kurallar bütününe ne denir?' },
                            { question: 'Vahiy yoluyla gönderilen ve ilahi kurallardan oluşan, değişmez olan kavram nedir?' },
                            { question: 'İnsanların dünya ve ahiret mutluluğunu sağlamayı amaçlayan ilahi sistem nedir?' }
                        ]
                    },
                    {
                        id: 'din-anlayisi',
                        name: 'Din Anlayışı',
                        color: 'bg-emerald-600',
                        questions: [
                            { question: 'İnsanların Kur\'an ve sünneti anlama ve yorumlama çabalarıyla ortaya çıkan görüşlere ne denir?' },
                            { question: 'Vahyin yorumuna dayanan ve insanların bakış açısına göre zamanla değişebilen kavram nedir?' },
                            { question: 'İslam\'ın temel kaynakları olan Kur\'an ve sünneti farklı şekillerde yorumlama süreçlerinin bütününe ne denir?' }
                        ]
                    },
                    {
                        id: 'yorum-farkliliklarinin-sebepleri',
                        name: 'Yorum Farklılıklarının Sebepleri',
                        color: 'bg-rose-600',
                        questions: [
                            { question: 'Toplumsal, kültürel, coğrafi farklılıklar, alimlerin farklı metotları ve değişen şartlar hangi duruma yol açmıştır?' },
                            { question: 'İnsan yapısı, eğitim seviyesi, örf ve âdetler, bilimsel ve teknolojik gelişmelerin din anlayışına etkisi hangi kavramla açıklanır?' }
                        ]
                    },
                    {
                        id: 'itikadi-yorumlar-genel',
                        name: 'İtikadi (İnanç) Yorumlar (Genel)',
                        color: 'bg-fuchsia-600',
                        questions: [
                            { question: 'İslam düşüncesindeki yorum biçimlerinden, temel inanç esaslarını ele alanlara ne denir?' },
                            { question: 'Allah\'ın varlığı ve birliği, melekler, kitaplar, peygamberler, ahiret ve kaza-kader gibi konuları ele alan yorumlar hangi kategoriye girer?' }
                        ]
                    },
                    {
                        id: 'fikhi-yorumlar-genel',
                        name: 'Fıkhi (İbadet) Yorumlar (Genel)',
                        color: 'bg-violet-600',
                        questions: [
                            { question: 'İslam düşüncesindeki yorum biçimlerinden, temel ibadetler ve helal-haram hükümleriyle ilgili olanlara ne denir?' },
                            { question: 'Namazın kılınışı, abdestin alınışı, oruç, zekat ve hac gibi ibadetlerin detaylarını açıklayan yorumlar hangi başlık altında toplanır?' }
                        ]
                    },
                    {
                        id: 'tasavvufi-yorumlar-genel',
                        name: 'Tasavvufi (Ahlak) Yorumlar (Genel)',
                        color: 'bg-amber-600',
                        questions: [
                            { question: 'İslam\'ın manevi yönünü ön plana çıkaran, yaratıcıya samimi duygularla bağlanmayı hedefleyen yorum biçimi nedir?' },
                            { question: 'Güzel ahlakı ve Allah\'a (c.c.) yakın olmayı arzu eden alimlerin farklı görüşler dile getirdiği ilim dalı nedir?' }
                        ]
                    },
                    {
                        id: 'mezhep',
                        name: 'Mezhep',
                        color: 'bg-sky-600',
                        questions: [
                            { question: 'Dinin inanç esaslarını veya hükümlerini yorumlamada özgün yöntemleri olan düşünce sistemine ne denir?' },
                            { question: 'Kur\'an ve sünneti anlama ve yorumlama amacını taşıyan, âlimlerin farklı metotlar geliştirdiği düşünce sistemi nedir?' }
                        ]
                    },
                    {
                        id: 'ocak',
                        name: 'Ocak',
                        color: 'bg-gray-600',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte cem erkânını yürüten ve Ehl-i beyt soyundan geldiğine inanılan dedelerin soyunu ifade eden kavram nedir?' }
                        ]
                    },
                    {
                        id: 'cem-toreni',
                        name: 'Cem',
                        color: 'bg-blue-700',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte belirli zamanlarda yapılan dini törene, bir tür zikre ne denir?' }
                        ]
                    },
                    {
                        id: 'cemevi',
                        name: 'Cemevi',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Cem törenlerinin yapıldığı kutsal mekâna ne ad verilir?' }
                        ]
                    },
                    {
                        id: 'musahiplik',
                        name: 'Musahiplik',
                        color: 'bg-green-700',
                        questions: [
                            { question: 'Evli iki çiftin dede huzurunda birbirlerini kollama ve destekleme sözü vermesiyle oluşan önemli kurum nedir?' }
                        ]
                    },
                    {
                        id: 'razilik-kul-hakki',
                        name: 'Razılık ve Kul Hakkı',
                        color: 'bg-red-700',
                        questions: [
                            { question: 'Alevilik-Bektaşilikte kul hakkına riayet etmeyenlerin cemlere katılamayacağını belirten önemli ilkeler nedir?' }
                        ]
                    },
                    {
                        id: 'semah',
                        name: 'Semah',
                        color: 'bg-purple-700',
                        questions: [
                            { question: 'Cemlerde müzik eşliğinde yapılan coşkulu dönme haline, ibadet olarak kabul edilen eyleme ne denir?' }
                        ]
                    },
                    {
                        id: 'gulbank',
                        name: 'Gülbank',
                        color: 'bg-yellow-700',
                        questions: [
                            { question: 'Alevilikteki duaya ne denir, genellikle dede tarafından okunur ve "Allah Allah" ifadeleriyle başlar ve sonlanır?' }
                        ]
                    },
                    {
                        id: 'hizir-orucu',
                        name: 'Hızır Orucu',
                        color: 'bg-indigo-700',
                        questions: [
                            { question: 'Genellikle üç gün tutulan ve Hızır (a.s.) anısına yapılan oruç nedir?' }
                        ]
                    },
                    {
                        id: 'muharrem-orucu',
                        name: 'Muharrem Orucu',
                        color: 'bg-pink-700',
                        questions: [
                            { question: 'Muharrem ayının ilk on iki gününde tutulan matem orucuna ne denir, Hz. Hüseyin ve Kerbela şehitleri anısına tutulur?' },
                            { question: 'Muharrem ayının onuncu günü ne olarak bilinir?' }
                        ]
                    },
                    // Mezhep Soruları - Sadece Türü ve Kurucusu
                    {
                        id: 'hanefilik-mezhep',
                        name: 'Hanefilik',
                        color: 'bg-teal-700',
                        questions: [
                            { question: 'Kurucusu İmam-ı Azam Ebu Hanife olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'malikilik-mezhep',
                        name: 'Malikilik',
                        color: 'bg-orange-700',
                        questions: [
                            { question: 'Kurucusu İmam Malik olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'safiilik-mezhep',
                        name: 'Şafiilik',
                        color: 'bg-cyan-700',
                        questions: [
                            { question: 'Kurucusu İmam Şafii olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'hanbelilik-mezhep',
                        name: 'Hanbelilik',
                        color: 'bg-lime-700',
                        questions: [
                            { question: 'Kurucusu Ahmed b. Hanbel olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'caferilik-mezhep',
                        name: 'Caferilik',
                        color: 'bg-emerald-700',
                        questions: [
                            { question: 'Kurucusu Cafer-i Sadık olan fıkhi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'esarilik-mezhep',
                        name: 'Eşarilik',
                        color: 'bg-rose-700',
                        questions: [
                            { question: 'Kurucusu Ebu\'l-Hasan el-Eş\'ari olan itikadi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'maturidilik-mezhep',
                        name: 'Maturidilik',
                        color: 'bg-fuchsia-700',
                        questions: [
                            { question: 'Kurucusu İmam Maturidi olan itikadi mezhep hangisidir?' }
                        ]
                    },
                    {
                        id: 'yesevilik-ekol',
                        name: 'Yesevilik',
                        color: 'bg-violet-700',
                        questions: [
                            { question: 'Kurucusu Hoca Ahmed Yesevi olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'kadirilik-ekol',
                        name: 'Kadirilik',
                        color: 'bg-amber-700',
                        questions: [
                            { question: 'Kurucusu Abdülkadir Geylani olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'mevlevilik-ekol',
                        name: 'Mevlevilik',
                        color: 'bg-sky-700',
                        questions: [
                            { question: 'Kurucusu Mevlana Celaleddin Rumi olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'nakşibendilik-ekol',
                        name: 'Nakşibendilik',
                        color: 'bg-gray-700',
                        questions: [
                            { question: 'Kurucusu Bahauddin Nakşibend olan tasavvufi ekol hangisidir?' }
                        ]
                    },
                    {
                        id: 'alevilik-bektasilik-ekol',
                        name: 'Alevilik-Bektaşilik',
                        color: 'bg-blue-800',
                        questions: [
                            { question: 'Hacı Bektaş Veli\'nin öğretileri etrafında şekillenen tasavvufi ekol hangisidir?' }
                        ]
                    }
                ]
            }
        ];

        // HTML elementlerini seç
        const unitCardsContainer = document.getElementById('unitCardsContainer');
        const startQuizBtn = document.getElementById('startQuizBtn');
        const returnToHomePageBtn = document.getElementById('returnToHomePageBtn');
        const mainTitle = document.getElementById('mainTitle');
        const mainMenuScreen = document.getElementById('mainMenuScreen');
        const mainQuizContent = document.getElementById('mainQuizContent');
        const questionText = document.getElementById('questionText');
        const conceptBoxesDiv = document.getElementById('conceptBoxes');
        const feedbackDiv = document.getElementById('feedback');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const resetQuizBtn = document.getElementById('resetQuizBtn');
        const returnToMainMenuFromQuizBtn = document.getElementById('returnToMainMenuFromQuizBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const showAnswerBtn = document.getElementById('showAnswerBtn');

        let selectedUnitId = null;
        let currentQuestion = null;
        let askedQuestionsUniqueIds = [];
        let timerInterval;
        let timeLeft = 30; // Saniye 30'a düşürüldü
        const INITIAL_TIME = 30; // Sabit değer de 30'a düşürüldü
        let currentIncorrectAttempts = 0;
        const MAX_INCORRECT_ATTEMPTS = 2;

        // Yardımcı Fonksiyon: Diziyi karıştır
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Özel Modal Mantığı
        const customModalOverlay = document.getElementById('customModalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalInput1 = document.getElementById('modalInput1');
        const modalInput2 = document.getElementById('modalInput2');
        const modalTextarea = document.getElementById('modalTextarea');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');

        function showModal(title, message, type, onConfirm, onCancel, input1Placeholder = '', input2Placeholder = '', textareaPlaceholder = '') {
            modalTitle.textContent = title;
            modalMessage.textContent = message;

            modalInput1.style.display = 'none';
            modalInput2.style.display = 'none';
            modalTextarea.style.display = 'none';
            modalConfirmBtn.style.display = 'none';
            modalSaveBtn.style.display = 'none';
            modalCancelBtn.style.display = 'inline-block';

            // Olay dinleyicilerini sıfırla
            modalConfirmBtn.onclick = null;
            modalSaveBtn.onclick = null;
            modalCancelBtn.onclick = null;
            modalCancelBtn.textContent = 'İptal'; // Metni sıfırla

            if (type === 'alert') {
                modalCancelBtn.textContent = 'Tamam';
                modalCancelBtn.onclick = () => {
                    hideModal();
                    if (onConfirm) onConfirm();
                };
            } else if (type === 'confirm') {
                modalConfirmBtn.style.display = 'inline-block';
                modalCancelBtn.textContent = 'İptal';
                modalConfirmBtn.onclick = () => {
                    hideModal();
                    if (onConfirm) onConfirm();
                };
                modalCancelBtn.onclick = () => {
                    hideModal();
                    if (onCancel) onCancel();
                };
            }
            customModalOverlay.style.display = 'flex';
        }

        function hideModal() {
            customModalOverlay.style.display = 'none';
            modalInput1.value = '';
            modalInput2.value = '';
            modalTextarea.value = '';
            modalConfirmBtn.onclick = null;
            modalSaveBtn.onclick = null;
            modalCancelBtn.onclick = null;
            modalCancelBtn.textContent = 'İptal';
        }

        // Oyun mantığı
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = INITIAL_TIME; // Zamanlayıcı INITIAL_TIME'dan başlar
            timerDisplay.textContent = timeLeft;
            timerDisplay.classList.remove('warning');

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 10) {
                    timerDisplay.classList.add('warning');
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    feedbackDiv.textContent = `Süre doldu! Yanlış cevap hakkınız doldu. Sonraki soruya geçmek için "Sonraki Soru" butonuna basın.`;
                    feedbackDiv.classList.remove('success');
                    feedbackDiv.classList.add('error');
                    feedbackDiv.style.display = 'block';
                    disableConceptBoxes();
                    showAnswerBtn.disabled = true;
                    nextQuestionBtn.disabled = false;
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function getAvailableQuestions() {
            const selectedUnit = units.find(unit => unit.id === selectedUnitId);
            if (!selectedUnit) return [];

            let allQuestionsInUnit = [];
            selectedUnit.concepts.forEach(concept => {
                concept.questions.forEach((q, qIndex) => {
                    const baseConceptIdForQuestion = (selectedUnitId === 'all-units') ? concept.id : `${selectedUnitId}-${concept.id}`;
                    allQuestionsInUnit.push({
                        question: q.question,
                        correctConceptId: concept.id,
                        correctConceptName: concept.name,
                        uniqueQuestionId: `${baseConceptIdForQuestion}-${qIndex}`
                    });
                });
            });

            return allQuestionsInUnit.filter(q => !askedQuestionsUniqueIds.includes(q.uniqueQuestionId));
        }

        function displayQuestion() {
            stopTimer();
            feedbackDiv.style.display = 'none';
            feedbackDiv.textContent = '';
            conceptBoxesDiv.innerHTML = '';
            nextQuestionBtn.disabled = true;
            showAnswerBtn.disabled = false;
            currentIncorrectAttempts = 0;

            const availableQuestions = getAvailableQuestions();

            if (availableQuestions.length === 0) {
                // Tüm sorular cevaplandı, sadece bilgilendir ve ana menüye dön
                showModal('Yarışma Bitti!', `Tüm soruları cevapladınız.`, 'alert', () => {
                    returnToMainMenuScreen();
                });
                return;
            }

            currentQuestion = shuffleArray(availableQuestions)[0];
            askedQuestionsUniqueIds.push(currentQuestion.uniqueQuestionId);

            questionText.textContent = currentQuestion.question;

            const selectedUnitObj = units.find(unit => unit.id === selectedUnitId);
            let allConceptsInSelectedUnit = selectedUnitObj.concepts;

            const correctConcept = allConceptsInSelectedUnit.find(c => c.id === currentQuestion.correctConceptId);
            if (!correctConcept) {
                console.error("Doğru kavram bulunamadı, ID:", currentQuestion.correctConceptId);
                return;
            }

            let conceptsForDisplay = [correctConcept];

            let potentialWrongAnswers = allConceptsInSelectedUnit.filter(concept => {
                if (concept.id === correctConcept.id) return false;

                const hasUnaskedQuestion = concept.questions.some((q, qIndex) => {
                    const questionUniqueId = (selectedUnitId === 'all-units') ? `${concept.id}-${qIndex}` : `${selectedUnitId}-${concept.id}-${qIndex}`;
                    return !askedQuestionsUniqueIds.includes(questionUniqueId);
                });
                return hasUnaskedQuestion;
            });

            potentialWrongAnswers = shuffleArray(potentialWrongAnswers);

            for (let i = 0; conceptsForDisplay.length < 10 && i < potentialWrongAnswers.length; i++) {
                if (!conceptsForDisplay.some(c => c.id === potentialWrongAnswers[i].id)) {
                    conceptsForDisplay.push(potentialWrongAnswers[i]);
                }
            }

            if (conceptsForDisplay.length < 10) {
                const conceptsAlreadyInDisplay = new Set(conceptsForDisplay.map(c => c.id));
                const trulyRemainingConcepts = allConceptsInSelectedUnit.filter(c => !conceptsAlreadyInDisplay.has(c.id));
                shuffleArray(trulyRemainingConcepts);
                for (let i = 0; conceptsForDisplay.length < 10 && i < trulyRemainingConcepts.length; i++) {
                    conceptsForDisplay.push(trulyRemainingConcepts[i]);
                }
            }

            conceptsForDisplay = shuffleArray(conceptsForDisplay);

            conceptsForDisplay.forEach(concept => {
                const conceptBox = document.createElement('div');
                conceptBox.id = concept.id;
                conceptBox.classList.add('concept-box', concept.color, 'cursor-pointer');
                conceptBox.innerHTML = `<span>${concept.name}</span>`;
                conceptBox.style.setProperty('--animation-duration', `${2 + Math.random() * 3}s`);
                conceptBox.style.setProperty('--animation-delay', `${Math.random() * 0.5}s`);
                conceptBox.style.setProperty('--translate-x', `${(Math.random() - 0.5) * 10}px`);
                conceptBox.style.setProperty('--translate-y', `${(Math.random() - 0.5) * 10}px`);
                conceptBox.onclick = () => checkAnswer(concept.id);
                conceptBoxesDiv.appendChild(conceptBox);
            });

            startTimer();
        }

        function checkAnswer(selectedConceptId) {
            // stopTimer() is removed from here for incorrect answers with attempts remaining
            const selectedBox = document.getElementById(selectedConceptId);

            if (selectedConceptId === currentQuestion.correctConceptId) {
                stopTimer(); // Stop timer only on correct answer
                selectedBox.classList.add('correct');
                // Kullanıcının istediği geri bildirim metni
                feedbackDiv.textContent = `Doğru Cevap! ${currentQuestion.correctConceptName} tebrikler!`;
                feedbackDiv.classList.remove('error');
                feedbackDiv.classList.add('success');
                disableConceptBoxes(); // Tüm kutuları devre dışı bırak

                setTimeout(() => {
                    selectedBox.classList.remove('correct');
                    showAnswerBtn.disabled = true;
                    nextQuestionBtn.disabled = false;
                }, 1000); // Sadece vurgu süresi kadar bekleyip devam et
            } else {
                currentIncorrectAttempts++;
                selectedBox.classList.add('incorrect');

                if (currentIncorrectAttempts < MAX_INCORRECT_ATTEMPTS) {
                    feedbackDiv.textContent = `Yanlış cevap! ${MAX_INCORRECT_ATTEMPTS - currentIncorrectAttempts} hakkınız kaldı. Tekrar deneyin.`;
                    feedbackDiv.classList.remove('success');
                    feedbackDiv.classList.add('error');
                    setTimeout(() => {
                        selectedBox.classList.remove('incorrect');
                        // Timer is NOT restarted here, so it continues from current timeLeft
                        const allConceptBoxes = document.querySelectorAll('.concept-box');
                        allConceptBoxes.forEach(box => {
                            box.onclick = () => checkAnswer(box.id);
                            box.classList.add('cursor-pointer');
                            box.style.pointerEvents = 'auto';
                        });
                    }, 1000);
                } else {
                    // This is the last incorrect attempt or time ran out
                    stopTimer(); // Stop timer when attempts are exhausted
                    feedbackDiv.textContent = `Yanlış cevap hakkınız doldu! Sonraki soruya geçmek için "Sonraki Soru" butonuna basın.`;
                    feedbackDiv.classList.remove('success');
                    feedbackDiv.classList.add('error');
                    disableConceptBoxes();
                    showAnswerBtn.disabled = true;
                    nextQuestionBtn.disabled = false;
                    setTimeout(() => {
                        selectedBox.classList.remove('incorrect');
                    }, 1000);
                }
            }
            feedbackDiv.style.display = 'block';
        }

        function disableConceptBoxes() {
            const conceptBoxes = document.querySelectorAll('.concept-box');
            conceptBoxes.forEach(box => {
                box.onclick = null;
                box.classList.remove('cursor-pointer');
                box.style.pointerEvents = 'none';
            });
        }

        function resetQuiz() {
            stopTimer();
            selectedUnitId = null;
            askedQuestionsUniqueIds = [];
            currentQuestion = null;
            currentIncorrectAttempts = 0;
            mainQuizContent.style.display = 'none';
            mainMenuScreen.style.display = 'flex';
            mainTitle.style.display = 'block';
            feedbackDiv.style.display = 'none';
            timerDisplay.textContent = INITIAL_TIME; // Reset timer display to new initial time
            timerDisplay.classList.remove('warning');
            startQuizBtn.style.display = 'none';
            renderUnitCards();
        }

        function returnToMainMenuScreen() {
            stopTimer();
            mainQuizContent.style.display = 'none';
            mainMenuScreen.style.display = 'flex';
            mainTitle.style.display = 'block';
            selectedUnitId = null;
            askedQuestionsUniqueIds = [];
            currentIncorrectAttempts = 0;
            renderUnitCards();
            startQuizBtn.style.display = 'none';
            feedbackDiv.style.display = 'none';
            timerDisplay.textContent = INITIAL_TIME; // Reset timer display to new initial time
            timerDisplay.classList.remove('warning');
        }

        // Olay Dinleyicileri
        nextQuestionBtn.addEventListener('click', displayQuestion);
        resetQuizBtn.addEventListener('click', () => {
            showModal('Yarışmayı Yeniden Başlat', 'Mevcut yarışmayı sıfırlamak istediğinizden emin misiniz? Bu işlem mevcut ilerlemenizi silecektir.', 'confirm', () => {
                resetQuiz();
            }, () => {
                // İptal edilirse bir şey yapma
            });
        });
        returnToMainMenuFromQuizBtn.addEventListener('click', returnToMainMenuScreen);

        showAnswerBtn.addEventListener('click', () => {
            stopTimer();
            disableConceptBoxes();
            showAnswerBtn.disabled = true;
            const correctBox = document.getElementById(currentQuestion.correctConceptId);
            correctBox.classList.add('correct');
            feedbackDiv.textContent = `Doğru cevap: ${currentQuestion.correctConceptName}`;
            feedbackDiv.classList.remove('success');
            feedbackDiv.classList.add('error');
            feedbackDiv.style.display = 'block';
            nextQuestionBtn.disabled = false;
            setTimeout(() => {
                correctBox.classList.remove('correct');
            }, 1000);
        });

        // Ana Menü Mantığı
        function renderUnitCards() {
            unitCardsContainer.innerHTML = '';
            units.forEach(unit => {
                const unitCardElement = document.createElement('div');
                // Mevcut Tailwind gradient sınıfını kaldırıp, sadece bgColor'ı kullanıyoruz.
                // Eğer gradient isteniyorsa, unit verisine gradient sınıfı eklenmelidir.
                unitCardElement.className = `unit-card ${unit.bgColor} ${unit.id === selectedUnitId ? 'selected' : ''}`;
                unitCardElement.textContent = unit.name;
                unitCardElement.dataset.unitId = unit.id;

                unitCardElement.addEventListener('click', () => {
                    const currentSelected = document.querySelector('.unit-card.selected');
                    if (currentSelected) {
                        currentSelected.classList.remove('selected');
                    }
                    unitCardElement.classList.add('selected');
                    selectedUnitId = unit.id;
                    startQuizBtn.style.display = 'block';
                });
                unitCardsContainer.appendChild(unitCardElement);
            });

            const allUnitsCard = document.querySelector('.unit-card[data-unit-id="all-units"]');
            if (allUnitsCard) {
                unitCardsContainer.appendChild(allUnitsCard);
            }
        }

        startQuizBtn.addEventListener('click', () => {
            if (selectedUnitId) {
                mainMenuScreen.style.display = 'none';
                mainTitle.style.display = 'none';
                mainQuizContent.style.display = 'flex';
                askedQuestionsUniqueIds = [];
                displayQuestion();
            } else {
                showModal('Ünite Seçilmedi', 'Lütfen bir ünite seçerek yarışmayı başlatın.', 'alert');
            }
        });

        returnToHomePageBtn.addEventListener('click', () => {
            window.location.href = 'https://ozeme42.github.io/yunus/index.html';
        });

        // Uygulama yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            const allUnitsExist = units.some(unit => unit.id === 'all-units');

            // "Ek Kavramlar" ünitesini kaldır (eğer varsa) - bu zaten yoktu ama şablonu korumak için bırakıldı
            units = units.filter(unit => unit.id !== 'additional-concepts-unit');

            if (!allUnitsExist) {
                const allConceptsCombined = [];
                units.forEach(unit => {
                    unit.concepts.forEach((concept, conceptIndex) => {
                        const uniqueConceptId = `${unit.id}-${concept.id}`;
                        allConceptsCombined.push({
                            ...concept,
                            id: uniqueConceptId,
                            originalConceptId: concept.id,
                            unitId: unit.id
                        });
                    });
                });

                // "Tüm Üniteler" kartını ekle
                units.push({
                    id: 'all-units',
                    name: 'Tüm Üniteler',
                    concepts: shuffleArray(allConceptsCombined),
                    bgColor: 'bg-gray-200' // Varsayılan renk
                });
            }

            selectedUnitId = null;

            renderUnitCards();
            mainQuizContent.style.display = 'none';
            mainMenuScreen.style.display = 'flex';
            mainTitle.style.display = 'block';
        });
    </script>
</body>
</html>
